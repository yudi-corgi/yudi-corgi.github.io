<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.23" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.89" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£","image":["https://blog.yudi-corgi.site/assets/images/minions_cover21.jpg"],"datePublished":"2025-05-20T00:00:00.000Z","dateModified":"2025-06-11T03:35:55.000Z","author":[{"@type":"Person","name":"YUDI-Corgi","url":"https://github.com/yudi-corgi"}]}</script><meta property="og:url" content="https://blog.yudi-corgi.site/posts/distribute/jenkins_pipeline.html"><meta property="og:site_name" content="Black Hole"><meta property="og:title" content="Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£"><meta property="og:description" content="è®²è¿° Jenkins æµæ°´çº¿çš„æ¦‚å¿µã€è¯­æ³•ä¸åº”ç”¨"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.yudi-corgi.site/assets/images/minions_cover21.jpg"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-06-11T03:35:55.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://blog.yudi-corgi.site/assets/images/minions_cover21.jpg"><meta name="twitter:image:alt" content="Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£"><meta property="article:tag" content="DevOps"><meta property="article:tag" content="Jenkins"><meta property="article:published_time" content="2025-05-20T00:00:00.000Z"><meta property="article:modified_time" content="2025-06-11T03:35:55.000Z"><link rel="icon" type="image/svg+xml" href="/text.svg"><link rel="alternate" type="application/atom+xml" href="https://blog.yudi-corgi.site/atom.xml" title="Black Hole Atom Feed"><title>Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£ | Black Hole</title><meta name="description" content="è®²è¿° Jenkins æµæ°´çº¿çš„æ¦‚å¿µã€è¯­æ³•ä¸åº”ç”¨">
    <link rel="preload" href="/assets/style-C-gA0kct.css" as="style"><link rel="stylesheet" href="/assets/style-C-gA0kct.css">
    <link rel="modulepreload" href="/assets/app-C_r5yPSf.js"><link rel="modulepreload" href="/assets/jenkins_pipeline.html-DSs3abhj.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-CIWwtP_A.js" as="script"><link rel="prefetch" href="/assets/intro.html-KCjZ4-F4.js" as="script"><link rel="prefetch" href="/assets/enum_convert.html-DLWqT8at.js" as="script"><link rel="prefetch" href="/assets/distributed_transaction.html-Dbz0plP0.js" as="script"><link rel="prefetch" href="/assets/tcp.html-BpbJ9ZGC.js" as="script"><link rel="prefetch" href="/assets/java-string.html-oLaGluwD.js" as="script"><link rel="prefetch" href="/assets/jdk7-HashMap.html-BtV2Dl2_.js" as="script"><link rel="prefetch" href="/assets/jdk8-HashMap.html-DbSlmZ_F.js" as="script"><link rel="prefetch" href="/assets/jvm-class-loading-mechanism.html-DKkR68Sn.js" as="script"><link rel="prefetch" href="/assets/jvm-memory-model.html-DKS1M4wU.js" as="script"><link rel="prefetch" href="/assets/how_does_b-tree_make_your_queries_fast.html-B4u9z49Q.js" as="script"><link rel="prefetch" href="/assets/is_it_time_to_ditch_mysql_and_postgresql_for_sqlite.html-DRN2vm20.js" as="script"><link rel="prefetch" href="/assets/sharded_does_not_imply_distributed.html-CoaFoFIa.js" as="script"><link rel="prefetch" href="/assets/webSockets_vs_server-sent-events_vs_long-polling_vs_webrtc_vs_webtransport.html-BoeneXxf.js" as="script"><link rel="prefetch" href="/assets/why_is_oauth_still_hard_in_2025.html-C9Kz7GUm.js" as="script"><link rel="prefetch" href="/assets/J2Cache.html-BGe4a2S0.js" as="script"><link rel="prefetch" href="/assets/spring_cloud_stream_one.html-Dx2trBhv.js" as="script"><link rel="prefetch" href="/assets/spring_cloud_stream_three.html-BjGia3eb.js" as="script"><link rel="prefetch" href="/assets/spring_cloud_stream_two.html-4yDr7bbE.js" as="script"><link rel="prefetch" href="/assets/spring_transaction_synchronization.html-hqZx3JJf.js" as="script"><link rel="prefetch" href="/assets/spring_websocket_one.html-DQ3xngmc.js" as="script"><link rel="prefetch" href="/assets/spring_websocket_two.html-Bt2JmORd.js" as="script"><link rel="prefetch" href="/assets/404.html-BCIIAewo.js" as="script"><link rel="prefetch" href="/assets/index.html-lEc8BqSP.js" as="script"><link rel="prefetch" href="/assets/index.html-B3haP56W.js" as="script"><link rel="prefetch" href="/assets/index.html-BHw733-4.js" as="script"><link rel="prefetch" href="/assets/index.html-DJPr7hQj.js" as="script"><link rel="prefetch" href="/assets/index.html-CHiC2-Fa.js" as="script"><link rel="prefetch" href="/assets/index.html-BFRAF2U9.js" as="script"><link rel="prefetch" href="/assets/index.html-CrP453b_.js" as="script"><link rel="prefetch" href="/assets/index.html-BNotLOCP.js" as="script"><link rel="prefetch" href="/assets/index.html-D-PQ6w-U.js" as="script"><link rel="prefetch" href="/assets/index.html-DhNgHnH-.js" as="script"><link rel="prefetch" href="/assets/index.html-DHm7UtAD.js" as="script"><link rel="prefetch" href="/assets/index.html-BDAXD6Dx.js" as="script"><link rel="prefetch" href="/assets/index.html-DrumnaHC.js" as="script"><link rel="prefetch" href="/assets/index.html-CzfKZw1M.js" as="script"><link rel="prefetch" href="/assets/index.html-Cgfs2MZp.js" as="script"><link rel="prefetch" href="/assets/index.html-DubHXP6o.js" as="script"><link rel="prefetch" href="/assets/index.html-CJQY5OCo.js" as="script"><link rel="prefetch" href="/assets/index.html-DDpaLhqk.js" as="script"><link rel="prefetch" href="/assets/index.html-5Cg_NMvU.js" as="script"><link rel="prefetch" href="/assets/index.html-CoI3pWR3.js" as="script"><link rel="prefetch" href="/assets/index.html-DUjAUJP2.js" as="script"><link rel="prefetch" href="/assets/index.html-BaGZbhZr.js" as="script"><link rel="prefetch" href="/assets/index.html-CDsAinHM.js" as="script"><link rel="prefetch" href="/assets/index.html-BHO_x-e1.js" as="script"><link rel="prefetch" href="/assets/index.html-B6A-yQAa.js" as="script"><link rel="prefetch" href="/assets/index.html-CB545ksW.js" as="script"><link rel="prefetch" href="/assets/index.html-4pYyN9j8.js" as="script"><link rel="prefetch" href="/assets/index.html-B63LE8Gi.js" as="script"><link rel="prefetch" href="/assets/index.html-azXSGj4X.js" as="script"><link rel="prefetch" href="/assets/index.html-BeRAwcVk.js" as="script"><link rel="prefetch" href="/assets/index.html-mlbWCuaP.js" as="script"><link rel="prefetch" href="/assets/index.html-Bp9MQIgf.js" as="script"><link rel="prefetch" href="/assets/index.html-D8f6AYOp.js" as="script"><link rel="prefetch" href="/assets/index.html-B_XpMon0.js" as="script"><link rel="prefetch" href="/assets/index.html-DEWAT6sZ.js" as="script"><link rel="prefetch" href="/assets/index.html-Dk72QdTN.js" as="script"><link rel="prefetch" href="/assets/index.html-DQBDG4zJ.js" as="script"><link rel="prefetch" href="/assets/index.html-ixdbY9tj.js" as="script"><link rel="prefetch" href="/assets/index.html-CdOjO0NU.js" as="script"><link rel="prefetch" href="/assets/index.html-Bl41duup.js" as="script"><link rel="prefetch" href="/assets/index.html-1UYr2WWS.js" as="script"><link rel="prefetch" href="/assets/index.html-Cu-rF0ss.js" as="script"><link rel="prefetch" href="/assets/index.html-Q4iXD69g.js" as="script"><link rel="prefetch" href="/assets/index.html-UpgKadLP.js" as="script"><link rel="prefetch" href="/assets/auto-BtC3bP42.js" as="script"><link rel="prefetch" href="/assets/index-BZSEhAeG.js" as="script"><link rel="prefetch" href="/assets/flowchart-CTwbLKUk.js" as="script"><link rel="prefetch" href="/assets/mermaid.esm.min-BxcILUFS.js" as="script"><link rel="prefetch" href="/assets/vue-repl-b31TG4P8.js" as="script"><link rel="prefetch" href="/assets/codemirror-editor-CP24ii3O.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-DXWKOczD.js" as="script"><link rel="prefetch" href="/assets/waline-meta-l0sNRNKZ.js" as="script"><link rel="prefetch" href="/assets/component-DWjsTfjf.js" as="script"><link rel="prefetch" href="/assets/SearchResult-D9kwn8UV.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">Black Hole</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><iconify-icon class="vp-icon" icon="home" height="1em" sizing="height"></iconify-icon><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç²¾é€‰æ–‡ç« "><!--[--><iconify-icon class="vp-icon" icon="fluent-emoji-flat:star" height="1em" sizing="height"></iconify-icon>ç²¾é€‰æ–‡ç« <!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/framework/spring/spring_transaction_synchronization.html" aria-label="Spring äº‹åŠ¡åŒæ­¥"><!--[--><iconify-icon class="vp-icon" icon="devicon:spring" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->Spring äº‹åŠ¡åŒæ­¥<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/java/java-string.html" aria-label="æ·±å…¥æµ…å‡º String å­—ç¬¦ä¸²"><!--[--><iconify-icon class="vp-icon" icon="ant-design:field-string-outlined" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->æ·±å…¥æµ…å‡º String å­—ç¬¦ä¸²<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/distribute/jenkins_pipeline.html" aria-label="Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£"><!--[--><iconify-icon class="vp-icon" icon="vscode-icons:file-type-jenkins" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/intro.html" aria-label="å…³äºä½œè€…"><!--[--><iconify-icon class="vp-icon" icon="openmoji:black-hole" height="1em" sizing="height"></iconify-icon><!--]-->å…³äºä½œè€…<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/yudi-corgi" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><iconify-icon class="vp-icon" icon="home" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->åšå®¢ä¸»é¡µ<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="vp-icon" icon="book" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="vp-icon" icon="book" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">æ¡†æ¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="vp-icon" icon="book" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">åˆ†å¸ƒå¼é¢†åŸŸ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/distribute/distributed_transaction.html" aria-label="åˆ†å¸ƒå¼äº‹åŠ¡"><!--[--><iconify-icon class="vp-icon" icon="icon-park:transaction" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->åˆ†å¸ƒå¼äº‹åŠ¡<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/distribute/tcp.html" aria-label="TCP æ‚è°ˆ"><!--[--><iconify-icon class="vp-icon" icon="fluent:protocol-handler-24-regular" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->TCP æ‚è°ˆ<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/distribute/jenkins_pipeline.html" aria-label="Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£"><!--[--><iconify-icon class="vp-icon" icon="vscode-icons:file-type-jenkins" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="vp-icon" icon="book" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">å¼€å‘æŠ€å·§</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="vp-icon" icon="book" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">æ‚è°ˆ</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/intro.html" aria-label="å…³äºä½œè€…"><!--[--><iconify-icon class="vp-icon" icon="circle-info" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->å…³äºä½œè€…<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="/assets/images/minions_cover21.jpg" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="vp-icon" icon="vscode-icons:file-type-jenkins" height="1em" sizing="height"></iconify-icon>Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/yudi-corgi" target="_blank" rel="noopener noreferrer">YUDI-Corgi</a></span><span property="author" content="YUDI-Corgi"></span></span><span class="page-original-info">åŸåˆ›</span><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2025/5/20</span><meta property="datePublished" content="2025-05-20T00:00:00.000Z"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color2 clickable" role="navigation">DevOps</span><!--]--><meta property="articleSection" content="DevOps"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color4 clickable" role="navigation">Jenkins</span><span class="page-tag-item color2 clickable" role="navigation">DevOps</span><!--]--><meta property="keywords" content="Jenkins,DevOps"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 22 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT22M"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h2 id="æµæ°´çº¿-pipeline" tabindex="-1"><a class="header-anchor" href="#æµæ°´çº¿-pipeline"><span>æµæ°´çº¿ Pipeline</span></a></h2><h3 id="æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#æ¦‚å¿µ"><span>æ¦‚å¿µ</span></a></h3><p><strong><a href="https://www.jenkins.io/doc/book/pipeline/" target="_blank" rel="noopener noreferrer">Jenkins Pipeline</a></strong>ï¼ˆç®€ç§° Pipeline/æµæ°´çº¿ï¼‰æ˜¯ä¸€å¥—æ’ä»¶ï¼Œæ”¯æŒå®ç°<em>æŒç»­äº¤ä»˜ç®¡é“</em>ï¼ˆCDPï¼Œcontinuous delivery pipelinesï¼‰å¹¶å°†å…¶é›†æˆåˆ° Jenkins ä¸­ã€‚</p><blockquote><p>Noteï¼š<strong>CDP</strong> æ˜¯å°†è½¯ä»¶ä»ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿç›´æ¥äº¤ä»˜ç»™å®¢æˆ·çš„æµç¨‹çš„è‡ªåŠ¨åŒ–è¡¨è¾¾ã€‚å¯¹è½¯ä»¶çš„æ¯é¡¹æ›´æ”¹ï¼ˆåœ¨æºä»£ç ç®¡ç†ä¸­æäº¤ï¼‰åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­éƒ½ä¼šç»å†ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œæ­¤è¿‡ç¨‹æ¶‰åŠä»¥å¯é ä¸”å¯é‡å¤çš„æ–¹å¼æ„å»ºè½¯ä»¶ï¼Œä»¥åŠé€šè¿‡æµ‹è¯•å’Œéƒ¨ç½²çš„å¤šä¸ªé˜¶æ®µæ¥æ¨è¿›æ„å»ºçš„è½¯ä»¶ã€‚</p></blockquote><p>Pipeline çš„å®šä¹‰ä¼šå†™åœ¨ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå³ <strong>Jenkinsfile</strong>ï¼Œå…¶å¯ä»¥éšç€ä»£ç ä¸€èµ·æäº¤åˆ°æºä»£ç ä»“åº“ï¼Œæ˜¯ <strong>Pipeline-as-code</strong> çš„åŸºç¡€ï¼Œæ­¤è¡Œä¸ºå°† CDP è§†ä¸ºè¦åƒä»»ä½•å…¶ä»–ä»£ç ä¸€æ ·è¿›è¡Œç‰ˆæœ¬æ§åˆ¶å’Œå®¡æ ¸ã€‚</p><ul><li><strong>Pipeline</strong>ï¼šæ˜¯ç”¨æˆ·å®šä¹‰çš„ CD ç®¡é“æ¨¡å‹ï¼ŒPipeline çš„ä»£ç å®šä¹‰äº†æ•´ä¸ªæ„å»ºè¿‡ç¨‹ï¼Œå…¶ä¸­é€šå¸¸åŒ…æ‹¬æ„å»ºã€æµ‹è¯•ç„¶åäº¤ä»˜åº”ç”¨ç¨‹åºçš„é˜¶æ®µã€‚pipeline å—ä¹Ÿæ˜¯<a href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%AE%A1%E9%81%93%E8%AF%AD%E6%B3%95">å£°æ˜å¼ç®¡é“è¯­æ³•</a>çš„ä¸€éƒ¨åˆ†</li><li><strong>Node</strong>ï¼ˆèŠ‚ç‚¹ï¼‰ï¼šæ˜¯ Jenkins ç¯å¢ƒçš„ä¸€éƒ¨åˆ†ï¼Œå³èƒ½å¤Ÿæ‰§è¡Œ Pipeline çš„æœºå™¨ï¼ˆè¯¦è§<a href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E9%9A%94%E7%A6%BB">æ§åˆ¶å™¨éš”ç¦»</a>ï¼‰ã€‚node å—ä¹Ÿæ˜¯<a href="#%E8%84%9A%E6%9C%AC%E5%BC%8F%E7%AE%A1%E9%81%93%E8%AF%AD%E6%B3%95">è„šæœ¬å¼ç®¡é“è¯­æ³•</a>çš„ä¸€éƒ¨åˆ†</li><li><strong>Stage</strong>ï¼ˆé˜¶æ®µï¼‰ï¼šç”¨äºå®šä¹‰ Pipeline å„ä¸ªé˜¶æ®µçš„ä»»åŠ¡å­é›†ï¼ˆæ¯”å¦‚<em>æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²</em>é˜¶æ®µï¼‰ï¼Œè®¸å¤šæ’ä»¶ä¾èµ–äº Stage æ¥å¯è§†åŒ– Pipeline çš„çŠ¶æ€æˆ–è¿‡ç¨‹</li><li><strong>Step</strong>ï¼ˆæ­¥éª¤ï¼‰ï¼šæŒ‡å®š Jenkins åœ¨æ¯ä¸ªé˜¶æ®µé‡Œè¦æ‰§è¡Œä»€ä¹ˆæ“ä½œ</li></ul><figure><img src="/assets/pipeline-%E6%B5%81%E7%A8%8B%E7%A4%BA%E4%BE%8B%E5%9B%BE-DPFsp5d1.png" alt="æµæ°´çº¿æµç¨‹ç¤ºä¾‹å›¾" tabindex="0" loading="lazy"><figcaption>æµæ°´çº¿æµç¨‹ç¤ºä¾‹å›¾</figcaption></figure><h3 id="jenkinsfile-è¯­æ³•æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#jenkinsfile-è¯­æ³•æ¦‚è§ˆ"><span>Jenkinsfile è¯­æ³•æ¦‚è§ˆ</span></a></h3><p>è¯­æ³•åˆ†ä¸ºä¸¤ç§ï¼š<strong>å£°æ˜å¼</strong>ï¼ˆDeclarativeï¼‰ã€<strong>è„šæœ¬å¼</strong>ï¼ˆScriptedï¼‰ï¼Œä¸¤è€…éƒ½æ˜¯ DSLï¼ˆPipeline domain-specific languageï¼‰è¯­è¨€ï¼Œè™½ç„¶ä¸¤è€…ä¼šè¢« Pipeline å¼•æ“åŸºäº Groovy è¯­æ³•è§£æï¼Œä½†æ˜¯å£°æ˜å¼è¯­æ³•æ˜¯ä¸€ç§æ›´å…·ç»“æ„åŒ–å’Œé™åˆ¶æ€§çš„ DSLï¼Œå…¶å­˜åœ¨æ˜¯ä¸ºäº†èƒ½æ›´æ–¹ä¾¿åœ°ç¼–å†™ jenkinsfileï¼Œå› æ­¤æ— æ³•åƒè„šæœ¬å¼ä¸€æ ·èƒ½ä½¿ç”¨ Groovy ç»å¤§å¤šæ•°ç‰¹æ€§ï¼ˆå˜é‡ã€å‡½æ•°ã€æ§åˆ¶æµè¯­å¥ç­‰ï¼‰ï¼Œä¸¤è€…è¯­æ³•å…·ä½“æ¯”è¾ƒå¯çœ‹å®˜æ–¹æ–‡æ¡£<a href="https://www.jenkins.io/doc/book/pipeline/syntax/#compare" target="_blank" rel="noopener noreferrer">è¯´æ˜</a>ã€‚</p><p>åœ¨<a href="#%E6%93%8D%E4%BD%9C%E6%BC%94%E7%A4%BA">æ“ä½œæ¼”ç¤º</a>ä¸€èŠ‚ä¼šç»†è®²å¸¸ç”¨çš„è¯­æ³•å…³é”®è¯ï¼Œå®˜æ–¹æ–‡æ¡£ç›´é€šè½¦æˆ³<a href="https://www.jenkins.io/doc/book/pipeline/syntax/" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ã€‚</p><h4 id="å£°æ˜å¼ç®¡é“è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#å£°æ˜å¼ç®¡é“è¯­æ³•"><span>å£°æ˜å¼ç®¡é“è¯­æ³•</span></a></h4><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {                    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å£°æ˜å¼è¯­æ³•å¼€å¤´</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent any                 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// agent æŒ‡å®šæ‰§è¡Œæ­¤ Pipeline çš„èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    stages {                  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// é˜¶æ®µå—</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Build&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä¸ºé˜¶æ®µå‘½å</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {           </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ­¥éª¤å—</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;make&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     // è¿™é‡Œå‡è®¾æ‰§è¡Œ bash å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                // ... å…¶å®ƒæ­¥éª¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Test&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å¯å®šä¹‰å¤šä¸ªé˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                // ... å…¶å®ƒæ­¥éª¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Deploy&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) { </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                // ... å…¶å®ƒæ­¥éª¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="è„šæœ¬å¼ç®¡é“è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#è„šæœ¬å¼ç®¡é“è¯­æ³•"><span>è„šæœ¬å¼ç®¡é“è¯­æ³•</span></a></h4><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">node {                    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è„šæœ¬å¼è¯­æ³•å¼€å¤´ï¼Œè¡¨ç¤ºåœ¨ä»»ä½•å¯ç”¨çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œæ­¤ Pipeline</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">    stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Build&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æŒ‡å®šé˜¶æ®µåç§°</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        //                // æ‰§è¡Œæ­¥éª¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">    stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Test&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å…¶å®ƒé˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">    stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Deploy&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) { </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="æ“ä½œæ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#æ“ä½œæ¼”ç¤º"><span>æ“ä½œæ¼”ç¤º</span></a></h3><blockquote><p>noteï¼šé»˜è®¤è¯»è€…å·²ç»å®‰è£…å¹¶è¿è¡Œ Jenkinsï¼Œå¹¶èƒ½æ­£ç¡®è®¿é—® Jenkins GUIã€‚å¯åŠ¨æ–¹å¼å¯çœ‹å®˜æ–‡ï¼š<a href="https://www.jenkins.io/doc/book/installing/" target="_blank" rel="noopener noreferrer">å®‰è£… Jenkins</a>ã€‚</p></blockquote><h4 id="åˆ›å»º-pipeline" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-pipeline"><span>åˆ›å»º pipeline</span></a></h4><p>åˆ›å»ºæµæ°´çº¿æœ‰ä¸¤ç§æ–¹å¼ï¼šä¼ ç»Ÿ GUI å’Œ <a href="https://www.jenkins.io/doc/book/blueocean/" target="_blank" rel="noopener noreferrer">Blue Ocean</a>ï¼Œåè€…æ˜¯é’ˆå¯¹ Pipeline çš„ æ–° GUI è®¾è®¡ï¼Œä¸»è¦æä¾›æ˜“äºä½¿ç”¨çš„ Pipeline å¯è§†åŒ–ã€‚ç”±äºæ“ä½œæ¼”ç¤ºä¸“æ³¨äº Jenkinsfile çš„ç¼–å†™ï¼Œæ‰€ä»¥æµæ°´çº¿åˆ›å»ºæ–¹å¼ä¸å†å¼ºè°ƒï¼ˆPSï¼šBlue Ocean æ”¯æŒä»¥å¯è§†åŒ–çš„æ–¹å¼åˆ›å»º Jenkinsfileï¼‰ã€‚</p><ol><li>è¿›å…¥ Jenkins GUI <em>Dashboard =&gt; New Item</em> ç•Œé¢ï¼Œé€‰æ‹© <em>Pipeline</em>ï¼Œè¾“å…¥åç§°ï¼Œç‚¹å‡» OK å³å¯åˆ›å»ºæµæ°´çº¿é¡¹ç›®</li><li>è¿›å…¥é…ç½®ç•Œé¢åï¼Œåœ¨ <em>General - Description</em> è¾“å…¥æè¿°ï¼Œåœ¨ <em>Pipeline - Definition</em> é€‰æ‹© <em>Pipeline script</em>ï¼Œå³å¯ç¼–å†™ Jenkinsfile è„šæœ¬ï¼Œæœ€å Save å¹¶æ‰§è¡Œæ„å»ºæ“ä½œ</li></ol><figure><img src="/assets/pipeline-script-B-KFObwH.jpeg" alt="æµæ°´çº¿è„šæœ¬é…ç½®" tabindex="0" loading="lazy"><figcaption>æµæ°´çº¿è„šæœ¬é…ç½®</figcaption></figure><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {                                    #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent any                                 #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    stages {                                  #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Stage 1&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {                    #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {                           #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;./scripts/build.sh&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Stage 2&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            agent { label </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;custom-label&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }    #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Test step to do sth.&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Do sth. else.&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Stage 3&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            agent {                           #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                docker {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    image </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;maven:3-alpine&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    label </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;custom-label&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    args  </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;-v /tmp:/tmp&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      // è¦ä¼ é€’ç»™ docker run çš„è¿è¡Œæ—¶å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                } </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;mvn -v&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                   #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">9</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            post {                            #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Do sth.&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	post {                                    #</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">11</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        always {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Finished execute.&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>#1</strong>ï¼š<code>pipeline { ... }</code> å—æ˜¯å£°æ˜å¼ç®¡é“è¯­æ³•çš„å¼€å¤´ï¼Œæ‰€æœ‰æœ‰æ•ˆçš„å£°æ˜å¼è¯­æ³•éƒ½åŒ…å«åœ¨æ­¤å—ä¸­</li><li><strong>#2</strong>ï¼š<code>agent</code> ç”¨äºæŒ‡å®šæ•´ä¸ªæµæ°´çº¿æˆ–ç‰¹å®šé˜¶æ®µï¼ˆå¦‚ <strong>#7</strong>ï¼‰å°†åœ¨ Jenkins ç¯å¢ƒä¸­æ‰§è¡Œçš„ä½ç½®ï¼ˆå³æ‰§è¡Œæ„å»ºçš„èŠ‚ç‚¹ï¼‰ï¼ŒJenkins å¯ä»¥é…ç½®å¤šä¸ªèŠ‚ç‚¹ï¼Œå…¶å¯ä»¥æ˜¯ç‰©ç†æœºã€è™šæ‹Ÿæœºæˆ–å®¹å™¨ã€‚å¯å¡«å†…å®¹å¦‚ä¸‹ï¼š <ul><li><code>agent none</code>ï¼šåœ¨é¡¶å±‚å£°æ˜æ—¶ï¼Œè¡¨ç¤ºä¸æŒ‡å®š agentï¼Œè€Œç”±æ¯ä¸ª Stage è‡ªè¡ŒæŒ‡å®š agentï¼›è‹¥é¡¶å±‚é…ç½®æ­¤é¡¹ï¼ŒStage ä¹Ÿä¸æŒ‡å®šä»»ä½• agentï¼ˆæˆ– agent noneï¼‰ï¼Œåˆ™ä¼šæ„å»ºå¤±è´¥</li><li><code>agent any</code>ï¼šåœ¨ä»»ä½•å¯ç”¨çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œæµæ°´çº¿æˆ–é˜¶æ®µ</li><li><code>agent { label ... }</code>ï¼šå¦‚ <strong>#7</strong>ï¼Œåœ¨æ‹¥æœ‰æŒ‡å®šæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œæµæ°´çº¿æˆ–é˜¶æ®µï¼ˆ<em>Manage Jenkins =&gt; Nodes</em> é€‰æ‹©èŠ‚ç‚¹é…ç½®å³å¯è®¾ç½® Labelï¼‰</li><li><code>agent { node ... customWorkspace ... }</code>ï¼šä¸ <code>agent label</code> æ–¹å¼æ•ˆæœç­‰ä»·ï¼Œä½†å¯é€šè¿‡ <code>customWorkspace</code> é€‰é¡¹æ¥æ§åˆ¶èŠ‚ç‚¹çš„å·¥ä½œç©ºé—´ï¼ˆé»˜è®¤æ˜¯ <code>/var/#ROOT_DIR/workspace</code>ï¼Œæ ¹è·¯å¾„æ˜¯æ–°å¢èŠ‚ç‚¹æ—¶æŒ‡å®šï¼‰</li><li><code>agent { docker { ... } }</code>ï¼šä½¿ç”¨ç»™å®šçš„å®¹å™¨æ‰§è¡Œæµæ°´çº¿æˆ–é˜¶æ®µï¼ˆå¦‚ <strong>#8</strong>ï¼‰ <ul><li><code>docker args</code> å¯å¡«å†™å¤§å¤šæ•° <code>docker run</code> æ—¶ä½¿ç”¨çš„å‚æ•°ï¼Œå¹¶ä¸”ä¼šå¼ºåˆ¶æŠ“å–é•œåƒï¼ˆå³ä½¿é•œåƒå·²å­˜åœ¨ï¼‰</li><li><code>docker label</code> æ ‡ç­¾æ•ˆæœä¸ <code>agent label</code> ç±»ä¼¼ï¼Œä¸è¿‡è¿™é‡Œæ˜¯ç”¨äºæŒ‡å®š docker å®¹å™¨åœ¨æ‹¥æœ‰æŒ‡å®šæ ‡ç­¾çš„èŠ‚ç‚¹è¿è¡Œï¼Œä¸ä½¿ç”¨åˆ™é»˜è®¤æ˜¯é€‰æ‹©ä»»ä¸€èŠ‚ç‚¹</li></ul></li><li><code>agent { dockerfile { ... } }</code>ï¼šä½¿ç”¨æºç ä»“åº“åŒ…å«çš„ Dockerfile æ„å»ºçš„å®¹å™¨æ¥æ‰§è¡Œæµæ°´çº¿æˆ–é˜¶æ®µ</li><li><code>agent { kubernetes { ... } }</code>ï¼šä¸ä¸Šè¿°æ‰€æœ‰æ–¹å¼åŒºåˆ«åœ¨äºï¼Œæ‰§è¡Œç¯å¢ƒä¸ä¾èµ–äº Jenkins èŠ‚ç‚¹ï¼Œè€Œæ˜¯åœ¨ K8s é›†ç¾¤ä¸­åŠ¨æ€åˆ›å»ºä¸€ä¸ª POD æ‰§è¡Œæ„å»º</li></ul></li><li><strong>#3</strong>ï¼š<code>stages</code> å—ç”¨äºæŒ‡å®šæ„å»ºçš„å„ä¸ªé˜¶æ®µï¼ŒåŒ…è£¹ 1~n ä¸ªé˜¶æ®µæŒ‡ä»¤ï¼Œå¯å®šä¹‰åœ¨ pipeline / stage å—ä¸­</li><li><strong>#4</strong>ï¼š<code>stage(&#39;name&#39;)</code> å—æŒ‡å®šé˜¶æ®µåç§°ï¼Œè¯¥é˜¶æ®µæ‰€æœ‰æ­¥éª¤æŒ‡ä»¤ä¹Ÿä¼šåŒ…è£¹åœ¨å…¶ä¸­</li><li><strong>#5</strong>ï¼š<code>steps</code> å—æŒ‡å®šåœ¨æ‰€åœ¨é˜¶æ®µè¦æ‰§è¡Œçš„ 1~n ä¸ªæ­¥éª¤ï¼ŒJenkins æ”¯æŒçš„æ­¥éª¤ç¹å¤šï¼Œä»¥ä¸‹æ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸‰ç§ï¼š <ul><li><a href="https://www.jenkins.io/doc/pipeline/steps/workflow-durable-task-step/#sh-shell-script" target="_blank" rel="noopener noreferrer">sh</a>ï¼šæŒ‡å®šè¦æ‰§è¡Œçš„ bash å‘½ä»¤ï¼ˆå¦‚ <strong>#6</strong>ï¼‰</li><li><a href="https://www.jenkins.io/doc/pipeline/steps/pipeline-build-step/" target="_blank" rel="noopener noreferrer">build</a>ï¼š<code>build job: &#39;job_name&#39;</code>ï¼Œè§¦å‘æŒ‡å®šåç§°çš„ pipeline æ‰§è¡Œæ„å»º</li><li><a href="https://www.jenkins.io/doc/pipeline/steps/workflow-basic-steps/#echo-print-message" target="_blank" rel="noopener noreferrer">echo</a>ï¼šè¾“å‡ºæ–‡æœ¬</li><li>å…¶ä½™è¯¦è§<a href="https://www.jenkins.io/doc/pipeline/steps/" target="_blank" rel="noopener noreferrer">å®˜æ–‡</a></li></ul></li><li><strong>#10/#11</strong>ï¼š<code>post</code> å®šä¹‰åœ¨æµæ°´çº¿æˆ–ç‰¹å®šé˜¶æ®µçš„è¿è¡Œå®Œæˆæ—¶æ‰§è¡Œçš„ 1~n ä¸ªé™„åŠ æ“ä½œï¼ˆä¸ <code>steps</code> ç›¸ä¼¼ï¼‰ï¼Œpost æ”¯æŒå¤šä¸ªåç½®æ¡ä»¶å—ï¼ˆå¦‚ <em>alwaysã€successã€failureã€aborted</em>ï¼‰ï¼Œæ¯”è¾ƒæ¸…æ™°æ˜“æ‡‚ï¼Œå…¶å®ƒæ¡ä»¶å—å¯çœ‹<a href="https://www.jenkins.io/doc/book/pipeline/syntax/#post" target="_blank" rel="noopener noreferrer">å®˜æ–‡</a></li></ul><h4 id="ä½¿ç”¨-maven-æ„å»º-java-é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-maven-æ„å»º-java-é¡¹ç›®"><span>ä½¿ç”¨ Maven æ„å»º Java é¡¹ç›®</span></a></h4><ol><li>æœ¬èŠ‚å°†ä½¿ç”¨ Jenkins å®˜æ–¹æ–‡æ¡£æä¾›çš„å­¦ä¹ ä»“åº“ <a href="https://github.com/jenkins-docs/simple-java-maven-app" target="_blank" rel="noopener noreferrer">simple-java-maven-app</a>ï¼Œè¯»è€…å¯è‡ªè¡Œ fork ç©è€</li><li>åŒæ ·åˆ›å»ºä¸€ä¸ª Pipeline é¡¹ç›®ï¼Œåœ¨ <em>Pipeline - Definition</em> é€‰æ‹© <em>Pipeline script from SCM</em>ï¼Œç„¶åå¡«å†™ fork çš„ä»“åº“åœ°å€ï¼ˆå¦‚æœæ˜¯è‡ªå»ºçš„ gitlab ç­‰å¹³å°è¿˜éœ€è¦å¡«å†™è®¿é—®å‡­è¯ Credentialsï¼‰</li><li>åœ¨ <em>Script Path</em> æŒ‡å®š Jenkinsfile åœ¨ä»“åº“ä¸­çš„ä½ç½®å³å¯ Save å¹¶æ‰§è¡Œæ„å»º</li></ol><figure><img src="/assets/pipeline-scm-BD2vpSIs.jpeg" alt="æŒ‡å®šä» SCM è·å–æµæ°´çº¿è„šæœ¬" tabindex="0" loading="lazy"><figcaption>æŒ‡å®šä» SCM è·å–æµæ°´çº¿è„šæœ¬</figcaption></figure><p>è¡¥å……ï¼šé‰´äºç¬”è€…çš„ Jenkins æ˜¯ Docker è¿è¡Œï¼Œå®¹å™¨å†…æ²¡æœ‰ Mavenï¼Œæœ‰ä¸¤ç§æ–¹å¼å¤„ç†ï¼š</p><ol><li>ä¿®æ”¹ Jenkinsfileï¼Œå°† agent é…ç½®ä¿®æ”¹ä¸º docker è¿è¡Œä¸€ä¸ªåŒ…å« JDK å’Œ Maven çš„é•œåƒï¼Œåœ¨æ­¤ç¯å¢ƒä¸­æ‰§è¡Œæ„å»º</li><li>åœ¨ Jenkins æ‰€åœ¨æœºå™¨å®‰è£…å¥½ Mavenï¼Œåœ¨ <em>Manage Jenkins =&gt; Tools</em> é…ç½® Maven çš„è·¯å¾„ï¼Œç„¶åä¿®æ”¹ Jenkinsfileï¼Œæ·»åŠ  <a href="#tools">tools</a> æŒ‡ä»¤</li></ol><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç”±äºç¬”è€…å®¿ä¸»æœºæœ‰ Mavenï¼Œå› æ­¤ç›´æ¥é‡‡ç”¨ç¬¬äºŒç§ï¼š</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    tools {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // è¿™é‡Œçš„åç§°å³ä¸º Manage Jenkins =&gt; Tools ä¸­é…ç½®çš„ Maven åç§°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        maven </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Maven-3.9.9&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// ... å…¶å®ƒæŒ‡ä»¤ä¸å˜</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç¬¬ä¸€ç§æ–¹å¼å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        docker {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // é€‰æ‹©ä¸€ä¸ªåŒ…å« Maven å’Œ JDK çš„é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            image </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;maven:3.9.9-eclipse-temurin-21-alpine&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // å¯é€‰é¡¹ï¼Œå¦‚æœä½ çš„ Jenkins æ˜¯å®¹å™¨è¿è¡Œï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // é‚£ä¹ˆæ­¤å¤„æ˜ å°„çš„å®¿ä¸»æœºå…¶å®å°±æ˜¯ Jenkins å®¹å™¨ï¼ŒMaven æ˜¯ Jenkins å®¹å™¨é‡Œçš„å®¹å™¨</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            args </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;-v /opt/maven_repos:/root/.m2&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ... å…¶å®ƒæŒ‡ä»¤ä¸å˜</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="å¤šåˆ†æ”¯æµæ°´çº¿" tabindex="-1"><a class="header-anchor" href="#å¤šåˆ†æ”¯æµæ°´çº¿"><span>å¤šåˆ†æ”¯æµæ°´çº¿</span></a></h4><ol><li>é¦–å…ˆåœ¨ fork çš„ä»“åº“ <a href="https://github.com/jenkins-docs/simple-java-maven-app" target="_blank" rel="noopener noreferrer">simple-java-maven-app</a> åˆ›å»ºå¤šä¸ªåˆ†æ”¯ï¼ˆæ¯”å¦‚ devã€prodï¼‰</li><li>è¿›å…¥ Jenkins GUI <em>Dashboard =&gt; New Item</em> ç•Œé¢ï¼Œé€‰æ‹© <em>Multibranch Pipeline</em>ï¼Œè¾“å…¥åç§°ï¼Œç‚¹å‡» OK åˆ›å»ºå¤šåˆ†æ”¯æµæ°´çº¿é¡¹ç›®</li><li>åŒæ ·è¾“å…¥ä»“åº“åœ°å€å’Œ Jenkinsfile åœ¨ä»“åº“é‡Œçš„è·¯å¾„</li></ol><figure><img src="/assets/pipeline-multi-branch-creat-DGfJv57b.jpeg" alt="å¤šåˆ†æ”¯æµæ°´çº¿åˆ›å»º" tabindex="0" loading="lazy"><figcaption>å¤šåˆ†æ”¯æµæ°´çº¿åˆ›å»º</figcaption></figure><ol start="4"><li>åˆ›å»ºé¡¹ç›®åï¼ŒJenkins ä¼šè‡ªåŠ¨æ‰«æä¸€æ¬¡ä»“åº“ï¼Œæ¥è·å–åˆ†æ”¯ä¿¡æ¯ï¼Œè‡³äºåˆ†æ”¯çš„è·å–ç­–ç•¥ï¼Œå¯åœ¨è¿™é‡Œé…ç½®</li></ol><figure><img src="/assets/pipeline-multi-branch-discover-gAVw_zuk.jpeg" alt="åˆ†æ”¯è·å–ç­–ç•¥è®¾ç½®" tabindex="0" loading="lazy"><figcaption>åˆ†æ”¯è·å–ç­–ç•¥è®¾ç½®</figcaption></figure><ol start="5"><li>å…¶å®ƒé…ç½®æŒ‰é»˜è®¤å¡«å†™å³å¯ï¼Œæˆ–è€…å¯æ ¹æ®éœ€è¦è¿›è¡Œå¡«å……ï¼Œæœ€åç‚¹å‡» Saveï¼Œè¿™æ ·æœ€åŸºæœ¬çš„å¤šåˆ†æ”¯æµæ°´çº¿é¡¹ç›®å°±åˆ›å»ºå¥½äº†</li><li>Jenkins ä¼šæ‹‰å–é¡¹ç›®åˆ†æ”¯å¹¶æ„å»ºä¸€æ¬¡ï¼Œä»¥ä¸‹æ˜¯åˆ›å»ºé¡¹ç›®åçš„ç•Œé¢</li></ol><figure><img src="/assets/pipeline-multi-branch-build-Bk1QZfCd.jpeg" alt="å¤šåˆ†æ”¯æµæ°´çº¿é¡¹ç›®æ„å»º" tabindex="0" loading="lazy"><figcaption>å¤šåˆ†æ”¯æµæ°´çº¿é¡¹ç›®æ„å»º</figcaption></figure><p>ä»¥ä¸Šè¿°æ–¹å¼åˆ›å»ºçš„é¡¹ç›®ï¼Œæ¯ä¸ªåˆ†æ”¯ä¸‹éƒ½æœ‰ç‹¬ç«‹çš„ Jenkinsfile æ–‡ä»¶ï¼Œå¯ä»¥éšç€åˆ†æ”¯ä¸€èµ·æäº¤å¹¶å®¡æ ¸ï¼Œé’ˆå¯¹ç¯å¢ƒä¿®æ”¹è„šæœ¬ã€‚è€Œå¦‚æœæ˜¯é¡¹ç›®é‡Œçš„å¤šä¸ªåˆ†æ”¯éƒ½åŸºäºåŒä¸€ Jenkinsfile æ„å»ºï¼Œåˆ™å¯ä»¥ç”¨ <code>when</code> æŒ‡ä»¤åŒºåˆ†ï¼Œé¡¹ç›®é‡Œçš„ Jenkinsfile ä¿®æ”¹å¦‚ä¸‹ï¼š</p><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ... çœç•¥å…¶å®ƒ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ... çœç•¥å…¶å®ƒ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å‘å¸ƒåˆ°å¼€å‘ç¯å¢ƒ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Deliver for dev&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            when {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                branch </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;dev&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">               // å½“åˆ†æ”¯ä¸º dev æ—¶æ‰§è¡Œè¯¥é˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;This is dev env!!!&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Deliver for test&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            when {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                branch </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;test&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">              // å½“åˆ†æ”¯ä¸º test æ—¶æ‰§è¡Œè¯¥é˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;This is test env!!!&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Deliver for master&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            when {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                branch </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;master&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">             // å½“åˆ†æ”¯ä¸º master æ—¶æ‰§è¡Œè¯¥é˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;./jenkins/scripts/deliver.sh&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><a id="when"></a></p><p><strong>when</strong> æŒ‡ä»¤æŒ‡å®š Pipeline æ ¹æ®ç»™å®šçš„æ¡ä»¶ç¡®å®šæ˜¯å¦åº”è¯¥æ‰§è¡Œè¯¥é˜¶æ®µï¼ŒæŒ‡ä»¤å—å†…å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªæ¡ä»¶ï¼Œè‹¥æœ‰å¤šä¸ªæ¡ä»¶ï¼Œåˆ™æ‰€æœ‰æ¡ä»¶éƒ½ä¸º true æ‰ä¼šæ‰§è¡Œè¯¥é˜¶æ®µã€‚</p><p>è¿™é‡Œç®€å•åˆ—ä¸‹å‡ ç§æ¡ä»¶ï¼Œå…¶å®ƒè¯¦è§<a href="https://www.jenkins.io/doc/book/pipeline/syntax/#when" target="_blank" rel="noopener noreferrer">å®˜æ–‡</a>ï¼š</p><ul><li><em>branch</em>ï¼šåªèƒ½åœ¨å¤šåˆ†æ”¯æµæ°´çº¿é¡¹ç›®ä½¿ç”¨ï¼Œå†…å®¹ä¼šè¢«å½“ä½œ <em>Ant-style path globbing</em>ï¼ˆæ¨¡å¼åŒ¹é…è¯­æ³•ï¼‰è¿›è¡Œè§£æï¼Œæ”¯æŒä¸¤ä¸ªå‚æ•° <ul><li><code>pattern</code>ï¼šåŒ¹é…å†…å®¹ï¼Œ<code>comparator</code> å‚æ•°æœªä½¿ç”¨æ—¶ï¼Œè¯¥å‚æ•°ä¸ç”¨æ˜¾å¼æŒ‡å®š</li><li><code>comparator</code>ï¼šæ¯”è¾ƒæ–¹å¼ï¼Œ<code>EQUALS</code>ï¼ˆç›¸ç­‰ï¼‰ã€<code>GLOB</code>ï¼ˆé»˜è®¤ï¼ŒæŒ‰ Ant-style æ¨¡å¼åŒ¹é…ï¼‰ã€<code>REGEXP</code>ï¼ˆæŒ‰æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼‰</li></ul></li><li><em>changelog</em>ï¼šè‹¥æŒ‡å®šè¡¨è¾¾å¼ä¸ Git æäº¤ä¿¡æ¯åŒ¹é…ï¼Œåˆ™æ‰§è¡Œæ„å»º</li><li><em>not</em>ï¼šç”¨äºæŒ‡å®šåµŒå¥—æ¡ä»¶ä¸º false æ—¶æ‰§è¡Œæ„å»ºï¼Œå¿…é¡»åŒ…å«ä¸€ä¸ªå­æ¡ä»¶ï¼Œå¦‚ <code>when { not { branch &#39;dev&#39; } }</code></li><li><em>allOf</em>ï¼šç”¨äºæŒ‡å®šåµŒå¥—æ¡ä»¶éƒ½å¿…é¡»ä¸º true æ—¶æ‰§è¡Œæ„å»ºï¼Œå¿…é¡»åŒ…å«ä¸€ä¸ªå­æ¡ä»¶</li><li><em>anyOf</em>ï¼šç”¨äºæŒ‡å®šåµŒå¥—æ¡ä»¶æœ‰ä¸€ä¸ªä¸º true æ—¶æ‰§è¡Œæ„å»ºï¼Œå¿…é¡»åŒ…å«ä¸€ä¸ªå­æ¡ä»¶</li></ul><p>è‡³äºåˆ†æ”¯è‡ªåŠ¨æ„å»ºï¼Œåœ¨é¡¹ç›®é…ç½®ä¸­ï¼ˆä¸‹å›¾ï¼‰å¯ä»¥è®¾ç½®å®šæ—¶æ‰«æï¼Œæˆ–ä½¿ç”¨å¯¹åº” SCM å¹³å°çš„ WebHook å®ç°æ¨é€åè‡ªåŠ¨æ„å»ºï¼Œåœ¨ä¼ ç»Ÿ freestyle é¡¹ç›®ä¹Ÿéƒ½æœ‰è¿™äº›é…ç½®ï¼Œå°±ä¸å†èµ˜è¿°ã€‚</p><figure><img src="/assets/pipeline-multi-branch-auto-build-DxUwelt9.jpeg" alt="é¡¹ç›®è‡ªåŠ¨æ„å»º" tabindex="0" loading="lazy"><figcaption>é¡¹ç›®è‡ªåŠ¨æ„å»º</figcaption></figure><h3 id="jenkinsfile-å¸¸ç”¨è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#jenkinsfile-å¸¸ç”¨è¯­æ³•"><span>Jenkinsfile å¸¸ç”¨è¯­æ³•</span></a></h3><h4 id="environment" tabindex="-1"><a class="header-anchor" href="#environment"><span>environment</span></a></h4><p>ç”¨äºæŒ‡å®šç¯å¢ƒå˜é‡ï¼Œå¯åœ¨ <code>pipeline/stage</code> å—ä½¿ç”¨ï¼Œå¹¶èƒ½ä¸ <em>credentials()</em> è”åˆï¼Œé€šè¿‡å‡­è¯ ID è®¿é—®å‡­è¯ã€‚</p><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent any</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    environment {</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        CC</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;clang&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Example credential&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            environment {</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                SERVICE_CREDS</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;"> credentials</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;credential-id&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;echo &quot;cc = $CC&quot;&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;echo cc = </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.CC</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   						    // å¯é€šè¿‡ env å…¨å±€å˜é‡è®¿é—®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;echo &quot;Credential is $SERVICE_CREDS&quot;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;echo &quot;Service user is $SERVICE_CREDS_USR&quot;&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      // è·å–å‡­è¯ä¸­çš„ username</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;echo &quot;Service password is $SERVICE_CREDS_PSW&quot;&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // è·å–å‡­è¯ä¸­çš„ password</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;printenv&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                       // æ‰“å°æ‰€æœ‰ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;echo job_name = $JOB_NAME&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                      // ç¯å¢ƒå˜é‡è®¿é—®æ–¹å¼ä¸€</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;echo job_branch = ${BRANCH_NAME}&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">               // ç¯å¢ƒå˜é‡è®¿é—®æ–¹å¼äºŒ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="parameters" tabindex="-1"><a class="header-anchor" href="#parameters"><span>parameters</span></a></h4><p>è¯¥æŒ‡ä»¤ç”¨äºæŒ‡å®šç”¨æˆ·åœ¨è§¦å‘ Pipeline æ—¶åº”æä¾›çš„å‚æ•°åˆ—è¡¨ï¼ˆå³ä¼ ç»Ÿ freestyle é¡¹ç›®çš„ <em>Build with Parameters</em>)ï¼Œè¿™äº›å‚æ•°çš„å€¼å¯é€šè¿‡ <code>params</code> å¯¹è±¡åœ¨ Pipeline æ­¥éª¤ä¸­è¿›è¡Œè®¿é—®ã€‚</p><p>æ¯ä¸ªå‚æ•°éƒ½åŒ…å«ä¸‰ä¸ªå±æ€§ï¼š<code>nameã€defaultValueã€description</code>ï¼Œå‚æ•°ç±»å‹å¦‚ä¸‹ï¼š</p><ul><li><code>string</code>ï¼šå­—ç¬¦ä¸²</li><li><code>text</code>ï¼šæ–‡æœ¬ï¼Œå¯åŒ…å«å¤šè¡Œ</li><li><code>booleanParam</code>ï¼šå¸ƒå°”å‚æ•°</li><li><code>choice</code>ï¼šé€‰æ‹©å‚æ•°</li><li><code>password</code>ï¼šå¯†ç  <ul><li>Jenkins ä¼šå°†æ­¤å‚æ•°æ ‡è®°ä¸ºæ•æ„Ÿæ•°æ®ï¼Œä¼šè§¦å‘ä¸€äº›å®‰å…¨æœºåˆ¶ï¼šå°è¯•åœ¨æ„å»ºæ—¥å¿—ä¸­å±è”½è¯¥å€¼ã€é™åˆ¶è¯¥å€¼å¦‚ä½•è¢«æŸäº› Pipeline æ­¥éª¤å®ä¾‹åŒ–æˆ–ä½¿ç”¨ç­‰</li><li><a href="https://www.jenkins.io/doc/book/pipeline/jenkinsfile/#handling-credentials" target="_blank" rel="noopener noreferrer">Credentials</a>æ˜¯è¯¥å‚æ•°åœ¨åŠŸèƒ½ä¸Šçš„ä¸Šä½æ›¿ä»£ï¼Œå…³äºå‡­è¯ã€æ•æ„Ÿæ•°æ®å¤§å¤šæ˜¯é…ç½®äº Credentials ä¸€èµ·ç®¡ç†ï¼Œpassword æ¯”è¾ƒä¾§é‡äº UI è¾“å…¥æ—¶çš„è§†è§‰ä¿å¯†å’Œä¸´æ—¶æ€§ã€åŠæ•æ„Ÿæ€§çš„ä¿¡æ¯è¾“å…¥</li></ul></li></ul><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent any</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    parameters {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;BUILD_ADMIN&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">defaultValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Mr. Jenkins&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">description</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Build User&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        text</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;REMARK&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">defaultValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">description</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Enter some information about the build&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        booleanParam</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;TOGGLE&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">defaultValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">description</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Toggle this value&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // choice æ¯”è¾ƒç‰¹æ®Šï¼Œchoices åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªé€‰é¡¹æ‰æ˜¯é»˜è®¤é€‰æ‹©</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        choice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;BUILD_ENV&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">choices</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;DEV&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;TEST&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;PROD&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">description</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Build environment&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;PASSWORD&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">defaultValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;SECRET&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">description</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Enter a password&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;TEST&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Hello </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">params.BUILD_ADMIN</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;REMARK: </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">params.REMARK</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Toggle: </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">params.TOGGLE</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;BUILD_ENV: </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">params.BUILD_ENV</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;PASSWORD: </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">params.PASSWORD</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç”¨ä¸Šè¿°è„šæœ¬åˆ›å»ºä¸€ä¸ªé¡¹ç›®åï¼Œå¯ä»¥çœ‹åˆ°å·¦ä¾§å‡ºç° <em>Build With Parameters</em>ï¼Œç‚¹å‡»å³å¯è¿›è¡Œå‚æ•°è®¾ç½®ã€‚</p><figure><img src="/assets/pipeline-buildWithParams-D_MYszBq.jpeg" alt="åŸºäºå‚æ•°æ„å»º" tabindex="0" loading="lazy"><figcaption>åŸºäºå‚æ•°æ„å»º</figcaption></figure><h4 id="options" tabindex="-1"><a class="header-anchor" href="#options"><span>options</span></a></h4><p>è¯¥æŒ‡ä»¤æ”¯æŒä» Pipeline æœ¬èº«ä¸­é…ç½®ç‰¹å®šäº Pipeline çš„é€‰é¡¹ï¼Œå¦‚ï¼š</p><ul><li><strong>disableConcurrentBuilds</strong>ï¼šä¸å…è®¸å¹¶å‘æ‰§è¡Œæµæ°´çº¿ï¼Œå¯ç”¨äºé˜²æ­¢åŒæ—¶è®¿é—®å…±äº«èµ„æºç­‰åœºæ™¯</li><li><strong>skipStagesAfterUnstable</strong>ï¼šä¸€æ—¦æ„å»ºçŠ¶æ€å˜ä¸º <em>UNSTABLE</em>ï¼Œåˆ™åç»­é˜¶æ®µå°†ä¸å†æ‰§è¡Œ</li><li><strong>retry</strong>ï¼šåœ¨å¤±è´¥æ—¶, é‡æ–°å°è¯•æ•´ä¸ªæµæ°´çº¿çš„æŒ‡å®šæ¬¡æ•°</li><li><strong>timeout</strong>ï¼šè®¾ç½®æµæ°´çº¿è¿è¡Œçš„è¶…æ—¶æ—¶é—´, åœ¨æ­¤ä¹‹åï¼ŒJenkinså°†ä¸­æ­¢æµæ°´çº¿</li><li>å…¶å®ƒè¯¦è§<a href="https://www.jenkins.io/doc/book/pipeline/syntax/#options" target="_blank" rel="noopener noreferrer">å®˜æ–‡</a></li></ul><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent any</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    options {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        disableConcurrentBuilds</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        skipStagesAfterUnstable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        timeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">unit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;HOURS&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ„å»ºè¶…æ—¶æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        retry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)            			 </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æœ€å¤šå°è¯•æ„å»º 1+3 æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Test&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps { </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                //...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            options {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                // timeout/retry ä¹Ÿå¯ç”¨åœ¨ stage ä¸­ä½¿ç”¨ï¼Œé’ˆå¯¹äºæ‰€åœ¨é˜¶æ®µèµ·ä½œç”¨</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                timeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">unit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;MINUTES&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                retry (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)                </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ... å…¶å®ƒæŒ‡ä»¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="triggers" tabindex="-1"><a class="header-anchor" href="#triggers"><span>triggers</span></a></h4><p>è§¦å‘å™¨æŒ‡ä»¤å®šä¹‰é‡æ–°è§¦å‘ Pipeline çš„è‡ªåŠ¨åŒ–æ–¹å¼ï¼Œå¯ç”¨è§¦å‘å™¨æœ‰ï¼š</p><ul><li><strong>cron</strong>ï¼šæ¥å— <a href="https://www.jenkins.io/doc/book/pipeline/syntax/#cron-syntax" target="_blank" rel="noopener noreferrer">cron</a> æ ·å¼å­—ç¬¦ä¸²ä»¥å®šä¹‰åº”é‡æ–°è§¦å‘ Pipeline çš„å›ºå®šé—´éš”ï¼Œå¦‚ï¼š<code>triggers { cron(&#39;H */4 * * 1-5&#39;) }</code></li><li><strong>pollSCM</strong>ï¼šåŒæ ·æ¥æ”¶ cron æ ·å¼å­—ç¬¦ä¸²ï¼Œåœ¨å›ºå®šé—´éš”ä¸­ï¼ŒJenkins ä¼šæ£€æŸ¥ SCM æ˜¯å¦æœ‰æ›´æ–°ï¼Œæœ‰åˆ™ä¼šé‡æ–°è§¦å‘ Pipeline</li><li><strong>upstream</strong>ï¼šæ¥å—ä»¥é€—å·åˆ†éš”çš„ä½œä¸šåç§°å’Œé˜ˆå€¼ã€‚å½“ä»»ä¸€ä½œä¸šä»¥æœ€å°é˜ˆå€¼å®Œæˆæ—¶ï¼Œå°†é‡æ–°è§¦å‘ Pipelineã€‚è¯¥æ–¹å¼è·Ÿä»¥å¾€ Freestyle é¡¹ç›®çš„ <em>Build Triggers =&gt; Build after other projects are built</em> å…¶å®æ˜¯åŒä¸ªä½œç”¨ï¼Œå½“ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„ã€Œä¸Šæ¸¸ ï¼ˆupstreamï¼‰ã€é¡¹ç›®æˆåŠŸæ„å»ºï¼ˆæˆ–å…¶ä»–æŒ‡å®šçŠ¶æ€ï¼‰åï¼Œè‡ªåŠ¨è§¦å‘å½“å‰é¡¹ç›®çš„æ„å»ºï¼Œå¯ç”¨åœºæ™¯å¦‚ä¸‹ï¼š <ol><li>ä¾èµ–æ„å»ºï¼šè‹¥ B é¡¹ç›®ä¾èµ–äºé¡¹ç›® A äº§ç”Ÿçš„æ„ä»¶ï¼ˆå¦‚ä¸€ä¸ªåº“ã€ä¸€ä¸ª API ä¾èµ–ï¼‰ï¼Œå½“é¡¹ç›® A æˆåŠŸæ„å»ºåï¼Œé¡¹ç›® B æ‰åº”è¯¥è¢«æ„å»ºï¼Œé‚£ä¹ˆé¡¹ç›® B çš„æµæ°´çº¿å°±å¯ä»¥è®¾ç½® upstream ä¸ºé¡¹ç›® A</li><li>æ„å»ºæµæ°´çº¿æ‹†åˆ†ï¼šä¸€ä¸ªéå¸¸å¤æ‚å’Œè€—æ—¶çš„æ„å»º/éƒ¨ç½²æµç¨‹å¯èƒ½è¢«æ‹†åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„ Jenkins Pipelineï¼Œä»¥æé«˜æ¨¡å—åŒ–ã€å¯ç®¡ç†æ€§å’Œå¹¶è¡Œæ€§</li><li>è§¦å‘ä¸åŒç±»å‹çš„ä»»åŠ¡ï¼šä¸€ä¸ªä¸Šæ¸¸é¡¹ç›®å¯èƒ½æ˜¯ç¼–è¯‘å’Œå•å…ƒæµ‹è¯•ï¼ŒæˆåŠŸåè§¦å‘ä¸€ä¸ªä¸‹æ¸¸é¡¹ç›®è¿›è¡Œæ›´è€—æ—¶çš„é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•æˆ–å®‰å…¨æ‰«æ</li><li>æ‰‡å‡ºæ„å»ºï¼šè¿™ç§åœºæ™¯å¯èƒ½æ¯”è¾ƒå¸¸è§ï¼Œä¸€ä¸ªæ ¸å¿ƒåº“æ›´æ–°åï¼Œå¤šä¸ªä¾èµ–äºå®ƒçš„é¡¹ç›®éƒ½éœ€è¦é‡æ–°æ„å»º</li></ol></li></ul><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent any</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    triggers {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        cron</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;H */4 * * 1-5&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        pollSCM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;H */4 * * 1-5&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å¯å¡«é˜ˆå€¼ï¼šSUCCESSã€UNSTABLEã€FAILUREï¼Œå¡«å†™ FAILURE è¡¨ç¤ºæ„å»ºçŠ¶æ€ä¸º SUCCESSã€UNSTABLEã€FAILURE æ—¶éƒ½æ˜¯ç¬¦åˆè¦æ±‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        upstream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">upstreamProjects</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;job_name1,job_name2&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">threshold</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">hudson.model.Result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">SUCCESS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ... å…¶å®ƒæŒ‡ä»¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="tools" tabindex="-1"><a class="header-anchor" href="#tools"><span>tools</span></a></h4><p>ç”¨äºå®šä¹‰å’Œä½¿ç”¨ Jenkins <em>Manage Jenkins =&gt; Tools</em> ä¸‹çš„å·¥å…·ï¼Œä¸»è¦æ”¯æŒ JDKã€Mavenã€Gradleã€‚</p><p>æ¯”å¦‚åœ¨ Tools ä¸­é…ç½®äº† Mavenï¼Œåˆ™ Jenkinsfile å¯ä»¥å†™ï¼š</p><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent any</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    tools {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        maven </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;custom-maven-name&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // Tools ä¸­å®šä¹‰çš„ Maven åç§°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Example&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;mvn --version&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   // å‘½ä»¤çš„æ‰§è¡Œå°†ä¼šä½¿ç”¨ä¸Šæ–¹æŒ‡å®šçš„ Maven ç¯å¢ƒ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ... å…¶å®ƒæŒ‡ä»¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="input" tabindex="-1"><a class="header-anchor" href="#input"><span>input</span></a></h4><p>è¯¥æŒ‡ä»¤åœ¨æ‰§è¡Œæ„å»ºæ—¶ä¸ Jenkins ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œå½“ <code>steps</code> å—åŒ…å«è¯¥æŒ‡ä»¤æ—¶ï¼Œä¼šåœ¨åº”ç”¨ <a href="#options">options</a> æŒ‡ä»¤åï¼Œæ‰§è¡Œ agent / <a href="#when">when</a> æŒ‡ä»¤ä¹‹å‰æš‚åœå½“å‰é˜¶æ®µã€‚</p><p>åŒ…å«ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><em>message</em>ï¼šå¿…å¡«ï¼Œå¡«å†™ input è¡¨å•æ—¶çš„å±•ç¤ºå†…å®¹</li><li><em>id</em>ï¼šå¯é€‰ï¼Œinput æŒ‡ä»¤çš„æ ‡è¯†ç¬¦ï¼Œé»˜è®¤ä¸º <code>stage</code> åç§°</li><li><em>ok</em>ï¼šå¯é€‰ï¼Œinput è¡¨å•çš„ <em>ok</em> æŒ‰é’®æ–‡æœ¬</li><li><em>submitter</em>ï¼šå¯é€‰ï¼ŒæŒ‡å®šå…è®¸æäº¤ input çš„ç”¨æˆ·æˆ–å¤–éƒ¨ç»„åç§°ï¼Œç®¡ç†å‘˜ä¸å—å½±å“ï¼ˆJenkins æƒé™é…ç½®éœ€å®‰è£… <em>Role-based Authorization Strategy</em> æ’ä»¶ï¼‰</li><li><em>submitterParameter</em>ï¼šå¯é€‰ï¼Œä¼šè¿”å›æäº¤ input çš„ç”¨æˆ· ID</li><li><em>parameters</em>ï¼šå¯é€‰ï¼Œæç¤ºç”¨æˆ·éœ€è¦æä¾›çš„å¯é€‰å‚æ•°åˆ—è¡¨</li></ul><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent any</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Example&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            input {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                message </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Should we continue?&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                ok </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Yes, we should.&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                submitter </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;alice, bob&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                submitterParameter </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SUBMITTER_ID&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                parameters {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                    string</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;PERSON&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">defaultValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Mr Jenkins&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">description</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Who should I say hello to?&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Hello, </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">PERSON</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">SUBMITTER_ID</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="/assets/pipeline-input-1-CBwz7cTm.png" alt="input-æ•ˆæœä¸€" tabindex="0" loading="lazy"><figcaption>input-æ•ˆæœä¸€</figcaption></figure><figure><img src="/assets/pipeline-input-2-D7sIt9Yk.png" alt="input-æ•ˆæœäºŒ" tabindex="0" loading="lazy"><figcaption>input-æ•ˆæœäºŒ</figcaption></figure><figure><img src="/assets/pipeline-input-3-aZ15_-nx.png" alt="input-æ•ˆæœä¸‰" tabindex="0" loading="lazy"><figcaption>input-æ•ˆæœä¸‰</figcaption></figure><figure><img src="/assets/pipeline-input-4-BJ-vBASK.png" alt="input-æ•ˆæœå››" tabindex="0" loading="lazy"><figcaption>input-æ•ˆæœå››</figcaption></figure><h2 id="åˆ†å¸ƒå¼æ„å»º" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼æ„å»º"><span>åˆ†å¸ƒå¼æ„å»º</span></a></h2><h3 id="æ§åˆ¶å™¨éš”ç¦»" tabindex="-1"><a class="header-anchor" href="#æ§åˆ¶å™¨éš”ç¦»"><span>æ§åˆ¶å™¨éš”ç¦»</span></a></h3><p>Jenkins æœåŠ¡å±äº <strong>Controller/Agent</strong> æ¶æ„ï¼ŒæœåŠ¡è‡ªå¸¦ä¸€ä¸ª**å†…ç½®èŠ‚ç‚¹ï¼ˆbuilt-in nodeï¼‰**ç”¨äºæ‰§è¡Œæ„å»ºæ“ä½œï¼Œå¼€ç®±å³ç”¨ã€‚è¿™æ˜¯ä¸ºäº†æ›´å®¹æ˜“ä½¿ç”¨ Jenkinsï¼Œä½†å¹¶ä¸æ¨èé•¿ä¹…ä½¿ç”¨ï¼Œå› ä¸ºåœ¨å†…ç½®èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ä»»ä½•æ„å»ºéƒ½å…·æœ‰ä¸ Jenkins è¿›ç¨‹ç›¸åŒçš„æ§åˆ¶å™¨æ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™çº§åˆ«ã€‚</p><p>Jenkins <strong>æ§åˆ¶å™¨</strong>å°±æ˜¯å…¶æœåŠ¡æœ¬èº«ï¼Œå……å½“å†³å®šå¦‚ä½•ã€ä½•æ—¶ä»¥åŠåœ¨ä½•å¤„è¿è¡Œä½œä¸šçš„è§’è‰²ã€‚åŒæ—¶ï¼Œé…ç½®ã€æˆæƒå’Œèº«ä»½éªŒè¯ç­‰ç®¡ç†ä»»åŠ¡ä¹Ÿåœ¨æ§åˆ¶å™¨ä¸Šæ‰§è¡Œï¼Œè¯¥æ§åˆ¶å™¨ä¸º HTTP è¯·æ±‚æä¾›æœåŠ¡ã€‚</p><p>è€Œ<strong>ä»£ç†</strong>æ˜¯è´Ÿè´£æ‰§è¡Œå…·ä½“ä½œä¸šçš„æœåŠ¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªå°å‹ Java å®¢æˆ·ç«¯è¿›ç¨‹ï¼Œä¸ Jenkins æ§åˆ¶å™¨å»ºç«‹è¿æ¥åï¼Œç”±æ§åˆ¶å™¨å§”æ‰˜ä½œä¸šç»™å…¶æ‰§è¡Œã€‚</p><p>è€Œåœ¨å†…ç½®èŠ‚ç‚¹å’Œä»£ç†èŠ‚ç‚¹ä¸­ï¼Œéƒ½æœ‰å„è‡ªçš„ <strong>Executorï¼ˆæ‰§è¡Œå™¨ï¼‰</strong>ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå…¶æ•°é‡å†³å®šäº†å¯ä»¥å¹¶å‘è¿è¡Œçš„ä»»åŠ¡æ•°é‡ã€‚</p><p>ä¸ºäº†ç¡®ä¿ Jenkins æ§åˆ¶å™¨çš„ç¨³å®šæ€§ï¼Œåº”åœ¨å†…ç½®èŠ‚ç‚¹ä»¥å¤–çš„å…¶å®ƒèŠ‚ç‚¹ä¸Šï¼ˆå³ä»£ç†ï¼‰æ‰§è¡Œæ„å»ºï¼Œè¿™åœ¨ Jenkins ä¸­ç§°ä¸º<a href="https://www.jenkins.io/doc/book/scaling/architecting-for-scale/" target="_blank" rel="noopener noreferrer"><strong>åˆ†å¸ƒå¼æ„å»º</strong></a>ï¼ˆdistributed buildsï¼‰ã€‚</p><p>åˆ†å¸ƒå¼æ„å»ºçš„å­˜åœ¨æ„ä¹‰æ˜¯ä¸ºäº†è§£å†³ä¸¤ç§æƒ…å†µï¼š</p><ul><li><strong>å‚ç›´å¢é•¿</strong>ï¼šæ˜¯æŒ‡é€šè¿‡é…ç½®æ›´å¤šä½œä¸šæˆ–ç¼–æ’æ›´é¢‘ç¹çš„æ„å»ºæ¥å¢åŠ  Jenkins æ§åˆ¶å™¨å®ä¾‹ä¸Šçš„è´Ÿè½½ï¼Œè¿™ä¹Ÿå¯èƒ½æ„å‘³ç€æ›´å¤šçš„å›¢é˜Ÿä¾èµ–äºè¿™ä¸ªæ§åˆ¶å™¨ï¼ˆå•ç‚¹é£é™©ï¼‰ï¼›</li><li><strong>æ°´å¹³å¢é•¿</strong>ï¼šæ˜¯æŒ‡åˆ›å»ºé¢å¤–çš„ Jenkins æ§åˆ¶å™¨ï¼ˆå³è¿è¡Œå¤šä¸ª Jenkins æœåŠ¡ï¼‰æ¥é€‚åº”æ–°çš„å›¢é˜Ÿæˆ–é¡¹ç›®ï¼Œè€Œä¸æ˜¯å‘ç°æœ‰æ§åˆ¶å™¨æ·»åŠ æ–°çš„å›¢é˜Ÿæˆ–é¡¹ç›®ï¼ˆåˆ†å¼€ä½†ç¼ºä¹ç»Ÿä¸€ç®¡ç†ï¼‰ã€‚</li></ul><p>åœ¨åˆ†å¸ƒå¼æ„å»ºç¯å¢ƒä¸­ï¼ŒJenkins æ§åˆ¶å™¨å°†ä»…ä½¿ç”¨å…¶èµ„æºæ¥å¤„ç† HTTP è¯·æ±‚å’Œç®¡ç†æ„å»ºç¯å¢ƒã€‚æ„å»ºçš„å®é™…æ‰§è¡Œå°†å§”æ‰˜ç»™ä»£ç†ã€‚ä½¿ç”¨æ­¤é…ç½®ï¼Œå¯ä»¥æ°´å¹³æ‰©å±•æ¶æ„ï¼Œä»è€Œå…è®¸å•ä¸ª Jenkins å®‰è£…æ‰˜ç®¡å¤§é‡é¡¹ç›®å’Œæ„å»ºç¯å¢ƒã€‚</p><p>è¦é˜²æ­¢æ„å»ºç›´æ¥åœ¨å†…ç½®èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå¯å¯¼èˆªè‡³ Jenkis çš„ <em>Manage Jenkins =&gt; Nodes</em>ã€‚åœ¨åˆ—è¡¨ä¸­é€‰æ‹© <em>Built-In Node =&gt; Configure</em>ã€‚å°† executor æ•°é‡è®¾ç½®ä¸º 0 å¹¶ä¿å­˜ã€‚åŒæ—¶<strong>åº”ç¡®ä¿å·²è®¾ç½®äº†å…¶å®ƒæ„å»ºèŠ‚ç‚¹</strong>ï¼ˆæˆ– Cloudï¼‰å¾—ä»¥æ‰§è¡Œæ„å»ºï¼Œå¦åˆ™æ„å»ºå°†æ— æ³•æ‰§è¡Œã€‚æˆ–è€…åœ¨é…ç½®äº†å¤šèŠ‚ç‚¹åï¼Œå¯ä½¿ç”¨ <a href="https://plugins.jenkins.io/job-restrictions/" target="_blank" rel="noopener noreferrer">Job Restrictions Plugin</a> ä¹‹ç±»çš„æ’ä»¶æ¥é™åˆ¶å“ªäº› Job å¯ä»¥åœ¨å“ªäº›èŠ‚ç‚¹ï¼ˆå¦‚å†…ç½®èŠ‚ç‚¹ï¼‰ä¸Šè¿è¡Œï¼ˆè¿™ä¸ Jenkinsfile ä¸­çš„ <code>agent { label ... }</code> é€šè¿‡æ ‡ç­¾æŒ‡å®šæ„å»ºèŠ‚ç‚¹çš„è¡¨è¾¾å¼æ— å…³ï¼‰ã€‚</p><blockquote><p>noteï¼šåœ¨ Jenkins ä¸­ï¼ŒAgentï¼ˆä»£ç†ï¼‰ä¹Ÿå¯ç§°ä¸º Nodeï¼ˆèŠ‚ç‚¹ï¼‰ï¼Œä¸¤è€…ç­‰ä»·ã€‚</p></blockquote><h3 id="é…ç½®ä»£ç†" tabindex="-1"><a class="header-anchor" href="#é…ç½®ä»£ç†"><span>é…ç½®ä»£ç†</span></a></h3><p>ä»£ç†æœ¬è´¨æ˜¯ä¸€ä¸ª Java æœåŠ¡ï¼Œå› æ­¤éœ€è¦æœ‰ JDK ç¯å¢ƒï¼Œä¸è¿‡ä¸‹é¢ä»¥ Docker ä¸ºä¾‹è¿è¡Œä»£ç†ï¼Œå®˜æ–¹é•œåƒå·²åŒ…å«äº† JDK ç¯å¢ƒã€‚</p><ol><li>é¦–å…ˆåœ¨è¦è¿è¡Œä»£ç†çš„æœºå™¨ä¸Šç”Ÿæˆå¯†é’¥ï¼š<code>ssh-keygen -f ~/.ssh/jenkins_agent_key</code></li><li>åœ¨ Jenkins GUI ä¸­åˆ›å»º Credentials <ul><li>åœ¨ <em>Manage Jenkins =&gt; Credentials</em> é€‰æ‹© domains ä¸º global çš„é€‰é¡¹æ–°å»ºå‡­è¯</li><li><em>Kind</em> é€‰æ‹© <em>SSH Username with private key</em>ï¼Œè‡ªç”±å¡«å…¥ <em>ID</em>ã€<em>Description</em>ã€<em>Username</em>ï¼Œ<em>Private Key</em> åˆ™ç›´æ¥æ‹·è´æ­¥éª¤ 1 ç”Ÿæˆå¯†é’¥ï¼Œ<em>Passphrase</em> æ˜¯å¯†ç ï¼Œç”Ÿæˆå¯†é’¥æ—¶æœ‰å¡«åˆ™å¡«ï¼Œæ— åˆ™å¿½ç•¥ï¼Œç„¶ååˆ›å»ºå‡­è¯å³å¯ã€‚</li></ul></li><li>è¿è¡Œä»£ç†ï¼Œå®¿ä¸»æœºç«¯å£å¯è‡ªå®šä¹‰ï¼š</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name=agent1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 22:22</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;JENKINS_AGENT_SSH_PUBKEY=[æ‹·è´æ­¥éª¤ 1 ç”Ÿæˆçš„å…¬é’¥]&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">jenkins/ssh-agent:alpine-jdk21</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="4"><li>åœ¨ Jenkins ä¸Šè®¾ç½®ä»£ç† <ul><li>è¿›å…¥ <em>Manage Jenkins =&gt; Nodes</em> æ–°å»ºèŠ‚ç‚¹ï¼Œè¾“å…¥èŠ‚ç‚¹åç§°å¹¶é€‰æ‹©ç±»å‹ï¼ˆä»…æœ‰ <em>Permanent Agent</em> å¯é€‰ï¼‰</li><li>è¯¦ç»†é…ç½®ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè€Œå›¾äºŒå…³äº Agent å¯åŠ¨æ–¹å¼ï¼š <ul><li><em>Launch agents via SSH</em>ï¼šé€šè¿‡ Jenkins æ§åˆ¶å™¨è®¿é—® Agent æ‰€åœ¨æœºå™¨åå¯åŠ¨ä»£ç†æœåŠ¡ï¼ˆå³è¿æ¥æ­¥éª¤ 3 å¯åŠ¨çš„å®¹å™¨ï¼‰ï¼Œç„¶åä»£ç†æœåŠ¡å†ä¸æ§åˆ¶å™¨è¿›è¡Œè¿æ¥</li><li><em>Launch agent by connecting it to the controller</em>ï¼šæ‰‹åŠ¨å¯åŠ¨ Agent æœåŠ¡åï¼Œç›´æ¥è¿æ¥åˆ° Jenkins æ§åˆ¶å™¨ï¼Œè¯¥æ–¹å¼å¯çœ‹<a href="https://www.jenkins.io/doc/book/managing/nodes/#launch-inbound-agent-via-windows-scheduler" target="_blank" rel="noopener noreferrer">å®˜æ–‡</a></li></ul></li></ul></li></ol><figure><img src="/assets/pipeline-agent-1-Cr1g5Bm-.jpeg" alt="agent-é…ç½®ä¸€" tabindex="0" loading="lazy"><figcaption>agent-é…ç½®ä¸€</figcaption></figure><figure><img src="/assets/pipeline-agent-2-CBNlxlaz.jpeg" alt="agent-é…ç½®äºŒ" tabindex="0" loading="lazy"><figcaption>agent-é…ç½®äºŒ</figcaption></figure><ol start="5"><li>èŠ‚ç‚¹æ–°å»ºåï¼Œä¼šé»˜è®¤å¯åŠ¨ä¸€æ¬¡ï¼Œä½†ä¼šå› ä¸ºå¯†é’¥æˆæƒé—®é¢˜è€Œå¤±è´¥ã€‚é€‰æ‹©èŠ‚ç‚¹è¿›å…¥ç®¡ç†ç•Œé¢ï¼Œç‚¹å‡»å·¦ä¾§çš„ <em>Trust SSH Host Key</em> ä¿¡ä»»å¯†é’¥ï¼ˆå³æ­¥éª¤ 4 è®¾ç½®çš„å¯†é’¥ç¡®è®¤æ–¹å¼ï¼‰ï¼Œå³ä¸Šè§’ <em>Launch agent</em> å†æ¬¡å¯åŠ¨å³å¯</li></ol><figure><img src="/assets/pipeline-agent-3-C3_c24Ki.jpeg" alt="agent-ä¿¡ä»»å¯†é’¥" tabindex="0" loading="lazy"><figcaption>agent-ä¿¡ä»»å¯†é’¥</figcaption></figure><ol start="6"><li>é‡æ–°æ„å»ºé¡¹ç›®ï¼šåœ¨æµæ°´çº¿é¡¹ç›®çš„ Jenkinsfile ä¸­æŒ‡å®š <code>agent { label &#39;agent-1&#39; }</code> åï¼Œåœ¨æ„å»ºæ—¥å¿—å³å¯çœ‹åˆ°æ„å»ºæ“ä½œå§”æ‰˜åˆ° Agent å»æ‰§è¡Œäº†ã€‚</li></ol><figure><img src="/assets/pipeline-agent-4-DP5Iqeaq.jpeg" alt="agent-æ—¥å¿—æ‰“å°" tabindex="0" loading="lazy"><figcaption>agent-æ—¥å¿—æ‰“å°</figcaption></figure><figure><img src="/assets/pipeline-agent-5-BIh_-7ch.jpeg" alt="agent-æ„å»ºèŠ‚ç‚¹å±•ç¤º" tabindex="0" loading="lazy"><figcaption>agent-æ„å»ºèŠ‚ç‚¹å±•ç¤º</figcaption></figure><h2 id="jenkinsfile-ä¸ä»£ç åˆ†ç¦»ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#jenkinsfile-ä¸ä»£ç åˆ†ç¦»ç®¡ç†"><span>Jenkinsfile ä¸ä»£ç åˆ†ç¦»ç®¡ç†</span></a></h2><p>Jenkins Pilelineï¼ˆåŒ…æ‹¬å¤šåˆ†æ”¯ Pipelineï¼‰é¡¹ç›®è¦æ±‚å°† Jenkinsfile ä¿å­˜åœ¨ä»£ç ä»“åº“çš„æ ¹ç›®å½•ï¼Œè¿™è®© Jenkinsfile åˆ†æ•£åˆ°äº†ä¸åŒé¡¹ç›®çš„å„ä¸ªåˆ†æ”¯ä¸­ï¼Œå¯¹äºåæœŸçš„ç»Ÿä¸€ç»´æŠ¤å’ŒåŠŸèƒ½æ‰©å±•å¢åŠ äº†æˆæœ¬ã€‚ä¸ºäº†å°† Jenkinsfile ä¸ä»£ç ä»“åº“åˆ†ç¦»ï¼Œå¯é€šè¿‡æ’ä»¶ <a href="https://github.com/jenkinsci/pipeline-multibranch-defaults-plugin" target="_blank" rel="noopener noreferrer">Pipeline-multibranch-defaults-plugin</a> å®ç°ã€‚</p><ol><li>å®‰è£…æ’ä»¶åï¼Œè¿›å…¥ <em>Manage Jenkins =&gt; Managed files</em> æ–°å»ºé…ç½® <em>Groovy file</em>ï¼ŒID å¯è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ UUIDï¼Œç„¶åç¼–å†™ Jenkinsfile è„šæœ¬</li><li>æ–°å»ºä¸€ä¸ªå¤šåˆ†æ”¯æµæ°´çº¿é¡¹ç›®ï¼Œæ³¨æ„æœ¬æ¬¡åœ¨ <em>Build Configuration =&gt; Mode</em> è¦é€‰æ‹© <em>by default Jenkinsfile</em>ï¼Œå¹¶å¡«å…¥æ­¥éª¤ 1 åˆ›å»ºçš„é…ç½®æ–‡ä»¶ ID</li></ol><figure><img src="/assets/pipeline-default-jenkinsfile-BQQy3Gm6.png" alt="æŒ‡å®šé»˜è®¤çš„ Jenkinsfile" tabindex="0" loading="lazy"><figcaption>æŒ‡å®šé»˜è®¤çš„ Jenkinsfile</figcaption></figure><ol start="3"><li>é¦–æ¬¡æ‰§è¡Œæ„å»ºå¯èƒ½ä¼šæŠ¥é”™ï¼ˆå¦‚ <code>UnapprovedUsageException: script not yet approved for use</code>ï¼‰ï¼Œè¿™æ˜¯å› ä¸ºé¡¹ç›®çš„ Jenkinsfile è‹¥ä» SCM ä¸­è·å–ï¼Œåˆ™é»˜è®¤åœ¨ Groovy æ²™ç®±ä¸­è¿è¡Œï¼Œä»¥é˜²æ­¢å‡ºç°æ¶æ„ä»£ç ã€‚è€Œä½¿ç”¨ default Jenkinsfile åˆ™å¹¶éå¦‚æ­¤ï¼Œå› ä¸º Jenkins è®¤ä¸ºåœ¨é…ç½®ç®¡ç†ä¸­ï¼ˆç”±ç®¡ç†å‘˜ï¼‰æ–°å¢çš„ Jenkinsfile ä¼šæ¯”æ¥æº SCM çš„æ›´å—ä¿¡ä»»ï¼Œå¹¶ä¸”ä¸ºäº†çµæ´»æ€§ï¼Œé¿å…æ²™ç®±ç¯å¢ƒä¸­æ“ä½œæƒé™å—é™ï¼Œä¼šåœ¨éæ²™ç®±ç¯å¢ƒä¸­è¿è¡Œã€‚ä½†æ˜¯ç”±äº <a href="https://github.com/jenkinsci/script-security-plugin" target="_blank" rel="noopener noreferrer">Script Security Plugin</a> æ’ä»¶ï¼ˆé»˜è®¤å®‰è£…ï¼‰ï¼Œå®ƒä¼šæ£€æŸ¥è„šæœ¬ä¸­çš„æ–¹æ³•ç­¾åæ˜¯å¦å·²å­˜åœ¨äºæ‰¹å‡†åˆ—è¡¨ï¼Œå¦åˆ™éœ€è¦ç®¡ç†å‘˜æ‰‹åŠ¨æ‰¹å‡†æ‰§è¡Œè„šæœ¬ã€‚ <ul><li>è¿›å…¥ <em>Manage Jenkins =&gt; In-process Script Approval</em> å³å¯çœ‹åˆ°è¢«æ‹¦æˆªçš„è„šæœ¬ï¼Œé€‰æ‹© Approve æ‰¹å‡†å³å¯ï¼Œé‡æ–°æ‰§è¡Œæ„å»ºå³å¯æˆåŠŸ</li><li>ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ­¥éª¤ 2 çš„ç¤ºä¾‹å›¾ä¸­å‹¾é€‰ <em>Run default Jenkinsfile within Groovy sandbox</em>ï¼Œè¡¨ç¤ºè®©é»˜è®¤çš„ Jenkinsfile è¿è¡Œåœ¨æ²™ç®±ï¼Œé‚£ä¹ˆå°±æ— éœ€è¿›è¡Œå®¡æ‰¹</li></ul></li></ol><figure><img src="/assets/pipeline-default-jenkinsfile-2-B78K_0gt.png" alt="é»˜è®¤ Jenkinsfile æ‰§è¡Œå®¡æ‰¹æ—¥å¿—" tabindex="0" loading="lazy"><figcaption>é»˜è®¤ Jenkinsfile æ‰§è¡Œå®¡æ‰¹æ—¥å¿—</figcaption></figure><ol start="4"><li>ä»¥ä¸‹æ˜¯ defualt Jenkinsfile çš„ç¤ºä¾‹ï¼Œä½†è¦æ ¹æ®å®é™…æƒ…å†µå»è°ƒæ•´è„šæœ¬ï¼Œæ— æ³• 1:1 å¤åˆ¶ä½¿ç”¨ <ul><li>åšæ³•ç†è§£ï¼šå‡è®¾åˆ›å»ºå¤šåˆ†æ”¯æµæ°´çº¿é¡¹ç›®åä¸º Demo-Testï¼Œç„¶ååœ¨ç®¡ç† Jenkinsfile çš„ä»“åº“ä¸‹åˆ›å»º Demo-Test/devã€Demo-Test/test ç­‰ç›®å½•ï¼Œä¸‹é¢æ”¾å„è‡ªåˆ†æ”¯çš„ Jenkinsfileï¼Œé€šè¿‡æ‹‰å– Jenkinsfile ä»“åº“åï¼Œä»¥æ„å»ºçš„ä½œä¸šåç§°å’Œåˆ†æ”¯æ¥åŠ è½½å¯¹åº” Jenkinsfileã€‚</li></ul></li></ol><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-groovy"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">node {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ä¿å­˜å½“å‰è¿è¡Œçš„ä½œä¸šåç§°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> currentJobName </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Checkout Jenkinsfile&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // è·å–å½“å‰ Job åç§°ï¼Œå¹¶èµ‹å€¼ç»™å±€éƒ¨å˜é‡ï¼Œé€šè¿‡ env è®¿é—®ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            def</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> jobNameParts </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.JOB_NAME</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">replace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;%2F&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // æ³¨æ„ï¼šè‹¥æµæ°´çº¿é¡¹ç›®æ˜¯å»ºåœ¨æ–‡ä»¶å¤¹ä¸‹ï¼Œé‚£ä¹ˆç›´æ¥å– 0 å°±æœ‰é—®é¢˜ï¼Œå› ä¸ºè·å–åˆ°çš„ä¼šæ˜¯ç›®å½•åç§°ï¼Œè€Œä¸æ˜¯ Job åç§°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            currentJobName </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> jobNameParts[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Determined job name part for loading: </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">currentJobName</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // 2. clone Jenkinsfile ä»“åº“</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            git </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;https://github.com/xxx.git&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å¡«å†™ Jenkinsfile ä»“åº“åœ°å€ï¼Œå¯ä»¥æ˜¯ HTTP æˆ– SSH</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                branch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;main&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,                      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æŒ‡å®šæ‹‰å–çš„åˆ†æ”¯ï¼Œé»˜è®¤æ˜¯ master</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                credentialsId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;jenkins&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">             // æŒ‡å®šè®¿é—® SCM çš„å‡­è¯ï¼Œåœ¨ Jenkins ä¸­é…ç½®åå¡«å†™å‡­è¯ ID</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Checkout complete.&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Load Dynamic Jenkinsfile&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // æ ¹æ® Job åç§°åŠæ„å»ºåˆ†æ”¯è·å–å¯¹åº” Jenkinsfile</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            def</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> check_groovy_file </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">currentJobName</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.BRANCH_NAME</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/Jenkinsfile&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            // load æŒ‡ä»¤ç”¨äºåŠ è½½ Jenkinsfile</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            load check_groovy_file</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> e) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å½“å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œå¹¶å°†æ„å»ºç»“æœè®¾ç½®ä¸º FAILURE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Pipeline failed: </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">e.getMessage()</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        currentBuild.result </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;FAILURE&#39;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> e       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œä½¿ Pipeline å¤±è´¥</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Cleanup&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Performing cleanup tasks...&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">            cleanWs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å¯é€‰ï¼šæ¸…ç†å·¥ä½œç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>note1ï¼šdefault Jenkinsfile ä¹‹æ‰€ä»¥ä½¿ç”¨è„šæœ¬å¼ç®¡é“è¯­æ³•ï¼Œæ˜¯å› ä¸ºå£°æ˜å¼ç®¡é“è¯­æ³•è§„å®šæœ‰ä¸”ä»…æœ‰ä¸€ä¸ª pipeline å—ï¼Œä½¿å…¶æ— æ³• load åŒæ ·åŒ…å« pipeline å—çš„ Jenkinsfileã€‚è€Œè„šæœ¬å¼è¯­æ³•æ²¡æœ‰æ­¤ç±»é™åˆ¶ï¼Œèƒ½å®¹çº³æ­¤ç±»è®¾è®¡ä¸ºç‹¬ç«‹è¿è¡Œçš„ Jenkinsfileï¼Œæ•…å¸¸ç”¨äºç¼–æ’ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨è¢« load çš„æ–‡ä»¶ä»…ç¼–å†™ stages/steps ç­‰æŒ‡ä»¤ä»è€Œå®ç°æ„å»ºã€‚</p><p>note2ï¼šå¦‚æœ default jenkinsfile æŒ‡å®šäº†è¿è¡Œçš„ Agentï¼Œé‚£ä¹ˆè¦æ³¨æ„ load åŠ è½½çš„ Jenkinsfile æ˜¯å¦ä¸ default Jenkinsfile åœ¨åŒä¸€ä¸ª Agent ä¸Šè¿è¡Œã€‚è‹¥æ˜¯ï¼Œå¹¶ä¸”è¯¥ Agent åªé…ç½®äº†ä¸€ä¸ª Executorï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆæ­»é”çš„æƒ…å†µï¼Œå› ä¸ºå¯¹äº Jenkins æ¥è¯´ï¼Œè¿™æ˜¯ä¸¤ä¸ªä»»åŠ¡ã€‚</p></blockquote><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h2><p>Jenkins Pipeline ä¸éš¾ç†è§£ï¼Œåœ¨æ˜ç™½äº†æ¦‚å¿µå’Œè¯­æ³•åï¼Œå°±å¯ä»¥ä¸Šæ‰‹å®æ“ã€‚Pipeline ä¹Ÿæ˜¯è®©æ„å»ºæµç¨‹æ›´åŠ ç»“æ„åŒ–ï¼Œå¹¶ä¸”èƒ½åƒä»£ç ä¸€æ ·å®¡è®¡ã€è¿­ä»£ã€‚å¯¹äºå®é™…é¡¹ç›®çš„ CI/CDï¼Œå…¶å®åœ¨æ„å»ºè¿‡ç¨‹ä¼šæ›´å¤šçš„ä¾èµ– bash è„šæœ¬ç­‰çš„æ“ä½œï¼Œå¦‚ä»£ç é•œåƒæ„å»ºã€æ¨é€ã€K8S éƒ¨ç½²ã€é€šçŸ¥ç­‰ç­‰ï¼Œæœ‰ä»€ä¹ˆæ„å»ºéœ€æ±‚ï¼Œå°±ç¿»ç¿»å®˜ç½‘æ–‡æ¡£ï¼Œçœ‹çœ‹æä¾›çš„æ“ä½œå³å¯ã€‚</p></div><!----><!----><!----></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/distribute/tcp.html" aria-label="TCP æ‚è°ˆ"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><iconify-icon class="vp-icon" icon="fluent:protocol-handler-24-regular" height="1em" sizing="height"></iconify-icon>TCP æ‚è°ˆ</div></a><!----></nav><div id="comment" class="waline-wrapper vp-comment" vp-comment darkmode="false" style="display:none;"><!----></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><!----><div class="vp-copyright">Copyright Â© 2020-2025 ğŸ¾ <a href="https://github.com/yudi-corgi">YUDI-Corgi</a> âœ¨ Licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" target="_blank">CC BY-SA 4.0</a></div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-C_r5yPSf.js" defer></script>
  </body>
</html>
