<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html"><meta property="og:site_name" content="Black Hole"><meta property="og:title" content="为什么 OAuth 在 2023 年仍然难以实现？"><meta property="og:description" content="分析 OAuth 本身的复杂问题和在实际应用中的难点"><meta property="og:type" content="article"><meta property="og:image" content="https://mister-hope.github.io/black-hole/assets/images/minions_cover8.jpg"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-05-25T05:49:19.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="为什么 OAuth 在 2023 年仍然难以实现？"><meta property="article:author" content="YUDI-Corgi"><meta property="article:tag" content="杂谈"><meta property="article:published_time" content="2023-10-07T00:00:00.000Z"><meta property="article:modified_time" content="2025-05-25T05:49:19.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"为什么 OAuth 在 2023 年仍然难以实现？","image":["https://mister-hope.github.io/black-hole/"],"datePublished":"2023-10-07T00:00:00.000Z","dateModified":"2025-05-25T05:49:19.000Z","author":[{"@type":"Person","name":"YUDI-Corgi","url":"https://github.com/yudi-corgi"}]}</script><title>为什么 OAuth 在 2023 年仍然难以实现？ | Black Hole</title><meta name="description" content="分析 OAuth 本身的复杂问题和在实际应用中的难点">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/black-hole/assets/style-92db8593.css" as="style"><link rel="stylesheet" href="/black-hole/assets/style-92db8593.css">
    <link rel="modulepreload" href="/black-hole/assets/app-507626cf.js"><link rel="modulepreload" href="/black-hole/assets/Why_is_OAuth_still_hard_in_2023.html-39ccec19.js"><link rel="modulepreload" href="/black-hole/assets/Why_is_OAuth_still_hard_in_2023.html-324b9925.js"><link rel="modulepreload" href="/black-hole/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/black-hole/assets/index.html-bbe78b8b.js" as="script"><link rel="prefetch" href="/black-hole/assets/intro.html-c28d1fd1.js" as="script"><link rel="prefetch" href="/black-hole/assets/enum_convert.html-76af88db.js" as="script"><link rel="prefetch" href="/black-hole/assets/distributed_transaction.html-744f72df.js" as="script"><link rel="prefetch" href="/black-hole/assets/jenkins_pipeline.html-f38fa82d.js" as="script"><link rel="prefetch" href="/black-hole/assets/tcp.html-94c2e437.js" as="script"><link rel="prefetch" href="/black-hole/assets/java-string.html-b8789cfd.js" as="script"><link rel="prefetch" href="/black-hole/assets/jdk7-HashMap.html-7594098c.js" as="script"><link rel="prefetch" href="/black-hole/assets/jdk8-HashMap.html-e4a97557.js" as="script"><link rel="prefetch" href="/black-hole/assets/jvm-class-loading-mechanism.html-9d027b95.js" as="script"><link rel="prefetch" href="/black-hole/assets/jvm-memory-model.html-bc2f0e88.js" as="script"><link rel="prefetch" href="/black-hole/assets/how_does_b-tree_make_your_queries_fast.html-7136d0c7.js" as="script"><link rel="prefetch" href="/black-hole/assets/is_it_time_to_ditch_mysql_and_postgresql_for_sqlite.html-6eac22dc.js" as="script"><link rel="prefetch" href="/black-hole/assets/sharded_does_not_imply_distributed.html-966fb2f2.js" as="script"><link rel="prefetch" href="/black-hole/assets/webSockets_vs_server-sent-events_vs_long-polling_vs_webrtc_vs_webtransport.html-7bd01cc2.js" as="script"><link rel="prefetch" href="/black-hole/assets/J2Cache.html-2516f7c3.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_cloud_stream_one.html-8beb9caf.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_cloud_stream_three.html-2ccdcf25.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_cloud_stream_two.html-199d5340.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_transaction_synchronization.html-2f432c7b.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_websocket_one.html-08b7a57a.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_websocket_two.html-a5104af4.js" as="script"><link rel="prefetch" href="/black-hole/assets/404.html-aa196cd5.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-335f7fc7.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-6d6defc7.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-684beaaa.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-c52289b7.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-85870eef.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-bd23ee84.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-44dbb568.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-9ad8fdeb.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-2a19d6b9.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-278e43a3.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-e36f8b60.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-1799ff65.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-5957c4ba.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-38c8b1e7.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-14fc1cf5.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-9ec965af.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-eb611ffa.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-83909ee3.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-be3ad531.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-714c6b54.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-c11b2b38.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-2c81aafd.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-78b21021.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-41c5dba9.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-d6349179.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-6625b8f5.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-abc62d6c.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-f9fd3a7f.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-21bc0081.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-a2af6c35.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-417073cf.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-d2016935.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-6594d76c.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-5b5b8630.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-cc5f604d.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-50f5d7a8.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-4bfca47a.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-4bd5e6de.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-0bcbeb91.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-81b85fea.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-5f7e68b6.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-c9e54dd3.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-0a4bb0e2.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-e1d15680.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-d8710d4b.js" as="script"><link rel="prefetch" href="/black-hole/assets/intro.html-bf28b5ff.js" as="script"><link rel="prefetch" href="/black-hole/assets/enum_convert.html-62557846.js" as="script"><link rel="prefetch" href="/black-hole/assets/distributed_transaction.html-71a939a0.js" as="script"><link rel="prefetch" href="/black-hole/assets/jenkins_pipeline.html-98d1f902.js" as="script"><link rel="prefetch" href="/black-hole/assets/tcp.html-b0a1f4d2.js" as="script"><link rel="prefetch" href="/black-hole/assets/java-string.html-d8272aa5.js" as="script"><link rel="prefetch" href="/black-hole/assets/jdk7-HashMap.html-7e0118fc.js" as="script"><link rel="prefetch" href="/black-hole/assets/jdk8-HashMap.html-b31edb3f.js" as="script"><link rel="prefetch" href="/black-hole/assets/jvm-class-loading-mechanism.html-70cc1413.js" as="script"><link rel="prefetch" href="/black-hole/assets/jvm-memory-model.html-711e2982.js" as="script"><link rel="prefetch" href="/black-hole/assets/how_does_b-tree_make_your_queries_fast.html-bbb63301.js" as="script"><link rel="prefetch" href="/black-hole/assets/is_it_time_to_ditch_mysql_and_postgresql_for_sqlite.html-dd180ed1.js" as="script"><link rel="prefetch" href="/black-hole/assets/sharded_does_not_imply_distributed.html-204b7e1e.js" as="script"><link rel="prefetch" href="/black-hole/assets/webSockets_vs_server-sent-events_vs_long-polling_vs_webrtc_vs_webtransport.html-77d7c6b8.js" as="script"><link rel="prefetch" href="/black-hole/assets/J2Cache.html-e1bf737f.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_cloud_stream_one.html-213dcbd1.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_cloud_stream_three.html-7b49909e.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_cloud_stream_two.html-f4c36d86.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_transaction_synchronization.html-901bdaac.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_websocket_one.html-a6a54078.js" as="script"><link rel="prefetch" href="/black-hole/assets/spring_websocket_two.html-8ec3e585.js" as="script"><link rel="prefetch" href="/black-hole/assets/404.html-8fc2878f.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-f5450e9b.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-aaf81327.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-8fb3ade9.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-44a56783.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-a52c028a.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-45b2fb75.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-d2cb5ac2.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-0b99ca24.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-c50be6cc.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-56b95713.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-2918834c.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-a5e8aaf8.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-1faf79dd.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-2ecd2c32.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-ce2f475b.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-6276674a.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-762ed8a3.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-cf92fa5c.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-97884799.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-1682ee8b.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-4061a920.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-1b36d084.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-85e49b23.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-cf60e821.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-551891bf.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-cc01c62f.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-25ab8470.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-43dba71f.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-06e0bab0.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-a7ec2e3b.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-b842c065.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-cedcf15d.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-fe556e29.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-eda8aa3e.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-8707d947.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-753f8321.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-168e234f.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-7f782b4e.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-219e3173.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-44b6c10a.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-3e6de8e1.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-fd29e915.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-8e20a093.js" as="script"><link rel="prefetch" href="/black-hole/assets/index.html-c1cf1f6b.js" as="script"><link rel="prefetch" href="/black-hole/assets/waline-meta-56fbc549.js" as="script"><link rel="prefetch" href="/black-hole/assets/component-d4664b1d.js" as="script"><link rel="prefetch" href="/black-hole/assets/auto-fe80bb03.js" as="script"><link rel="prefetch" href="/black-hole/assets/index-2bf332f6.js" as="script"><link rel="prefetch" href="/black-hole/assets/flowchart-c441f34d.js" as="script"><link rel="prefetch" href="/black-hole/assets/mermaid.core-2dc90ff4.js" as="script"><link rel="prefetch" href="/black-hole/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/black-hole/assets/markdown.esm-abe06b83.js" as="script"><link rel="prefetch" href="/black-hole/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/black-hole/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/black-hole/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/black-hole/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/black-hole/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/black-hole/assets/VuePlayground-c479a227.js" as="script"><link rel="prefetch" href="/black-hole/assets/photoswipe.esm-4e1eea98.js" as="script"><link rel="prefetch" href="/black-hole/assets/SearchResult-7dbea6a1.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/black-hole/"><img class="vp-nav-logo" src="/black-hole/logo.png" alt="Black Hole"><!----><span class="vp-site-name hide-in-pad">Black Hole</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="博客主页" class="vp-link nav-link nav-link" href="/black-hole/"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="home" width="1em" height="1em"></iconify-icon>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="精选文章"><span class="title"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="fluent-emoji-flat:star" width="1em" height="1em"></iconify-icon>精选文章</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-label="Spring 事务同步" class="vp-link nav-link nav-link" href="/black-hole/posts/framework/spring/spring_transaction_synchronization.html"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon>Spring 事务同步<!----></a></li><li class="dropdown-item"><a aria-label="深入浅出 String 字符串" class="vp-link nav-link nav-link" href="/black-hole/posts/java/java-string.html"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:field-string-outlined" width="1em" height="1em"></iconify-icon>深入浅出 String 字符串<!----></a></li><li class="dropdown-item"><a aria-label="Jenkins 流水线快速理解" class="vp-link nav-link nav-link" href="/black-hole/posts/distribute/jenkins_pipeline.html"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="vscode-icons:file-type-jenkins" width="1em" height="1em"></iconify-icon>Jenkins 流水线快速理解<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://xiaolincoding.com/interview/" rel="noopener noreferrer" target="_blank" aria-label="Java" class="nav-link"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon>Java<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="https://xiaolincoding.com/mysql/" rel="noopener noreferrer" target="_blank" aria-label="数据库" class="nav-link"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park:blocks-and-arrows" width="1em" height="1em"></iconify-icon>数据库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="关于作者" class="vp-link nav-link nav-link" href="/black-hole/intro.html"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="openmoji:black-hole" width="1em" height="1em"></iconify-icon>关于作者<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/yudi-corgi" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a aria-label="博客主页" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/black-hole/"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="home" width="1em" height="1em"></iconify-icon>博客主页<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="book" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="book" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="book" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">分布式领域</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="book" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">开发技巧</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="book" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">杂谈</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a aria-label="为什么 OAuth 在 2023 年仍然难以实现？" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:oauth" width="1em" height="1em"></iconify-icon>为什么 OAuth 在 2023 年仍然难以实现？<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="写在前头" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#写在前头"><!---->写在前头<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="为什么 2023 年 OAuth 仍然很难？ Why is OAuth still hard in 2023?" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#为什么-2023-年-oauth-仍然很难-why-is-oauth-still-hard-in-2023"><!---->为什么 2023 年 OAuth 仍然很难？ Why is OAuth still hard in 2023?<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="OAuth 实践 OAuth in practice" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#oauth-实践-oauth-in-practice"><!---->OAuth 实践 OAuth in practice<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="问题 1：OAuth 标准太大且复杂 Problem 1: The OAuth standard is just too big and complex" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#问题-1-oauth-标准太大且复杂-problem-1-the-oauth-standard-is-just-too-big-and-complex"><!---->问题 1：OAuth 标准太大且复杂 Problem 1: The OAuth standard is just too big and complex<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="问题 2：每个人的 OAuth 都有细微的差别 Problem 2: Everybody’s OAuth is different in subtle ways" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#问题-2-每个人的-oauth-都有细微的差别-problem-2-everybody-s-oauth-is-different-in-subtle-ways"><!---->问题 2：每个人的 OAuth 都有细微的差别 Problem 2: Everybody’s OAuth is different in subtle ways<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="问题 3：许多 API 向 OAuth 添加非标准扩展 Problem 3: Many APIs add nonstandard extensions to OAuth" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#问题-3-许多-api-向-oauth-添加非标准扩展-problem-3-many-apis-add-nonstandard-extensions-to-oauth"><!---->问题 3：许多 API 向 OAuth 添加非标准扩展 Problem 3: Many APIs add nonstandard extensions to OAuth<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="问题 4：“invalid_request”——调试 OAuth 流程很困难 Problem 4: “invalid_request” — debugging OAuth flows is hard" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#问题-4-invalid-request-——调试-oauth-流程很困难-problem-4-invalid-request-—-debugging-oauth-flows-is-hard"><!---->问题 4：“invalid_request”——调试 OAuth 流程很困难 Problem 4: “invalid_request” — debugging OAuth flows is hard<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="问题 5：基于 API 构建的审批繁琐 Problem 5: Cumbersome approvals to build on top of APIs" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#问题-5-基于-api-构建的审批繁琐-problem-5-cumbersome-approvals-to-build-on-top-of-apis"><!---->问题 5：基于 API 构建的审批繁琐 Problem 5: Cumbersome approvals to build on top of APIs<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="问题 6：OAuth 安全性很困难且目标不断变化 Problem 6: OAuth security is hard and a moving target" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#问题-6-oauth-安全性很困难且目标不断变化-problem-6-oauth-security-is-hard-and-a-moving-target"><!---->问题 6：OAuth 安全性很困难且目标不断变化 Problem 6: OAuth security is hard and a moving target<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="最后但并非最不重要的一点：有些事情我们还没有讨论过 Last but not least: Some things we haven’t talked about yet" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#最后但并非最不重要的一点-有些事情我们还没有讨论过-last-but-not-least-some-things-we-haven-t-talked-about-yet"><!---->最后但并非最不重要的一点：有些事情我们还没有讨论过 Last but not least: Some things we haven’t talked about yet<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="有更好的方法吗？ A better way?" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/black-hole/posts/reprint/Why_is_OAuth_still_hard_in_2023.html#有更好的方法吗-a-better-way"><!---->有更好的方法吗？ A better way?<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a aria-label="分片并不意味着分布式" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/black-hole/posts/reprint/sharded_does_not_imply_distributed.html"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:blade" width="1em" height="1em"></iconify-icon>分片并不意味着分布式<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="是时候放弃 MySQL 和 PostgreSQL 而转而使用 SQLite 了吗？" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/black-hole/posts/reprint/is_it_time_to_ditch_mysql_and_postgresql_for_sqlite.html"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="file-icons:sqlite" width="1em" height="1em"></iconify-icon>是时候放弃 MySQL 和 PostgreSQL 而转而使用 SQLite 了吗？<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="B 树如何让您的查询更快？" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/black-hole/posts/reprint/how_does_b-tree_make_your_queries_fast.html"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:tree-view" width="1em" height="1em"></iconify-icon>B 树如何让您的查询更快？<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="WebSocket vs SSE vs Long-Polling vs WebRTC vs WebTransport" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/black-hole/posts/reprint/webSockets_vs_server-sent-events_vs_long-polling_vs_webrtc_vs_webtransport.html"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="maki:communications-tower" width="1em" height="1em"></iconify-icon>WebSocket vs SSE vs Long-Polling vs WebRTC vs WebTransport<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a aria-label="关于作者" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/black-hole/intro.html"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="circle-info" width="1em" height="1em"></iconify-icon>关于作者<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><img class="page-cover" src="/black-hole/assets/images/minions_cover8.jpg" alt="为什么 OAuth 在 2023 年仍然难以实现？" no-view><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:oauth" width="1em" height="1em"></iconify-icon>为什么 OAuth 在 2023 年仍然难以实现？</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/yudi-corgi" target="_blank" rel="noopener noreferrer">YUDI-Corgi</a></span><span property="author" content="YUDI-Corgi"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-10-07T00:00:00.000Z"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category1 clickable" role="navigation">杂谈</span><!--]--><meta property="articleSection" content="杂谈"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag1 clickable" role="navigation">杂谈</span><!--]--><meta property="keywords" content="杂谈"></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 26 分钟</span><meta property="timeRequired" content="PT26M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<!----></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/black-hole/#写在前头">写在前头</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/black-hole/#为什么-2023-年-oauth-仍然很难-why-is-oauth-still-hard-in-2023">为什么 2023 年 OAuth 仍然很难？ Why is OAuth still hard in 2023?</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/black-hole/#oauth-实践-oauth-in-practice">OAuth 实践 OAuth in practice</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/black-hole/#问题-1-oauth-标准太大且复杂-problem-1-the-oauth-standard-is-just-too-big-and-complex">问题 1：OAuth 标准太大且复杂 Problem 1: The OAuth standard is just too big and complex</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/black-hole/#问题-2-每个人的-oauth-都有细微的差别-problem-2-everybody-s-oauth-is-different-in-subtle-ways">问题 2：每个人的 OAuth 都有细微的差别 Problem 2: Everybody’s OAuth is different in subtle ways</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/black-hole/#问题-3-许多-api-向-oauth-添加非标准扩展-problem-3-many-apis-add-nonstandard-extensions-to-oauth">问题 3：许多 API 向 OAuth 添加非标准扩展 Problem 3: Many APIs add nonstandard extensions to OAuth</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/black-hole/#问题-4-invalid-request-——调试-oauth-流程很困难-problem-4-invalid-request-—-debugging-oauth-flows-is-hard">问题 4：“invalid_request”——调试 OAuth 流程很困难 Problem 4: “invalid_request” — debugging OAuth flows is hard</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/black-hole/#问题-5-基于-api-构建的审批繁琐-problem-5-cumbersome-approvals-to-build-on-top-of-apis">问题 5：基于 API 构建的审批繁琐 Problem 5: Cumbersome approvals to build on top of APIs</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/black-hole/#问题-6-oauth-安全性很困难且目标不断变化-problem-6-oauth-security-is-hard-and-a-moving-target">问题 6：OAuth 安全性很困难且目标不断变化 Problem 6: OAuth security is hard and a moving target</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/black-hole/#最后但并非最不重要的一点-有些事情我们还没有讨论过-last-but-not-least-some-things-we-haven-t-talked-about-yet">最后但并非最不重要的一点：有些事情我们还没有讨论过 Last but not least: Some things we haven’t talked about yet</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/black-hole/#有更好的方法吗-a-better-way">有更好的方法吗？ A better way?</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="写在前头" tabindex="-1"><a class="header-anchor" href="#写在前头" aria-hidden="true">#</a> 写在前头</h2><p>本篇是 <a href="https://www.nango.dev/blog/why-is-oauth-still-hard" target="_blank" rel="noopener noreferrer">Why is OAuth still hard in 2023?<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 一文的中文翻译，文章内容翔实，说明了 OAuth 的复杂性、安全性、实际应用困难等方面的问题。</p><p><strong>以下是太长不看版（由 AI 整理）</strong>：</p><p>这篇文章讨论了为什么 OAuth 在 2023 年仍然难以实现。作者们通过为 50 个最受欢迎的 API 实现 OAuth 的经验得出结论，OAuth 实际应用中的体验类似于 2008 年的 JavaScript 浏览器 API。尽管有一个通用的共识关于如何实现 OAuth，但每个 API 实际上都有自己对标准的解释、实现上的怪癖、非标准行为和扩展。</p><p>文章中提到的问题包括：</p><ol><li><strong>OAuth 标准过于庞大和复杂</strong>：OAuth 2.0 标准包含了 17 个不同的 RFC（定义标准的文档），覆盖了从 OAuth 框架到威胁模型和私钥 JWT 的所有内容。尽管不是所有 RFC 对于简单的第三方访问令牌授权都是相关的，但即使只关注相关的部分，也足以让人感到复杂。</li><li><strong>每个 API 的 OAuth 实现都有细微差异</strong>：由于每个 API 实现的 OAuth 子集不同，开发者需要详细阅读每个 API 的 OAuth 文档，了解所需的参数、请求方式、重定向 URL 等。</li><li><strong>许多 API 添加了非标准的 OAuth 扩展</strong>：尽管 OAuth 标准已经非常广泛，但许多 API 仍然觉得需要添加一些非标准的功能。这意味着开发者需要为每个 API 实现特定的逻辑。</li><li><strong>调试 OAuth 流程困难</strong>：OAuth2 有标准化的错误消息，但它们通常无法提供足够的信息来帮助开发者调试问题。文档错误、缺失细节或未更新的情况很常见，导致 OAuth 流程在首次实施时经常遇到问题。</li><li><strong>基于 API 的构建需要繁琐的批准流程</strong>：许多流行的 API 需要开发者提交审核，这个过程可能需要数天甚至数月才能完成。有些 API 甚至要求开发者与他们签订收入分成协议。</li><li><strong>OAuth 安全性难以把握且不断变化</strong>：随着攻击手段的发现和网络技术的发展，OAuth 标准也在不断变化。新的安全最佳实践，如即将到来的 OAuth 2.1 标准，将使一些当前的最佳实践成为强制性要求。</li></ol><p>文章最后提到，作者正在开发一个名为 Nango 的开源服务，它提供了预构建的 OAuth 流程、安全的令牌存储和自动令牌刷新功能，支持超过 90 个 OAuth API。欢迎读者尝试使用并提供反馈。</p><p><strong>以下是原文+翻译：</strong></p><h2 id="为什么-2023-年-oauth-仍然很难-why-is-oauth-still-hard-in-2023" tabindex="-1"><a class="header-anchor" href="#为什么-2023-年-oauth-仍然很难-why-is-oauth-still-hard-in-2023" aria-hidden="true">#</a> 为什么 2023 年 OAuth 仍然很难？<br> Why is OAuth still hard in 2023?</h2><p>We implemented OAuth for the 50 most popular APIs. TL;DR: It is still a mess.<br> 我们为 50 个最流行的 API 实现了 OAuth。TL;DR（Tong long, did&#39;t read）：仍然是一团糟。</p><p>OAuth is a standard protocol. Right? And there are client libraries for OAuth 2.0 <a href="https://oauth.net/code/nodejs/" target="_blank" rel="noopener noreferrer">available<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://oauth.net/code/php/" target="_blank" rel="noopener noreferrer">in<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://oauth.net/code/java/" target="_blank" rel="noopener noreferrer">basically<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://oauth.net/code/python/" target="_blank" rel="noopener noreferrer">every<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://oauth.net/code/go/" target="_blank" rel="noopener noreferrer">programming<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://oauth.net/code/rust/" target="_blank" rel="noopener noreferrer">language<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://oauth.net/code/dotnet/" target="_blank" rel="noopener noreferrer">you<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://oauth.net/code/kotlin/" target="_blank" rel="noopener noreferrer">can<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://oauth.net/code/swift/" target="_blank" rel="noopener noreferrer">imagine<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.<br> OAuth 是一个标准协议。正确的？基本上您能想象到的每种编程语言都有适用于 OAuth 2.0 的客户端库。</p><p>You might conclude that, armed with a client library, you would be able to implement OAuth for any API in about 10 minutes. Or at least in an hour.<br> 您可能会得出结论，配备客户端库后，您将能够在大约 10 分钟内为任何 API 实现 OAuth。或者至少一个小时内。</p><p>If you manage, please email us — we’d like to treat you to a delicious dinner and hear how you did it.<br> 如果您成功了，请给我们发电子邮件——我们很乐意请您享用一顿美味的晚餐，并听听您是如何做到的。</p><h3 id="oauth-实践-oauth-in-practice" tabindex="-1"><a class="header-anchor" href="#oauth-实践-oauth-in-practice" aria-hidden="true">#</a> OAuth 实践 <br>OAuth in practice</h3><p>We implemented OAuth for the 50 most popular APIs, such as Google (Gmail, Calendar, Sheets etc.), HubSpot, Shopify, Salesforce, Stripe, Jira, Slack, Microsoft (Azure, Outlook, OneDrive), LinkedIn, Facebook and <a href="https://docs.nango.dev/providers" target="_blank" rel="noopener noreferrer">other OAuth APIs.<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>‍<br> 我们为 50 个最流行的 API 实现了 OAuth，例如 Google（Gmail、日历、表格等）、HubSpot、Shopify、Salesforce、Stripe、Jira、Slack、Microsoft（Azure、Outlook、OneDrive）、LinkedIn、Facebook 和其他 OAuth蜜蜂</p><p>Our conclusion: The real-world OAuth experience is comparable to JavaScript browser APIs in 2008. There’s a general consensus on how things should be done, but in reality every API has its own interpretation of the standard, implementation quirks, and nonstandard behaviors and extensions. The result: footguns behind every corner.<br> 我们的结论：现实世界的 OAuth 体验可与 2008 年的 JavaScript 浏览器 API 相媲美。对于应该如何完成工作存在普遍共识，但实际上每个 API 对标准、实现怪癖以及非标准行为和扩展都有自己的解释。结果是：每个角落后面都有枪。</p><p>If it weren’t so annoying, it would be quite funny. Let’s dive in!<br> 如果不是那么烦人的话，那就很有趣了。让我们深入了解一下！</p><h2 id="问题-1-oauth-标准太大且复杂-problem-1-the-oauth-standard-is-just-too-big-and-complex" tabindex="-1"><a class="header-anchor" href="#问题-1-oauth-标准太大且复杂-problem-1-the-oauth-standard-is-just-too-big-and-complex" aria-hidden="true">#</a> 问题 1：OAuth 标准太大且复杂 <br>Problem 1: The OAuth standard is just too big and complex</h2><blockquote><p>“This API also uses OAuth 2.0, and we already did that a few weeks ago. I should be done by tomorrow.”<br> “这个 API 还使用 OAuth 2.0，我们几周前就已经这样做了。我应该在明天之前完成。”<br> – Famous last words from the intern<br> ——实习生著名的遗言</p></blockquote><p>OAuth is a very big standard. The <a href="https://oauth.net/2/" target="_blank" rel="noopener noreferrer">OAuth 2.0’s official site<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> currently lists 17 different RFCs (documents defining a standard) that together define how OAuth 2 works. They cover everything from the OAuth framework and Bearer tokens to threat models and private key JWTs.<br> OAuth 是一个非常大的标准。 OAuth 2.0 的官方网站目前列出了 17 个不同的 RFC（定义标准的文档），它们共同定义了 OAuth 2 的工作方式。它们涵盖了从 OAuth 框架和 Bearer 令牌到威胁模型和私钥 JWT 的所有内容。</p><p>“But,” I hear you say, “surely not all of these RFCs are relevant for a simple third-party-access token authorization with an API?”<br> “但是，”我听到您说，“肯定不是所有这些 RFC 都与使用 API 的简单第三方访问令牌授权相关吗？”<br> You’re right. Let’s focus only on the things that are likely to be relevant for the typical API third-party-access use case:<br> 是的。让我们只关注可能与典型 API 第三方访问用例相关的内容：</p><ul><li>OAuth standard: OAuth 2.0 is the default now, but OAuth 1.0a is still used by some (and 2.1 is around the corner). Once you know which one your API uses, move on to:<br> OAuth 标准：OAuth 2.0 现在是默认值，但 OAuth 1.0a 仍然被一些人使用（2.1 即将推出）。一旦您知道您的 API 使用哪一个，请继续：</li><li>Grant type: Do you need authorization_code, client_credentials, or device_code? What do they do, and when should you use each of them? When in doubt, try authorization_code.<br> 授权类型：您需要 authorization_code、client_credentials 或 device_code 吗？它们有什么作用，什么时候应该使用它们？如有疑问，请尝试 authorization_code。</li><li>Side note: Refresh tokens are also a grant type, but kind of a special one. How they work is standardized, but how you ask for them in the first place is not. More on that later.<br> 旁注：刷新令牌也是一种授予类型，但有点特殊。它们的工作方式是标准化的，但您最初要求它们的方式却不是标准化的。稍后会详细介绍。</li><li>Now that you’re ready for your requests, let’s look at the many (72, to be precise) <a href="https://www.iana.org/assignments/oauth-parameters/oauth-parameters.xhtml" target="_blank" rel="noopener noreferrer">official OAuth parameters<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> with a defined meaning and behavior. Common examples are prompt, scope, audience, resource, assertion, and login_hint. However, in our experience, most API providers seem to be as oblivious to this list as you probably were until now, so don&#39;t worry too much about it.<br> 现在您已准备好接收请求，让我们看一下许多（准确地说是 72 个）具有定义含义和行为的官方 OAuth 参数。常见示例有提示、范围、受众、资源、断言和登录提示。然而，根据我们的经验，大多数 API 提供商似乎都像您到目前为止一样忽视了此列表，因此不必太担心。</li></ul><p>If you think this still feels too complicated and like a lot to learn, we tend to agree with you.<br> 如果您认为这仍然感觉太复杂并且需要学习很多东西，我们倾向于同意您的观点。</p><p>Most teams building public APIs seem to agree as well. Instead of implementing a full OAuth 2.0 subset, they just implement the parts of OAuth they think they need for their API’s use case. This leads to pretty long pages in docs outlining how OAuth works for this particular API. But we have a hard time blaming them; they have only the best intentions in mind for their DX. And if they truly tried to implement the full standard, you’d need to read a small book!<br> 大多数构建公共 API 的团队似乎也同意这一点。他们没有实现完整的 OAuth 2.0 子集，而是只实现他们认为 API 用例所需的 OAuth 部分。这导致文档中出现相当长的页面来概述 OAuth 如何针对此特定 API 工作。但我们很难责怪他们；他们对 DX 的想法只有最好的。如果他们真的尝试实施完整的标准，您需要阅读一本小书！</p><figure><img src="/black-hole/assets/oauth_hard1-ce69415b.png" alt="The Salesforce authorization_code OAuth flow. What&#39;s not to like about a clear visual for this simple 10-step process? Salesforce 授权代码 OAuth 流程。为什么不喜欢这个简单的 10 步流程的清晰视觉效果呢？" tabindex="0" loading="lazy"><figcaption>The Salesforce authorization_code OAuth flow. What&#39;s not to like about a clear visual for this simple 10-step process? <br>Salesforce 授权代码 OAuth 流程。为什么不喜欢这个简单的 10 步流程的清晰视觉效果呢？</figcaption></figure><p>The trouble is that everybody has a slightly different idea of which subset of OAuth is relevant for them, so you end up with lots of different (sub-) implementations.<br> 问题在于，每个人对于 OAuth 的哪个子集与他们相关的想法都略有不同，因此最终会得到许多不同的（子）实现。</p><h2 id="问题-2-每个人的-oauth-都有细微的差别-problem-2-everybody-s-oauth-is-different-in-subtle-ways" tabindex="-1"><a class="header-anchor" href="#问题-2-每个人的-oauth-都有细微的差别-problem-2-everybody-s-oauth-is-different-in-subtle-ways" aria-hidden="true">#</a> 问题 2：每个人的 OAuth 都有细微的差别 <br>Problem 2: Everybody’s OAuth is different in subtle ways</h2><p>As every API implements a different subset of OAuth, you quickly get into a situation where you are forced to read their long pages of OAuth docs in detail:<br> 由于每个 API 都实现 OAuth 的不同子集，因此您很快就会陷入被迫详细阅读其长页 OAuth 文档的情况：</p><ul><li><p>Which parameters do they require in the authorize call?<br> 他们在授权调用中需要哪些参数？</p><ul><li>For Jira, the audience parameter is key (and must be set to a specific fixed value). Google prefers to handle this through different scopes but really cares about the prompt parameter. Meanwhile, somebody at Microsoft discovered the response_mode parameter and demands that you always set it to query.<br> 对于 Jira 来说，受众参数是关键（并且必须设置为特定的固定值）。谷歌更喜欢通过不同的范围来处理这个问题，但真正关心的是提示参数。与此同时，微软的某人发现了response_mode参数并要求你始终将其设置为查询。</li><li>The Notion API takes a radical approach and does away with the ubiquitous scope parameter. In fact, you won’t even find the word “scope” in their API docs. Notion calls them “capabilities,” and you set them when you register the app. It took us 30 confused minutes to understand what was going on. Why did they reinvent this wheel?<br> Notion API 采用了一种激进的方法，取消了无处不在的作用域参数。事实上，您甚至在他们的 API 文档中找不到“范围”这个词。 Notion 将它们称为“功能”，您可以在注册应用程序时设置它们。我们困惑地花了 30 分钟才明白发生了什么事。他们为什么要重新发明这个轮子？</li><li>It gets worse with offline_access: Most APIs these days expire access tokens after a short while. To get a refresh token, you need to request “offline_access,” which needs to be done through a parameter, a scope, or something you set when you register your OAuth app. Ask your API or OAuth doctor for details.<br> Offline_access 的情况会变得更糟：现在大多数 API 的访问令牌都会在短时间内过期。要获取刷新令牌，您需要请求“offline_access”，这需要通过参数、范围或注册 OAuth 应用程序时设置的内容来完成。请咨询您的 API 或 OAuth 医生了解详细信息。</li></ul></li><li><p>What do they want to see in the token request call?<br> 他们希望在令牌请求调用中看到什么？</p><ul><li>Some APIs, like Fitbit, insist on getting data in the headers. Most really want it in the body, encoded as x-www-url-form-encoded, except for a few, such as Notion, which prefer to get it as JSON.<br> 一些 API（例如 Fitbit）坚持在标头中获取数据。大多数人确实希望它在正文中，编码为 x-www-url-form-encoded，但少数人（例如 Notion）更喜欢将其编码为 JSON。</li><li>Some want you to authenticate this request with Basic auth. Many don’t bother with that. But beware, they may change their mind tomorrow.<br> 有些人希望您使用基本身份验证来验证此请求。许多人对此不屑一顾。但要小心，他们明天可能会改变主意。</li></ul></li><li><p>Where should I redirect my users to authorize?<br> 我应该将用户重定向到哪里进行授权？</p><ul><li><p>Shopify and Zendesk have a model in which every user gets a subdomain like {subdomain}.myshopify.com. And yes, that includes the OAuth authorization page, so you’d better build dynamic URLs into your model and frontend code.<br> Shopify 和 Zendesk 有一个模型，其中每个用户都会获得一个子域，例如 {subdomain}.myshopify.com。是的，其中包括 OAuth 授权页面，因此您最好将动态 URL 构建到模型和前端代码中。</p></li><li><p>Zoho Books has different data centers for their customers in different locations. Hopefully, they remember where their data resides: To authorize your app, your U.S. customers should go to https://accounts.zoho.com, Europeans can visit https://accounts.zoho.eu, and Indians are welcome at https://accounts.zoho.in. The list goes on.<br> Zoho Books 在不同地点为客户提供不同的数据中心。希望他们记住数据所在的位置：要授权您的应用程序，您的美国客户应访问 https://accounts.zoho.com，欧洲客户可以访问 https://accounts.zoho.eu，欢迎印度客户访问 https://accounts.zoho.in。这样的例子还在继续。</p></li></ul></li><li><p>But at least I can pick my callback URL, no?<br> 但至少我可以选择我的回调 URL，不是吗？</p><ul><li>If you enter http://localhost:3003/callback as a callback for the Slack API, they kindly remind you to “Please use https for security.” Yes, also for localhost. Luckily <a href="https://www.nango.dev/blog/oauth-redirects-on-localhost-with-https" target="_blank" rel="noopener noreferrer">there are solutions for OAuth redirects on localhost<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.<br> 如果您输入 http://localhost:3003/callback 作为 Slack API 的回调，他们会善意地提醒您“为了安全起见，请使用 https”。是的，也适用于本地主机。幸运的是，本地主机上有 OAuth 重定向的解决方案。</li></ul></li></ul><p>We could go on for a long time, but we think you probably get the point by now.<br> 我们可以继续说很长时间，但我们认为您现在可能已经明白了要点。</p><figure><img src="/black-hole/assets/oauth_hard2-489a6c03.png" alt="OAuth is too complex; let’s make a simpler version of OAuth that has everything we need! ©XKCDOAuth太复杂；让我们制作一个更简单的 OAuth 版本，其中包含我们需要的一切！ ©XKCD" tabindex="0" loading="lazy"><figcaption>OAuth is too complex; let’s make a simpler version of OAuth that has everything we need! ©XKCD<br>OAuth太复杂；让我们制作一个更简单的 OAuth 版本，其中包含我们需要的一切！ ©XKCD</figcaption></figure><h2 id="问题-3-许多-api-向-oauth-添加非标准扩展-problem-3-many-apis-add-nonstandard-extensions-to-oauth" tabindex="-1"><a class="header-anchor" href="#问题-3-许多-api-向-oauth-添加非标准扩展-problem-3-many-apis-add-nonstandard-extensions-to-oauth" aria-hidden="true">#</a> 问题 3：许多 API 向 OAuth 添加非标准扩展 <br>Problem 3: Many APIs add nonstandard extensions to OAuth</h2><p>Even though the OAuth standard is vast, many APIs still seem to find gaps in it for features they need. A common issue we see is that you need some data in addition to the access_token to work with the API. Wouldn’t it be neat if this additional data could be returned to you together with the access_token in the OAuth flow?<br> 尽管 OAuth 标准很庞大，但许多 API 似乎仍然在其中找到了它们所需功能的空白。我们看到的一个常见问题是，除了 access_token 之外，您还需要一些数据才能使用 API。如果这些附加数据可以与 OAuth 流程中的 access_token 一起返回给您，岂不是很完美？</p><p>We actually think this is a good idea — orr at least it’s better than forcing users to do quirky additional API requests afterward to fetch this information (looking at you, Jira). But it does mean more nonstandard behavior that you specifically need to implement for every API.<br> 我们实际上认为这是一个好主意 - 或者至少它比强迫用户随后执行奇怪的额外 API 请求来获取此信息要好（看着你，Jira）。但这确实意味着您特别需要为每个 API 实现更多非标准行为。</p><p>Here’s a small list of nonstandard extensions we have seen:<br> 以下是我们见过的一小部分非标准扩展：</p><ul><li>Quickbooks employs a realmID, which you need to pass in with every API request. The only time they tell you this realmID is as an additional parameter in the OAuth callback. Better store it somewhere safe!<br> Quickbooks 使用realmID，您需要在每个API 请求中传递该realmID。他们唯一一次告诉您此 RealmID 是作为 OAuth 回调中的附加参数。最好将其存放在安全的地方！</li><li>Braintree does the same with a companyID<br> Braintree 对 companyID 执行同样的操作</li><li>Salesforce uses a different API base URL for each customer; they call this the instance_url. Thankfully, they return the instance_url of the user together with the access token in the token response, but you do need to parse it out from there and store it.<br> Salesforce 为每个客户使用不同的 API 基本 URL；他们称之为instance_url。值得庆幸的是，它们返回用户的 instance_url 以及令牌响应中的访问令牌，但您确实需要从那里解析它并存储它。</li><li>Unfortunately, the <a href="https://www.nango.dev/blog/how-we-built-a-salesforce-api-integration-in-3-hours" target="_blank" rel="noopener noreferrer">Salesforce API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> also does even more annoying things: Access tokens expire after a preset period of time, which can be customized by the user. Fine so far, but for some reason they don’t tell you in the token response when the access token you just received will expire (everybody else does this). Instead, you need to query an additional token details endpoint to get the (current) expiration date of the token. Why, Salesforce, why?<br> 不幸的是，Salesforce API 还做了更烦人的事情：访问令牌会在预设时间段后过期，该时间段可以由用户自定义。到目前为止还好，但由于某种原因，他们不会在令牌响应中告诉您刚刚收到的访问令牌何时过期（其他人都会这样做）。相反，您需要查询额外的令牌详细信息端点以获取令牌的（当前）到期日期。为什么，Salesforce，为什么？</li><li>Slack has two different types of scopes: scopes you hold as a Slack bot and scopes that allow you to take action on behalf of the user who authorized your app. Smart, but instead of just adding different scopes for each, they implemented a separate user_scopes parameter that you need to pass in the authorization call. You’d better be aware of this, and good luck finding support for this in your OAuth library.<br> Slack 有两种不同类型的范围：您作为 Slack 机器人持有的范围和允许您代表授权您的应用程序的用户采取操作的范围。很聪明，但他们不是仅仅为每个范围添加不同的范围，而是实现了一个单独的 user_scopes 参数，您需要在授权调用中传递该参数。您最好意识到这一点，并祝您好运在您的 OAuth 库中找到对此的支持。</li></ul><p>For the sake of brevity and simplicity, we’re skipping the many not-really-standard OAuth flows we have encountered.<br> 为了简洁起见，我们跳过了我们遇到的许多不真正标准的 OAuth 流程。</p><h2 id="问题-4-invalid-request-——调试-oauth-流程很困难-problem-4-invalid-request-—-debugging-oauth-flows-is-hard" tabindex="-1"><a class="header-anchor" href="#问题-4-invalid-request-——调试-oauth-流程很困难-problem-4-invalid-request-—-debugging-oauth-flows-is-hard" aria-hidden="true">#</a> 问题 4：“invalid_request”——调试 OAuth 流程很困难 <br>Problem 4: “invalid_request” — debugging OAuth flows is hard</h2><p>Debugging distributed systems is always hard. It’s harder when the service you’re working with uses broad, generic error messages.<br> 调试分布式系统总是很困难。当您使用的服务使用广泛的通用错误消息时，事情会变得更加困难。</p><p>OAuth2 has <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-5.2" target="_blank" rel="noopener noreferrer">standardized error messages<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, but they’re about as useful in telling you what’s going on as the example in the title above (which, by the way, is one of the recommended error messages from the OAuth standard).<br> OAuth2 具有标准化的错误消息，但它们在告诉您正在发生的情况方面与上面标题中的示例一样有用（顺便说一下，这是 OAuth 标准中推荐的错误消息之一）。</p><p>You could argue that OAuth is a standard and that there are docs for every API, so what is there to debug?<br> 您可能会说 OAuth 是一个标准，每个 API 都有文档，那么有什么可调试的呢？<br> A lot. I cannot tell you how often the docs are wrong. Or missing a detail. Or have not been updated for the latest change. Or you missed something when you first looked at them. A good 80% of the OAuth flows we implement have some problem upon first implementation and require debugging.<br> 很多。我无法告诉你文档出错的频率有多少。或者遗漏了一个细节。或者尚未更新最新的更改。或者当你第一次看到它们时你错过了一些东西。我们实现的 OAuth 流程中有 80% 在首次实现时都存在一些问题，需要调试。</p><figure><img src="/black-hole/assets/oauth_hard3-e8fe159d.png" alt="How did Randall observe me while I was debugging OAuth flows? ©XKCD当我调试 OAuth 流程时，Randall 如何观察我？ ©XKCD" tabindex="0" loading="lazy"><figcaption>How did Randall observe me while I was debugging OAuth flows? ©XKCD<br>当我调试 OAuth 流程时，Randall 如何观察我？ ©XKCD</figcaption></figure><p>Some flows also break for, what seem to be, random reasons: LinkedIn OAuth, for instance, breaks if you pass in PKCE parameters. The error you get? “client error - invalid OAuth request.” That is … telling? It took us an hour to understand that passing in (optional, usually disregarded) PKCE parameters is what breaks the flow.<br> 有些流程也会因随机原因而中断：例如，如果您传入 PKCE 参数，LinkedIn OAuth 就会中断。你得到的错误是？ “客户端错误 - OAuth 请求无效。”这就是……告诉我们？我们花了一个小时才明白传入（可选的，通常被忽略的）PKCE 参数是破坏流程的原因。</p><p>Another common mistake is sending scopes that don’t match the ones you preregistered with the app. (Preregister scopes? Yes, a lot of APIs these days demand that.) This often results in a generic error message about there being an issue with scopes. Duh.<br> 另一个常见的错误是发送的范围与您在应用程序中预先注册的范围不匹配。 （预注册范围？是的，现在很多 API 都要求这样做。）这通常会导致出现有关范围存在问题的通用错误消息。</p><h2 id="问题-5-基于-api-构建的审批繁琐-problem-5-cumbersome-approvals-to-build-on-top-of-apis" tabindex="-1"><a class="header-anchor" href="#问题-5-基于-api-构建的审批繁琐-problem-5-cumbersome-approvals-to-build-on-top-of-apis" aria-hidden="true">#</a> 问题 5：基于 API 构建的审批繁琐 <br>Problem 5: Cumbersome approvals to build on top of APIs</h2><p>The truth is, if you build toward some other system by using their API, you’re probably in the weaker position. Your customers are asking for the integration because they’re already using the other system. Now you need to make them happy.<br> 事实是，如果您使用其他系统的 API 进行构建，您可能会处于较弱的位置。您的客户要求集成，因为他们已经在使用其他系统。现在你需要让他们开心。</p><p>To be fair, many APIs are liberal and provide easy self-service signup flows for developers to register their apps and start using OAuth. But some of the most popular APIs out there require reviews before your app becomes public and can be used by any of their users. Again, to be fair, most review processes are sane and can be completed in a few days. They’re probably a net gain in terms of security and quality for end users.<br> 公平地说，许多 API 都是自由的，并为开发人员提供简单的自助注册流程来注册他们的应用程序并开始使用 OAuth。但一些最流行的 API 在您的应用程序公开并可供任何用户使用之前需要经过审核。再次强调，公平地说，大多数审核流程都是合理的，并且可以在几天内完成。对于最终用户来说，它们可能在安全性和质量方面带来净收益。</p><figure><img src="/black-hole/assets/oauth_hard4-48d66383.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>But some notorious examples can take months to complete, and some even require you to enter into revenue-share agreements:<br> 但一些臭名昭著的例子可能需要几个月的时间才能完成，有些甚至要求您签订收入分成协议：</p><ul><li>Google requires a “security review” if you want to access scopes with more sensitive user data, such as email contents. We have heard these reviews can take days or weeks to pass and require a nontrivial amount of work on your side.<br> 如果您想访问包含更敏感用户数据（例如电子邮件内容）的范围，Google 需要进行“安全审查”。我们听说这些审核可能需要几天或几周的时间才能通过，并且需要您做大量的工作。</li><li>Looking to integrate with Rippling? Get ready for their 30-plus questions and security preproduction screening. We hear access takes months (if you are approved).<br> 想要与 Ripple 集成吗？准备好接受 30 多个问题和安全预生产筛查。我们听说访问需要几个月的时间（如果您获得批准）。</li><li>HubSpot, Notion, Atlassian, Shopify, and pretty much everybody else who has an integrations marketplace or app store requires a review to get listed there. Some reviews are mild, and some ask you for demo logins, video walkthroughs, blog posts (yes!), and more. However, listing on the marketplace or store is often optional.<br> HubSpot、Notion、Atlassian、Shopify 以及几乎所有拥有集成市场或应用程序商店的其他人都需要经过审核才能在其中列出。有些评论很温和，有些则要求您提供演示登录、视频演练、博客文章（是的！）等等。然而，在市场或商店上列出通常是可选的。</li><li>Ramp, Brex, Twitter, and a good number of others don’t have a self-service signup flow for developers and require that you fill in forms for manual access. Many are quick to process requests, but we’re still waiting to hear back from some after weeks.<br> Ramp、Brex、Twitter 和许多其他网站没有为开发人员提供自助注册流程，需要您填写表格才能手动访问。许多人都会很快处理请求，但我们仍在等待几周后的回复。</li><li>Xero is a particularly drastic example of a monetized API: If you want to exceed a limit of 25 connected accounts, you have to <a href="https://developer.xero.com/documentation/xero-app-store/app-partner-guides/app-partner-steps/" target="_blank" rel="noopener noreferrer">become a Xero partner<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and list your app in their app store. They will then take (as of the time of this writing) a 15% revenue cut from every lead generated from that store.<br> Xero 是货币化 API 的一个特别激烈的例子：如果您想超过 25 个连接帐户的限制，您必须成为 Xero 合作伙伴并在他们的应用商店中列出您的应用程序。然后，他们将从该商店产生的每条销售线索中扣除 15% 的收入（截至撰写本文时）。</li></ul><h2 id="问题-6-oauth-安全性很困难且目标不断变化-problem-6-oauth-security-is-hard-and-a-moving-target" tabindex="-1"><a class="header-anchor" href="#问题-6-oauth-安全性很困难且目标不断变化-problem-6-oauth-security-is-hard-and-a-moving-target" aria-hidden="true">#</a> 问题 6：OAuth 安全性很困难且目标不断变化 <br>Problem 6: OAuth security is hard and a moving target</h2><p>As attacks have been uncovered, and the available web technologies have evolved, the OAuth standard has changed as well. If you’re looking to implement the current security best practices, the OAuth working group has a <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics" target="_blank" rel="noopener noreferrer">rather lengthy guide<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for you. And if you’re working with an API that is still using OAuth 1.0a today, you realize that backwards compatibility is a never-ending struggle.<br> 随着攻击的被发现以及可用的 Web 技术的发展，OAuth 标准也发生了变化。如果您希望实施当前的安全最佳实践，OAuth 工作组为您提供了相当冗长的指南。如果您现在使用的 API 仍在使用 OAuth 1.0a，您就会意识到向后兼容性是一场永无休止的斗争。</p><p>Luckily, security is getting better with every iteration, but it often comes at the cost of more work for developers. The upcoming OAuth 2.1 standard will make some current best practices mandatory and includes mandatory PKCE (today only a handful of APIs require this) and additional restrictions for refresh tokens.<br> 幸运的是，安全性随着每次迭代而变得越来越好，但这通常是以开发人员付出更多工作为代价的。即将推出的 OAuth 2.1 标准将强制执行一些当前的最佳实践，并包括强制的 PKCE（目前只有少数 API 需要此）以及刷新令牌的附加限制。</p><figure><img src="/black-hole/assets/oauth_hard5-45e6a1f7.png" alt="At least OAuth already implements a two-factor auth model. ©XKCD至少 OAuth 已经实现了双因素身份验证模型。 ©XKCD" tabindex="0" loading="lazy"><figcaption>At least OAuth already implements a two-factor auth model. ©XKCD<br>至少 OAuth 已经实现了双因素身份验证模型。 ©XKCD</figcaption></figure><p>The biggest change has probably been ushered in with expiring access tokens and the rise of refresh tokens. On the surface, the process seems simple: Whenever an access token expires, refresh it with the refresh token and store the new access token and refresh token.<br> 最大的变化可能是随着访问令牌的过期和刷新令牌的兴起而带来的。从表面上看，该过程似乎很简单：每当访问令牌过期时，使用刷新令牌刷新它并存储新的访问令牌和刷新令牌。</p><p>In reality, when we implemented this we had to consider:<br> 事实上，当我们实现这一点时，我们必须考虑：</p><ul><li>Race conditions: How can we make sure no other requests run while we refresh the current access token?<br> 竞争条件：如何确保在刷新当前访问令牌时没有其他请求运行？</li><li>Some APIs also expire the refresh token if you don’t use it for a certain number of days (or if the user has revoked the access). Expect some refreshes to fail.<br> 如果您在一定天数内不使用刷新令牌（或者用户已撤销访问权限），某些 API 也会使刷新令牌过期。预计某些刷新会失败。</li><li>Some APIs issue you a new refresh token with every refresh request …<br> 有些 API 在每次刷新请求时都会向您发出一个新的刷新令牌……</li><li>… but some also silently assume that you will keep the old refresh token and keep on using it.<br> …但有些人也默默地假设您将保留旧的刷新令牌并继续使用它。</li><li>Some APIs will tell you the access token expiration time in absolute values. Others only in relative “seconds from now.” And some, like Salesforce, don’t divulge this kind of information easily.<br> 某些 API 会以绝对值形式告诉您访问令牌过期时间。其他的则仅在相对“从现在开始的几秒钟内”发生。有些公司（例如 Salesforce）不会轻易泄露此类信息。</li></ul><h2 id="最后但并非最不重要的一点-有些事情我们还没有讨论过-last-but-not-least-some-things-we-haven-t-talked-about-yet" tabindex="-1"><a class="header-anchor" href="#最后但并非最不重要的一点-有些事情我们还没有讨论过-last-but-not-least-some-things-we-haven-t-talked-about-yet" aria-hidden="true">#</a> 最后但并非最不重要的一点：有些事情我们还没有讨论过 <br>Last but not least: Some things we haven’t talked about yet</h2><p>Sadly, we have only just scratched the surface of your OAuth implementation. Now that your OAuth flow runs and you get access tokens, it’s time to think about:<br> 遗憾的是，我们仅仅触及了 OAuth 实现的皮毛。现在您的 OAuth 流程已运行并且您获得了访问令牌，是时候考虑以下问题了：</p><ul><li>How to securely store these access tokens and refresh tokens. They are like passwords to your users’ accounts. But hashing is not an option; you need secure, reversible encryption.<br> 如何安全地存储这些访问令牌和刷新令牌。它们就像用户帐户的密码。但散列不是一种选择；而是一种选择。您需要安全、可逆的加密。</li><li>Checking that the granted scopes match the requested scopes (some APIs allow users to change the scopes they grant in the authorize flow).<br> 检查授予的范围是否与请求的范围匹配（某些 API 允许用户更改他们在授权流程中授予的范围）。</li><li>Avoiding race conditions when refreshing tokens.<br> 刷新令牌时避免竞争条件。</li><li>Detecting access tokens revoked by the user on the provider side.<br> 检测提供商端用户撤销的访问令牌。</li><li>Letting users know that access tokens have expired, so they can re-authorize your app if needed.<br> 让用户知道访问令牌已过期，以便他们可以在需要时重新授权您的应用程序。</li><li>How to revoke access tokens you no longer need (or that the user has requested you delete under GDPR).<br> 如何撤销您不再需要的访问令牌（或者用户根据 GDPR 要求删除的访问令牌）。</li><li>Changes in available OAuth scopes, provider bugs, missing documentation, and so on.<br> 可用 OAuth 范围的更改、提供程序错误、缺少文档等。</li></ul><h2 id="有更好的方法吗-a-better-way" tabindex="-1"><a class="header-anchor" href="#有更好的方法吗-a-better-way" aria-hidden="true">#</a> 有更好的方法吗？ <br>A better way?</h2><p>If you’ve read this far, you might be thinking, “There must be a better way!”<br> 如果您读到这里，您可能会想：“一定有更好的方法！”</p><p>We think there is, which is why we’re building <a href="https://www.nango.dev/" target="_blank" rel="noopener noreferrer">Nango<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: An <a href="https://github.com/NangoHQ/nango" target="_blank" rel="noopener noreferrer">open-source<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, self-contained service that comes with prebuilt OAuth flows, secure token storage, and automatic token refreshes <a href="https://docs.nango.dev/providers" target="_blank" rel="noopener noreferrer">for more than 90 OAuth APIs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.<br> 我们认为是存在的，这就是我们构建 Nango 的原因：一种开源、独立的服务，附带预构建的 OAuth 流程、安全令牌存储以及针对 90 多个 OAuth API 的自动令牌刷新。</p><p>If you give it a try, we’d love to hear your feedback. And if you want to share your worst OAuth horror story with us, we’d love to hear about it in our <a href="https://nango.dev/slack" target="_blank" rel="noopener noreferrer">Slack community<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.<br> 如果您尝试一下，我们很乐意听到您的反馈。如果您想与我们分享您最糟糕的 OAuth 恐怖故事，我们很乐意在 Slack 社区中听到它。</p><p>Thanks for reading and happy authorizing!<br> 感谢您的阅读并快乐授权！</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><!----><a aria-label="分片并不意味着分布式" class="vp-link nav-link next nav-link next" href="/black-hole/posts/reprint/sharded_does_not_imply_distributed.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">分片并不意味着分布式<iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:blade" width="1em" height="1em"></iconify-icon></div></a></nav><div id="comment" class="waline-wrapper" darkmode="false" style="display:none;"><div data-waline provider="Waline" comment="false"><!--v-if--><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">昵称</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">邮箱</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">网址</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="请留言。(填写邮箱可在被回复时收到邮件提醒)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>预览:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="表情" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="表情包"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="上传图片"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="预览"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <!--v-if-->  字</div><button type="button" class="wl-btn">登录</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->提交<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="搜索表情包"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> 评论</div><ul class="wl-sort"><!--[--><li class="active">按正序</li><li class="">按倒序</li><li class="">按热度</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v2.15.7</div></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright © 2023-2024 by <a href="https://github.com/yudi-corgi">YUDI-Corgi</a> | <a href='https://opensource.org/licenses/MIT'>MIT LICENSE</a></div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/black-hole/assets/app-507626cf.js" defer></script>
  </body>
</html>
