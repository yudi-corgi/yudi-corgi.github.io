<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.23" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.89" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"ä¸ºä»€ä¹ˆ OAuth åœ¨ 2025 å¹´ä»ç„¶éš¾ä»¥å®ç°ï¼Ÿ","image":["https://blog.yudi-corgi.site/assets/images/minions_cover8.jpg"],"datePublished":"2025-05-28T00:00:00.000Z","dateModified":"2025-05-29T08:18:43.000Z","author":[{"@type":"Person","name":"YUDI-Corgi","url":"https://github.com/yudi-corgi"}]}</script><meta property="og:url" content="https://blog.yudi-corgi.site/posts/reprint/why_is_oauth_still_hard_in_2025.html"><meta property="og:site_name" content="Black Hole"><meta property="og:title" content="ä¸ºä»€ä¹ˆ OAuth åœ¨ 2025 å¹´ä»ç„¶éš¾ä»¥å®ç°ï¼Ÿ"><meta property="og:description" content="åˆ†æ OAuth æœ¬èº«çš„å¤æ‚é—®é¢˜å’Œåœ¨å®é™…åº”ç”¨ä¸­çš„éš¾ç‚¹"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.yudi-corgi.site/assets/images/minions_cover8.jpg"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-05-29T08:18:43.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="https://blog.yudi-corgi.site/assets/images/minions_cover8.jpg"><meta name="twitter:image:alt" content="ä¸ºä»€ä¹ˆ OAuth åœ¨ 2025 å¹´ä»ç„¶éš¾ä»¥å®ç°ï¼Ÿ"><meta property="article:tag" content="æ‚è°ˆ"><meta property="article:published_time" content="2025-05-28T00:00:00.000Z"><meta property="article:modified_time" content="2025-05-29T08:18:43.000Z"><link rel="icon" type="image/svg+xml" href="/text.svg"><link rel="alternate" type="application/atom+xml" href="https://blog.yudi-corgi.site/atom.xml" title="Black Hole Atom Feed"><title>ä¸ºä»€ä¹ˆ OAuth åœ¨ 2025 å¹´ä»ç„¶éš¾ä»¥å®ç°ï¼Ÿ | Black Hole</title><meta name="description" content="åˆ†æ OAuth æœ¬èº«çš„å¤æ‚é—®é¢˜å’Œåœ¨å®é™…åº”ç”¨ä¸­çš„éš¾ç‚¹">
    <link rel="preload" href="/assets/style-C-gA0kct.css" as="style"><link rel="stylesheet" href="/assets/style-C-gA0kct.css">
    <link rel="modulepreload" href="/assets/app-CaxHSNMY.js"><link rel="modulepreload" href="/assets/why_is_oauth_still_hard_in_2025.html-BybFkMbT.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-JsLW2Bk6.js" as="script"><link rel="prefetch" href="/assets/intro.html-NQnnEvRU.js" as="script"><link rel="prefetch" href="/assets/enum_convert.html-CFlADJYS.js" as="script"><link rel="prefetch" href="/assets/distributed_transaction.html-DwWmmclo.js" as="script"><link rel="prefetch" href="/assets/jenkins_pipeline.html-QrC5nThH.js" as="script"><link rel="prefetch" href="/assets/tcp.html-BHxKGCbD.js" as="script"><link rel="prefetch" href="/assets/java-string.html-0vbFZFXA.js" as="script"><link rel="prefetch" href="/assets/jdk7-HashMap.html-DaGEKqU7.js" as="script"><link rel="prefetch" href="/assets/jdk8-HashMap.html-Cxlb0VdB.js" as="script"><link rel="prefetch" href="/assets/jvm-class-loading-mechanism.html-Dif78IZM.js" as="script"><link rel="prefetch" href="/assets/jvm-memory-model.html-CWlQycvB.js" as="script"><link rel="prefetch" href="/assets/how_does_b-tree_make_your_queries_fast.html-Dow6Pnha.js" as="script"><link rel="prefetch" href="/assets/is_it_time_to_ditch_mysql_and_postgresql_for_sqlite.html-Do_1BUdd.js" as="script"><link rel="prefetch" href="/assets/sharded_does_not_imply_distributed.html-DOLZGlBE.js" as="script"><link rel="prefetch" href="/assets/webSockets_vs_server-sent-events_vs_long-polling_vs_webrtc_vs_webtransport.html-BaE6MIqg.js" as="script"><link rel="prefetch" href="/assets/J2Cache.html-Bxf--hwy.js" as="script"><link rel="prefetch" href="/assets/spring_cloud_stream_one.html-D6axkHWb.js" as="script"><link rel="prefetch" href="/assets/spring_cloud_stream_three.html-Cl38WZAK.js" as="script"><link rel="prefetch" href="/assets/spring_cloud_stream_two.html-DR1_lS_g.js" as="script"><link rel="prefetch" href="/assets/spring_transaction_synchronization.html-BYCBMaZc.js" as="script"><link rel="prefetch" href="/assets/spring_websocket_one.html-BGF69w4S.js" as="script"><link rel="prefetch" href="/assets/spring_websocket_two.html-ma6d_Y_6.js" as="script"><link rel="prefetch" href="/assets/404.html-LHn3gaom.js" as="script"><link rel="prefetch" href="/assets/index.html-4u1XlBzp.js" as="script"><link rel="prefetch" href="/assets/index.html-DmtABNwT.js" as="script"><link rel="prefetch" href="/assets/index.html-Cop_Urt_.js" as="script"><link rel="prefetch" href="/assets/index.html-CGHlHk0x.js" as="script"><link rel="prefetch" href="/assets/index.html-B7TnEmMO.js" as="script"><link rel="prefetch" href="/assets/index.html-BZWStCMl.js" as="script"><link rel="prefetch" href="/assets/index.html-DvfpYVeT.js" as="script"><link rel="prefetch" href="/assets/index.html-8y3m0TUl.js" as="script"><link rel="prefetch" href="/assets/index.html-CIXAKg_K.js" as="script"><link rel="prefetch" href="/assets/index.html-Dmu3N8aG.js" as="script"><link rel="prefetch" href="/assets/index.html-CLPSivGs.js" as="script"><link rel="prefetch" href="/assets/index.html-D0Fm86rk.js" as="script"><link rel="prefetch" href="/assets/index.html-Dfi8gQyO.js" as="script"><link rel="prefetch" href="/assets/index.html-CCEE-OEi.js" as="script"><link rel="prefetch" href="/assets/index.html-C7QkjeNK.js" as="script"><link rel="prefetch" href="/assets/index.html-BQMJTmas.js" as="script"><link rel="prefetch" href="/assets/index.html-BFNCcICq.js" as="script"><link rel="prefetch" href="/assets/index.html-Cmna-v2F.js" as="script"><link rel="prefetch" href="/assets/index.html-CVqGAwO1.js" as="script"><link rel="prefetch" href="/assets/index.html-B9_HA0bK.js" as="script"><link rel="prefetch" href="/assets/index.html-CYwa7wYw.js" as="script"><link rel="prefetch" href="/assets/index.html-HtWv2X8k.js" as="script"><link rel="prefetch" href="/assets/index.html-BPopqjpE.js" as="script"><link rel="prefetch" href="/assets/index.html-BL0k6j7d.js" as="script"><link rel="prefetch" href="/assets/index.html-a_62Njzv.js" as="script"><link rel="prefetch" href="/assets/index.html-6ewoOEnc.js" as="script"><link rel="prefetch" href="/assets/index.html-DZd_FKAK.js" as="script"><link rel="prefetch" href="/assets/index.html-DMbjLokf.js" as="script"><link rel="prefetch" href="/assets/index.html-CGl40DUs.js" as="script"><link rel="prefetch" href="/assets/index.html-CXMOE4k4.js" as="script"><link rel="prefetch" href="/assets/index.html-D0GcJIY5.js" as="script"><link rel="prefetch" href="/assets/index.html-0eA7q3Fg.js" as="script"><link rel="prefetch" href="/assets/index.html-nigJW-jt.js" as="script"><link rel="prefetch" href="/assets/index.html-CKpL5pDC.js" as="script"><link rel="prefetch" href="/assets/index.html-CQybio-m.js" as="script"><link rel="prefetch" href="/assets/index.html-B-BSPB7m.js" as="script"><link rel="prefetch" href="/assets/index.html-QVhS657v.js" as="script"><link rel="prefetch" href="/assets/index.html-BYw1DOGB.js" as="script"><link rel="prefetch" href="/assets/index.html-CBDrzDj8.js" as="script"><link rel="prefetch" href="/assets/index.html-BVoVqwOj.js" as="script"><link rel="prefetch" href="/assets/index.html-FtEP8tYe.js" as="script"><link rel="prefetch" href="/assets/index.html-BKTLtWEU.js" as="script"><link rel="prefetch" href="/assets/index.html-4Q4Rmx9Y.js" as="script"><link rel="prefetch" href="/assets/index.html-Bhc2DKli.js" as="script"><link rel="prefetch" href="/assets/auto-BtC3bP42.js" as="script"><link rel="prefetch" href="/assets/index-BZSEhAeG.js" as="script"><link rel="prefetch" href="/assets/flowchart-CTwbLKUk.js" as="script"><link rel="prefetch" href="/assets/mermaid.esm.min-BSpGAdXR.js" as="script"><link rel="prefetch" href="/assets/vue-repl-DbIWQb6m.js" as="script"><link rel="prefetch" href="/assets/codemirror-editor-BCPfjpcK.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-DXWKOczD.js" as="script"><link rel="prefetch" href="/assets/waline-meta-l0sNRNKZ.js" as="script"><link rel="prefetch" href="/assets/component-B0Pp9WLn.js" as="script"><link rel="prefetch" href="/assets/SearchResult-5QXhwvUj.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">Black Hole</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><iconify-icon class="vp-icon" icon="home" height="1em" sizing="height"></iconify-icon><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç²¾é€‰æ–‡ç« "><!--[--><iconify-icon class="vp-icon" icon="fluent-emoji-flat:star" height="1em" sizing="height"></iconify-icon>ç²¾é€‰æ–‡ç« <!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/framework/spring/spring_transaction_synchronization.html" aria-label="Spring äº‹åŠ¡åŒæ­¥"><!--[--><iconify-icon class="vp-icon" icon="devicon:spring" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->Spring äº‹åŠ¡åŒæ­¥<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/dev_experience/enum_convert.html" aria-label="æšä¸¾å­—å…¸çš„å·§ç”¨"><!--[--><iconify-icon class="vp-icon" icon="material-symbols:dictionary-outline" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->æšä¸¾å­—å…¸çš„å·§ç”¨<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/java/java-string.html" aria-label="æ·±å…¥æµ…å‡º String å­—ç¬¦ä¸²"><!--[--><iconify-icon class="vp-icon" icon="ant-design:field-string-outlined" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->æ·±å…¥æµ…å‡º String å­—ç¬¦ä¸²<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/distribute/jenkins_pipeline.html" aria-label="Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£"><!--[--><iconify-icon class="vp-icon" icon="vscode-icons:file-type-jenkins" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->Jenkins æµæ°´çº¿å¿«é€Ÿç†è§£<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/intro.html" aria-label="å…³äºä½œè€…"><!--[--><iconify-icon class="vp-icon" icon="openmoji:black-hole" height="1em" sizing="height"></iconify-icon><!--]-->å…³äºä½œè€…<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/yudi-corgi" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><iconify-icon class="vp-icon" icon="home" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->åšå®¢ä¸»é¡µ<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="vp-icon" icon="book" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="vp-icon" icon="book" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">æ¡†æ¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="vp-icon" icon="book" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">åˆ†å¸ƒå¼é¢†åŸŸ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="vp-icon" icon="book" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">å¼€å‘æŠ€å·§</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="vp-icon" icon="book" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">æ‚è°ˆ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/reprint/sharded_does_not_imply_distributed.html" aria-label="åˆ†ç‰‡å¹¶ä¸æ„å‘³ç€åˆ†å¸ƒå¼"><!--[--><iconify-icon class="vp-icon" icon="tabler:blade" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->åˆ†ç‰‡å¹¶ä¸æ„å‘³ç€åˆ†å¸ƒå¼<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/reprint/is_it_time_to_ditch_mysql_and_postgresql_for_sqlite.html" aria-label="æ˜¯æ—¶å€™æ”¾å¼ƒ MySQL å’Œ PostgreSQL è€Œè½¬è€Œä½¿ç”¨ SQLite äº†å—ï¼Ÿ"><!--[--><iconify-icon class="vp-icon" icon="file-icons:sqlite" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->æ˜¯æ—¶å€™æ”¾å¼ƒ MySQL å’Œ PostgreSQL è€Œè½¬è€Œä½¿ç”¨ SQLite äº†å—ï¼Ÿ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/reprint/how_does_b-tree_make_your_queries_fast.html" aria-label="B æ ‘å¦‚ä½•è®©æ‚¨çš„æŸ¥è¯¢æ›´å¿«ï¼Ÿ"><!--[--><iconify-icon class="vp-icon" icon="carbon:tree-view" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->B æ ‘å¦‚ä½•è®©æ‚¨çš„æŸ¥è¯¢æ›´å¿«ï¼Ÿ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/reprint/webSockets_vs_server-sent-events_vs_long-polling_vs_webrtc_vs_webtransport.html" aria-label="WebSocket vs SSE vs Long-Polling vs WebRTC vs WebTransport"><!--[--><iconify-icon class="vp-icon" icon="maki:communications-tower" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->WebSocket vs SSE vs Long-Polling vs WebRTC vs WebTransport<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/reprint/why_is_oauth_still_hard_in_2025.html" aria-label="ä¸ºä»€ä¹ˆ OAuth åœ¨ 2025 å¹´ä»ç„¶éš¾ä»¥å®ç°ï¼Ÿ"><!--[--><iconify-icon class="vp-icon" icon="devicon-plain:oauth" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->ä¸ºä»€ä¹ˆ OAuth åœ¨ 2025 å¹´ä»ç„¶éš¾ä»¥å®ç°ï¼Ÿ<!----></a></li></ul></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/intro.html" aria-label="å…³äºä½œè€…"><!--[--><iconify-icon class="vp-icon" icon="circle-info" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->å…³äºä½œè€…<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><div class="page-cover"><img src="/assets/images/minions_cover8.jpg" alt no-view></div><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="vp-icon" icon="devicon-plain:oauth" height="1em" sizing="height"></iconify-icon>ä¸ºä»€ä¹ˆ OAuth åœ¨ 2025 å¹´ä»ç„¶éš¾ä»¥å®ç°ï¼Ÿ</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/yudi-corgi" target="_blank" rel="noopener noreferrer">YUDI-Corgi</a></span><span property="author" content="YUDI-Corgi"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2025/5/28</span><meta property="datePublished" content="2025-05-28T00:00:00.000Z"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color1 clickable" role="navigation">æ‚è°ˆ</span><!--]--><meta property="articleSection" content="æ‚è°ˆ"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color1 clickable" role="navigation">æ‚è°ˆ</span><!--]--><meta property="keywords" content="æ‚è°ˆ"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 26 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT26M"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h2 id="å†™åœ¨å‰å¤´" tabindex="-1"><a class="header-anchor" href="#å†™åœ¨å‰å¤´"><span>å†™åœ¨å‰å¤´</span></a></h2><p>æœ¬ç¯‡æ˜¯ <a href="https://www.nango.dev/blog/why-is-oauth-still-hard" target="_blank" rel="noopener noreferrer">Why is OAuth still hard in 2025?</a> ä¸€æ–‡çš„ä¸­æ–‡ç¿»è¯‘ï¼Œæ–‡ç« å†…å®¹ç¿”å®ï¼Œè¯´æ˜äº† OAuth çš„å¤æ‚æ€§ã€å®‰å…¨æ€§ã€å®é™…åº”ç”¨å›°éš¾ç­‰æ–¹é¢çš„é—®é¢˜ã€‚</p><p><strong>ä»¥ä¸‹æ˜¯å¤ªé•¿ä¸çœ‹ç‰ˆï¼ˆç”± AI æ•´ç†ï¼‰</strong>ï¼š</p><p>å°½ç®¡ OAuth 2.0 æ˜¯ä¸€ä¸ªæ—¨åœ¨ç®€åŒ–æˆæƒçš„æ ‡å‡†åè®®ï¼Œå¹¶ä¸”æ‹¥æœ‰ä¼—å¤šè¯­è¨€çš„å®¢æˆ·ç«¯åº“ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå®ƒä¾ç„¶åƒ 2008 å¹´çš„ JavaScript æµè§ˆå™¨ API ä¸€æ ·æ··ä¹±å’Œå……æ»¡æŒ‘æˆ˜ã€‚å¼€å‘è€…åœ¨é›†æˆå„ä¸ª API æ—¶ï¼Œä¼šå‘ç°æ¯ä¸ª API å¯¹ OAuth çš„è§£è¯»ã€å®ç°æ–¹å¼ä»¥åŠéæ ‡å‡†è¡Œä¸ºéƒ½å­˜åœ¨å·®å¼‚ï¼Œå¯¼è‡´å¤„å¤„ç¢°å£</p><p>ä»¥ä¸‹æ˜¯å¯¼è‡´ OAuth æŒç»­å¤æ‚çš„å‡ ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š</p><ol><li><strong>OAuth æ ‡å‡†æœ¬èº«çš„å¤æ‚æ€§ä¸å¤šæ ·æ€§</strong>ï¼šOAuth 2.0 ç”±ä¼—å¤š RFC æ–‡æ¡£å®šä¹‰ï¼Œå¯¼è‡´å„ API æä¾›å•†é€šå¸¸åªå®ç°éƒ¨åˆ†æ ‡å‡†ï¼Œé€ æˆäº† OAuth å®ç°çš„å¤šæ ·æ€§å’Œä¸ä¸€è‡´æ€§. å¼€å‘è€…éœ€è¦ç†è§£ä¸åŒç‰ˆæœ¬çš„ OAuthã€å¤šç§æˆæƒç±»å‹åŠå…¶é€‚ç”¨åœºæ™¯ï¼Œä»¥åŠå¤„ç†åƒåˆ·æ–° token è·å–è¿™ç±»å¹¶éå®Œå…¨æ ‡å‡†åŒ–çš„æµç¨‹</li><li><strong>å„ API çš„ OAuth å®ç°å·®å¼‚æ˜¾è‘—</strong>ï¼šå¼€å‘è€…ä¼šå‘ç°ï¼Œå‡ ä¹æ¯ä¸ª API éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ OAuth å®ç°æ–¹å¼. è¿™åŒ…æ‹¬æˆæƒè¯·æ±‚å‚æ•°çš„ä¸åŒã€è·å–åˆ·æ–° token (offline access) æ–¹å¼çš„å·®å¼‚ã€token è¯·æ±‚æ ¼å¼çš„å¤šæ ·æ€§ï¼ˆå¦‚ header vs body, form-encoded vs JSONï¼‰ã€æˆæƒæœåŠ¡å™¨ URL çš„åŠ¨æ€æ„å»ºéœ€æ±‚ï¼Œä»¥åŠå¯¹å›è°ƒ URL çš„ç‰¹å®šé™åˆ¶ï¼ˆå¦‚ Slack è¦æ±‚ localhost ä½¿ç”¨ httpsï¼‰</li><li><strong>æ™®éå­˜åœ¨çš„éæ ‡å‡†æ‰©å±•</strong>ï¼šè®¸å¤š API ä¸ºäº†æ»¡è¶³è‡ªèº«å¹³å°çš„ç‰¹å®šéœ€æ±‚ï¼Œåœ¨æ ‡å‡†çš„ OAuth æµç¨‹ä¸­å¼•å…¥äº†éæ ‡å‡†å‚æ•°æˆ–è¡Œä¸º. ä¾‹å¦‚ï¼Œä¸€äº› API ä¼šåœ¨å›è°ƒä¸­è¿”å›åç»­ API è°ƒç”¨æ‰€å¿…éœ€çš„é¢å¤–æ ‡è¯†ç¬¦ï¼Œæˆ–è€…åœ¨ token å“åº”ä¸­æä¾› API åŸºç¡€ URL ç­‰éæ ‡å‡†ä¿¡æ¯</li><li><strong>è°ƒè¯•å›°éš¾çš„æ¨¡ç³Šé”™è¯¯ä¿¡æ¯</strong>ï¼šOAuth æ ‡å‡†åŒ–çš„é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚ &quot;invalid_request&quot;ï¼‰é€šå¸¸è¿‡äºå®½æ³›ï¼Œéš¾ä»¥å¸®åŠ©å¼€å‘è€…å‡†ç¡®å®šä½é—®é¢˜. æ–‡æ¡£ä¸å®Œå–„æˆ–è¿‡æ—¶ä¹ŸåŠ å‰§äº†è°ƒè¯•éš¾åº¦ï¼Œå¯¼è‡´è®¸å¤š OAuth é›†æˆåœ¨åˆæ¬¡å°è¯•æ—¶éƒ½éœ€è¦å¤§é‡æ’é”™</li><li><strong>å†—é•¿ä¸”è¦æ±‚å„å¼‚çš„åº”ç”¨å®¡æ‰¹æµç¨‹</strong>ï¼šè™½ç„¶éƒ¨åˆ† API æä¾›è‡ªåŠ©æ³¨å†Œï¼Œä½†è®¸å¤šä¸»æµ APIï¼ˆç‰¹åˆ«æ˜¯æ¶‰åŠæ•æ„Ÿæ•°æ®æˆ–æ‹¥æœ‰åº”ç”¨å¸‚åœºçš„å¹³å°ï¼‰ä¼šè¦æ±‚è¿›è¡Œå®‰å…¨å®¡æŸ¥æˆ–åº”ç”¨å®¡æ ¸ï¼Œè¿‡ç¨‹å¯èƒ½è€—æ—¶æ•°å¤©åˆ°æ•°æœˆï¼Œä¸”å„å¹³å°è¦æ±‚ä¸ä¸€. éƒ¨åˆ† API ç”šè‡³æ²¡æœ‰è‡ªåŠ©æ³¨å†Œæµç¨‹æˆ–å°† API è®¿é—®å•†ä¸šåŒ–</li><li><strong>ä¸æ–­æ¼”è¿›çš„å®‰å…¨å®è·µå¸¦æ¥çš„é¢å¤–è´Ÿæ‹…</strong>ï¼šä¸ºäº†åº”å¯¹æ–°çš„å®‰å…¨å¨èƒï¼ŒOAuth æ ‡å‡†å’Œæœ€ä½³å®è·µåœ¨ä¸æ–­å‘å±•ï¼ˆå¦‚å¼ºåˆ¶ PKCE å’Œæ›´ä¸¥æ ¼çš„ refresh token ç®¡ç†ï¼‰. è¿™è¦æ±‚å¼€å‘è€…æŒç»­è·Ÿè¿›å¹¶è°ƒæ•´å®ç°ï¼ŒåŒæ—¶å¦¥å–„å¤„ç† access token è¿‡æœŸã€refresh token çš„å¹¶å‘åˆ·æ–°ã€å¤±æ•ˆä»¥åŠæ›´æ–°ç­–ç•¥ç­‰å¤æ‚é—®é¢˜</li></ol><p>æ–‡ç« æœ€åè¿˜æåŠäº†å…¶ä»–éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼Œä¾‹å¦‚å®‰å…¨å­˜å‚¨ tokenã€æ£€æŸ¥æˆæƒèŒƒå›´ã€å¤„ç†ç”¨æˆ·æ’¤é”€æˆæƒã€API å˜æ›´ç­‰ï¼Œå¹¶æ¨èä½¿ç”¨ Nango è¿™æ ·çš„å·¥å…·æ¥ç®€åŒ– OAuth é›†æˆã€‚</p><p><strong>ä»¥ä¸‹æ˜¯åŸæ–‡+ç¿»è¯‘ï¼š</strong></p><h2 id="ä¸ºä»€ä¹ˆ-2025-å¹´-oauth-ä»ç„¶å¾ˆéš¾-why-is-oauth-still-hard-in-2025" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-2025-å¹´-oauth-ä»ç„¶å¾ˆéš¾-why-is-oauth-still-hard-in-2025"><span>ä¸ºä»€ä¹ˆ 2025 å¹´ OAuth ä»ç„¶å¾ˆéš¾ï¼Ÿ<br> Why is OAuth still hard in 2025?</span></a></h2><p>We implemented OAuth for the 50 most popular APIs. TL;DR: It is still a mess.<br> æˆ‘ä»¬ä¸º 50 ä¸ªæœ€æµè¡Œçš„ API å®ç°äº† OAuthã€‚TL;DRï¼ˆTong long, did&#39;t readï¼‰ï¼šä»ç„¶æ˜¯ä¸€å›¢ç³Ÿã€‚</p><p>OAuth is a standard protocol. Right? And there are client libraries for OAuth 2.0 <a href="https://oauth.net/code/nodejs/" target="_blank" rel="noopener noreferrer">available</a> <a href="https://oauth.net/code/php/" target="_blank" rel="noopener noreferrer">in</a> <a href="https://oauth.net/code/java/" target="_blank" rel="noopener noreferrer">basically</a> <a href="https://oauth.net/code/python/" target="_blank" rel="noopener noreferrer">every</a> <a href="https://oauth.net/code/go/" target="_blank" rel="noopener noreferrer">programming</a> <a href="https://oauth.net/code/rust/" target="_blank" rel="noopener noreferrer">language</a> <a href="https://oauth.net/code/dotnet/" target="_blank" rel="noopener noreferrer">you</a> <a href="https://oauth.net/code/kotlin/" target="_blank" rel="noopener noreferrer">can</a> <a href="https://oauth.net/code/swift/" target="_blank" rel="noopener noreferrer">imagine</a>.<br> OAuth æ˜¯ä¸€ä¸ªæ ‡å‡†åè®®ï¼Œå¯¹å§ï¼ŸåŸºæœ¬ä¸Šæ‚¨èƒ½æƒ³è±¡åˆ°çš„æ¯ç§ç¼–ç¨‹è¯­è¨€éƒ½æœ‰é€‚ç”¨äº OAuth 2.0 çš„å®¢æˆ·ç«¯åº“ã€‚</p><p>You might conclude that, armed with a client library, you would be able to implement OAuth for any API in about 10 minutes. Or at least in an hour.<br> æ‚¨å¯èƒ½ä¼šå¾—å‡ºç»“è®ºï¼Œé…å¤‡å®¢æˆ·ç«¯åº“åï¼Œæ‚¨å°†èƒ½å¤Ÿåœ¨å¤§çº¦ 10 åˆ†é’Ÿå†…ä¸ºä»»ä½• API å®ç° OAuthï¼Œæˆ–è€…è‡³å°‘ä¸€ä¸ªå°æ—¶å†…ã€‚</p><p>If you manage, please email us â€” weâ€™d like to treat you to a delicious dinner and hear how you did it.<br> å¦‚æœæ‚¨æˆåŠŸäº†ï¼Œè¯·ç»™æˆ‘ä»¬å‘ç”µå­é‚®ä»¶â€”â€”æˆ‘ä»¬å¾ˆä¹æ„è¯·æ‚¨äº«ç”¨ä¸€é¡¿ç¾å‘³çš„æ™šé¤ï¼Œå¹¶å¬å¬æ‚¨æ˜¯å¦‚ä½•åšåˆ°çš„ã€‚</p><h3 id="oauth-å®è·µ-oauth-in-practice" tabindex="-1"><a class="header-anchor" href="#oauth-å®è·µ-oauth-in-practice"><span>OAuth å®è·µ <br>OAuth in practice</span></a></h3><p>We implemented OAuth for the 50 most popular APIs, such as Google (Gmail, Calendar, Sheets etc.), HubSpot, Shopify, Salesforce, Stripe, Jira, Slack, Microsoft (Azure, Outlook, OneDrive), LinkedIn, Facebook and <a href="https://docs.nango.dev/providers" target="_blank" rel="noopener noreferrer">other OAuth APIs.</a>â€<br> æˆ‘ä»¬ä¸º 50 ä¸ªæœ€æµè¡Œçš„ API å®ç°äº† OAuthï¼Œä¾‹å¦‚ Googleï¼ˆGmailã€æ—¥å†ã€è¡¨æ ¼ç­‰ï¼‰ã€HubSpotã€Shopifyã€Salesforceã€Stripeã€Jiraã€Slackã€Microsoftï¼ˆAzureã€Outlookã€OneDriveï¼‰ã€LinkedInã€Facebook å’Œå…¶ä»– OAuthèœœèœ‚</p><p>Our conclusion: The real-world OAuth experience is comparable to JavaScript browser APIs in 2008. Thereâ€™s a general consensus on how things should be done, but in reality every API has its own interpretation of the standard, implementation quirks, and nonstandard behaviors and extensions. The result: footguns behind every corner.<br> æˆ‘ä»¬çš„ç»“è®ºï¼šç°å®ä¸–ç•Œçš„ OAuth ä½“éªŒå¯ä¸ 2008 å¹´çš„ JavaScript æµè§ˆå™¨ API ç›¸åª²ç¾ã€‚å¯¹äºåº”è¯¥å¦‚ä½•å®Œæˆå·¥ä½œå­˜åœ¨æ™®éå…±è¯†ï¼Œä½†å®é™…ä¸Šæ¯ä¸ª API å¯¹æ ‡å‡†ã€å®ç°æ€ªç™–ä»¥åŠéæ ‡å‡†è¡Œä¸ºå’Œæ‰©å±•éƒ½æœ‰è‡ªå·±çš„è§£é‡Šã€‚ç»“æœæ˜¯ï¼šæ¯ä¸ªè§’è½åé¢éƒ½æœ‰æªã€‚</p><p>If it werenâ€™t so annoying, it would be quite funny. Letâ€™s dive in!<br> å¦‚æœä¸æ˜¯é‚£ä¹ˆçƒ¦äººçš„è¯ï¼Œé‚£å°±å¾ˆæœ‰è¶£äº†ã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ï¼</p><h2 id="é—®é¢˜-1-oauth-æ ‡å‡†å¤ªå¤§ä¸”å¤æ‚-problem-1-the-oauth-standard-is-just-too-big-and-complex" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜-1-oauth-æ ‡å‡†å¤ªå¤§ä¸”å¤æ‚-problem-1-the-oauth-standard-is-just-too-big-and-complex"><span>é—®é¢˜ 1ï¼šOAuth æ ‡å‡†å¤ªå¤§ä¸”å¤æ‚ <br>Problem 1: The OAuth standard is just too big and complex</span></a></h2><blockquote><p>â€œThis API also uses OAuth 2.0, and we already did that a few weeks ago. I should be done by tomorrow.â€<br> â€œè¿™ä¸ª API è¿˜ä½¿ç”¨ OAuth 2.0ï¼Œæˆ‘ä»¬å‡ å‘¨å‰å°±å·²ç»è¿™æ ·åšäº†ã€‚æˆ‘åº”è¯¥åœ¨æ˜å¤©ä¹‹å‰å®Œæˆã€‚â€<br> â€“ Famous last words from the intern<br> â€”â€”å®ä¹ ç”Ÿè‘—åçš„é—è¨€</p></blockquote><p>OAuth is a very big standard. The <a href="https://oauth.net/2/" target="_blank" rel="noopener noreferrer">OAuth 2.0â€™s official site</a> currently lists 17 different RFCs (documents defining a standard) that together define how OAuth 2 works. They cover everything from the OAuth framework and Bearer tokens to threat models and private key JWTs.<br> OAuth æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ ‡å‡†ã€‚ OAuth 2.0 çš„å®˜æ–¹ç½‘ç«™ç›®å‰åˆ—å‡ºäº† 17 ä¸ªä¸åŒçš„ RFCï¼ˆå®šä¹‰æ ‡å‡†çš„æ–‡æ¡£ï¼‰ï¼Œå®ƒä»¬å…±åŒå®šä¹‰äº† OAuth 2 çš„å·¥ä½œæ–¹å¼ã€‚å®ƒä»¬æ¶µç›–äº†ä» OAuth æ¡†æ¶å’Œ Bearer ä»¤ç‰Œåˆ°å¨èƒæ¨¡å‹å’Œç§é’¥ JWT çš„æ‰€æœ‰å†…å®¹ã€‚</p><p>â€œBut,â€ I hear you say, â€œsurely not all of these RFCs are relevant for a simple third-party-access token authorization with an API?â€<br> â€œä½†æ˜¯ï¼Œâ€æˆ‘å¬åˆ°æ‚¨è¯´ï¼Œâ€œè‚¯å®šä¸æ˜¯æ‰€æœ‰è¿™äº› RFC éƒ½ä¸ä½¿ç”¨ API çš„ç®€å•ç¬¬ä¸‰æ–¹è®¿é—®ä»¤ç‰Œæˆæƒç›¸å…³å—ï¼Ÿâ€</p><p>Youâ€™re right. Letâ€™s focus only on the things that are likely to be relevant for the typical API third-party-access use case:<br> æ˜¯çš„ã€‚è®©æˆ‘ä»¬åªå…³æ³¨å¯èƒ½ä¸å…¸å‹ API ç¬¬ä¸‰æ–¹è®¿é—®ç”¨ä¾‹ç›¸å…³çš„å†…å®¹ï¼š</p><ul><li>OAuth standard: OAuth 2.0 is the default now, but OAuth 1.0a is still used by some (and 2.1 is around the corner). Once you know which one your API uses, move on to:<br> OAuth æ ‡å‡†ï¼šOAuth 2.0 ç°åœ¨æ˜¯é»˜è®¤å€¼ï¼Œä½† OAuth 1.0a ä»ç„¶è¢«ä¸€äº›äººä½¿ç”¨ï¼ˆ2.1 å³å°†æ¨å‡ºï¼‰ã€‚ä¸€æ—¦æ‚¨çŸ¥é“æ‚¨çš„ API ä½¿ç”¨å“ªä¸€ä¸ªï¼Œè¯·ç»§ç»­ï¼š</li><li>Grant type: Do you need authorization_code, client_credentials, or device_code? What do they do, and when should you use each of them? When in doubt, try authorization_code.<br> æˆæƒç±»å‹ï¼šæ‚¨éœ€è¦ authorization_codeã€client_credentials æˆ– device_code å—ï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Œä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨å®ƒä»¬ï¼Ÿå¦‚æœ‰ç–‘é—®ï¼Œè¯·å°è¯• authorization_codeã€‚</li><li>Side note: Refresh tokens are also a grant type, but kind of a special one. How they work is standardized, but how you ask for them in the first place is not. More on that later.<br> æ—æ³¨ï¼šåˆ·æ–°ä»¤ç‰Œä¹Ÿæ˜¯ä¸€ç§æˆäºˆç±»å‹ï¼Œä½†æœ‰ç‚¹ç‰¹æ®Šã€‚å®ƒä»¬çš„å·¥ä½œæ–¹å¼æ˜¯æ ‡å‡†åŒ–çš„ï¼Œä½†æ‚¨æœ€åˆè¦æ±‚å®ƒä»¬çš„æ–¹å¼å´ä¸æ˜¯æ ‡å‡†åŒ–çš„ã€‚ç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚</li><li>Now that youâ€™re ready for your requests, letâ€™s look at the many (72, to be precise) <a href="https://www.iana.org/assignments/oauth-parameters/oauth-parameters.xhtml" target="_blank" rel="noopener noreferrer">official OAuth parameters</a> with a defined meaning and behavior. Common examples are prompt, scope, audience, resource, assertion, and login_hint. However, in our experience, most API providers seem to be as oblivious to this list as you probably were until now, so don&#39;t worry too much about it.<br> ç°åœ¨æ‚¨å·²å‡†å¤‡å¥½æ¥æ”¶è¯·æ±‚ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è®¸å¤šï¼ˆå‡†ç¡®åœ°è¯´æ˜¯ 72 ä¸ªï¼‰å…·æœ‰å®šä¹‰å«ä¹‰å’Œè¡Œä¸ºçš„å®˜æ–¹ OAuth å‚æ•°ã€‚å¸¸è§ç¤ºä¾‹æœ‰æç¤ºã€èŒƒå›´ã€å—ä¼—ã€èµ„æºã€æ–­è¨€å’Œç™»å½•æç¤ºã€‚ç„¶è€Œï¼Œæ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œå¤§å¤šæ•° API æä¾›å•†ä¼¼ä¹éƒ½åƒæ‚¨åˆ°ç›®å‰ä¸ºæ­¢ä¸€æ ·å¿½è§†äº†æ­¤åˆ—è¡¨ï¼Œå› æ­¤ä¸å¿…å¤ªæ‹…å¿ƒã€‚</li></ul><p>If you think this still feels too complicated and like a lot to learn, we tend to agree with you.<br> å¦‚æœæ‚¨è®¤ä¸ºè¿™ä»ç„¶æ„Ÿè§‰å¤ªå¤æ‚å¹¶ä¸”éœ€è¦å­¦ä¹ å¾ˆå¤šä¸œè¥¿ï¼Œæˆ‘ä»¬å€¾å‘äºåŒæ„æ‚¨çš„è§‚ç‚¹ã€‚</p><p>Most teams building public APIs seem to agree as well. Instead of implementing a full OAuth 2.0 subset, they just implement the parts of OAuth they think they need for their APIâ€™s use case. This leads to pretty long pages in docs outlining how OAuth works for this particular API. But we have a hard time blaming them; they have only the best intentions in mind for their DX. And if they truly tried to implement the full standard, youâ€™d need to read a small book!<br> å¤§å¤šæ•°æ„å»ºå…¬å…± API çš„å›¢é˜Ÿä¼¼ä¹ä¹ŸåŒæ„è¿™ä¸€ç‚¹ã€‚ä»–ä»¬æ²¡æœ‰å®ç°å®Œæ•´çš„ OAuth 2.0 å­é›†ï¼Œè€Œæ˜¯åªå®ç°ä»–ä»¬è®¤ä¸º API ç”¨ä¾‹æ‰€éœ€çš„ OAuth éƒ¨åˆ†ã€‚è¿™å¯¼è‡´æ–‡æ¡£ä¸­å‡ºç°ç›¸å½“é•¿çš„é¡µé¢æ¥æ¦‚è¿° OAuth å¦‚ä½•é’ˆå¯¹æ­¤ç‰¹å®š API å·¥ä½œã€‚ä½†æˆ‘ä»¬å¾ˆéš¾è´£æ€ªä»–ä»¬ï¼›ä»–ä»¬å¯¹ DX çš„æƒ³æ³•åªæœ‰æœ€å¥½çš„ã€‚å¦‚æœä»–ä»¬çœŸçš„å°è¯•å®æ–½å®Œæ•´çš„æ ‡å‡†ï¼Œæ‚¨éœ€è¦é˜…è¯»ä¸€æœ¬å°ä¹¦ï¼</p><figure><img src="/assets/oauth_hard1-8STLze2M.png" alt="The Salesforce authorization_code OAuth flow. What&#39;s not to like about a clear visual for this simple 10-step process? &lt;br&gt;Salesforce authorization_code OAuth æµç¨‹ã€‚ä¸ºä»€ä¹ˆä¸å–œæ¬¢è¿™ä¸ªç®€å•çš„ 10 æ­¥æµç¨‹çš„æ¸…æ™°è§†è§‰æ•ˆæœå‘¢ï¼Ÿ" tabindex="0" loading="lazy"><figcaption>The Salesforce authorization_code OAuth flow. What&#39;s not to like about a clear visual for this simple 10-step process? <br>Salesforce authorization_code OAuth æµç¨‹ã€‚ä¸ºä»€ä¹ˆä¸å–œæ¬¢è¿™ä¸ªç®€å•çš„ 10 æ­¥æµç¨‹çš„æ¸…æ™°è§†è§‰æ•ˆæœå‘¢ï¼Ÿ</figcaption></figure><p>The trouble is that everybody has a slightly different idea of which subset of OAuth is relevant for them, so you end up with lots of different (sub-) implementations.<br> é—®é¢˜åœ¨äºï¼Œæ¯ä¸ªäººå¯¹äº OAuth çš„å“ªä¸ªå­é›†ä¸ä»–ä»¬ç›¸å…³çš„æƒ³æ³•éƒ½ç•¥æœ‰ä¸åŒï¼Œå› æ­¤æœ€ç»ˆä¼šå¾—åˆ°è®¸å¤šä¸åŒçš„ï¼ˆå­ï¼‰å®ç°ã€‚</p><h2 id="é—®é¢˜-2-æ¯ä¸ªäººçš„-oauth-éƒ½æœ‰ç»†å¾®çš„å·®åˆ«-problem-2-everybody-s-oauth-is-different-in-subtle-ways" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜-2-æ¯ä¸ªäººçš„-oauth-éƒ½æœ‰ç»†å¾®çš„å·®åˆ«-problem-2-everybody-s-oauth-is-different-in-subtle-ways"><span>é—®é¢˜ 2ï¼šæ¯ä¸ªäººçš„ OAuth éƒ½æœ‰ç»†å¾®çš„å·®åˆ« <br>Problem 2: Everybodyâ€™s OAuth is different in subtle ways</span></a></h2><p>As every API implements a different subset of OAuth, you quickly get into a situation where you are forced to read their long pages of OAuth docs in detail:<br> ç”±äºæ¯ä¸ª API éƒ½å®ç° OAuth çš„ä¸åŒå­é›†ï¼Œå› æ­¤æ‚¨å¾ˆå¿«å°±ä¼šé™·å…¥è¢«è¿«è¯¦ç»†é˜…è¯»å…¶é•¿é¡µ OAuth æ–‡æ¡£çš„æƒ…å†µï¼š</p><ul><li><p>Which parameters do they require in the authorize call?<br> ä»–ä»¬åœ¨æˆæƒè°ƒç”¨ä¸­éœ€è¦å“ªäº›å‚æ•°ï¼Ÿ</p><ul><li>For Jira, the <code>audience</code> parameter is key (and must be set to a specific fixed value). Google prefers to handle this through different scopes but really cares about the <code>prompt</code> parameter. Meanwhile, somebody at Microsoft discovered the <code>response_mode</code> parameter and demands that you always set it to <code>query</code>.<br> å¯¹äº Jira æ¥è¯´ï¼Œ<code>audience</code> å‚æ•°æ˜¯å…³é”®ï¼ˆå¹¶ä¸”å¿…é¡»è®¾ç½®ä¸ºç‰¹å®šçš„å›ºå®šå€¼ï¼‰ã€‚è°·æ­Œæ›´å–œæ¬¢é€šè¿‡ä¸åŒçš„èŒƒå›´æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œä½†çœŸæ­£å…³å¿ƒçš„æ˜¯ <code>prompt</code> å‚æ•°ã€‚ä¸æ­¤åŒæ—¶ï¼Œå¾®è½¯çš„æŸäººå‘ç°äº† <code>response_mode</code> å‚æ•°å¹¶è¦æ±‚ä½ å§‹ç»ˆå°†å…¶è®¾ç½®ä¸º <code>query</code>ã€‚</li><li>The Notion API takes a radical approach and does away with the ubiquitous <code>scope</code> parameter. In fact, you wonâ€™t even find the word â€œscopeâ€ in their API docs. Notion calls them â€œcapabilities,â€ and you set them when you register the app. It took us 30 confused minutes to understand what was going on. Why did they reinvent this wheel?<br> Notion API é‡‡ç”¨äº†ä¸€ç§æ¿€è¿›çš„æ–¹æ³•ï¼Œå–æ¶ˆäº†æ— å¤„ä¸åœ¨çš„ä½œç”¨åŸŸå‚æ•°ã€‚äº‹å®ä¸Šï¼Œæ‚¨ç”šè‡³åœ¨ä»–ä»¬çš„ API æ–‡æ¡£ä¸­æ‰¾ä¸åˆ° <code>scope</code> è¿™ä¸ªè¯ã€‚ Notion å°†å®ƒä»¬ç§°ä¸ºâ€œåŠŸèƒ½â€ï¼Œæ‚¨å¯ä»¥åœ¨æ³¨å†Œåº”ç”¨ç¨‹åºæ—¶è®¾ç½®å®ƒä»¬ã€‚æˆ‘ä»¬å›°æƒ‘åœ°èŠ±äº† 30 åˆ†é’Ÿæ‰æ˜ç™½å‘ç”Ÿäº†ä»€ä¹ˆäº‹ã€‚ä»–ä»¬ä¸ºä»€ä¹ˆè¦é‡æ–°å‘æ˜è¿™ä¸ªè½®å­ï¼Ÿ</li><li>It gets worse with <code>offline_access</code>: Most APIs these days expire access tokens after a short while. To get a refresh token, you need to request â€œoffline_access,â€ which needs to be done through a parameter, a scope, or something you set when you register your OAuth app. Ask your API or OAuth doctor for details.<br><code>offline_access</code> çš„æƒ…å†µä¼šå˜å¾—æ›´ç³Ÿï¼šç°åœ¨å¤§å¤šæ•° API çš„è®¿é—®ä»¤ç‰Œéƒ½ä¼šåœ¨çŸ­æ—¶é—´å†…è¿‡æœŸã€‚è¦è·å–åˆ·æ–°ä»¤ç‰Œï¼Œæ‚¨éœ€è¦è¯·æ±‚ <code>offline_access</code>ï¼Œè¿™éœ€è¦é€šè¿‡å‚æ•°ã€èŒƒå›´æˆ–æ³¨å†Œ OAuth åº”ç”¨ç¨‹åºæ—¶è®¾ç½®çš„å†…å®¹æ¥å®Œæˆã€‚è¯·å’¨è¯¢æ‚¨çš„ API æˆ– OAuth åŒ»ç”Ÿäº†è§£è¯¦ç»†ä¿¡æ¯ã€‚</li></ul></li><li><p>What do they want to see in the token request call?<br> ä»–ä»¬å¸Œæœ›åœ¨ä»¤ç‰Œè¯·æ±‚è°ƒç”¨ä¸­çœ‹åˆ°ä»€ä¹ˆï¼Ÿ</p><ul><li>Some APIs, like Fitbit, insist on getting data in the headers. Most really want it in the body, encoded as <code>x-www-url-form-encoded</code>, except for a few, such as Notion, which prefer to get it as JSON.<br> ä¸€äº› APIï¼ˆä¾‹å¦‚ Fitbitï¼‰åšæŒåœ¨æ ‡å¤´ä¸­è·å–æ•°æ®ã€‚å¤§å¤šæ•°äººç¡®å®å¸Œæœ›å®ƒåœ¨æ­£æ–‡ä¸­ï¼Œç¼–ç ä¸º <code>x-www-url-form-encoded</code>ï¼Œä½†å°‘æ•°äººï¼ˆä¾‹å¦‚ Notionï¼‰æ›´å–œæ¬¢å°†å…¶ç¼–ç ä¸º JSONã€‚</li><li>Some want you to authenticate this request with Basic auth. Many donâ€™t bother with that. But beware, they may change their mind tomorrow.<br> æœ‰äº›äººå¸Œæœ›æ‚¨ä½¿ç”¨åŸºæœ¬èº«ä»½éªŒè¯æ¥éªŒè¯æ­¤è¯·æ±‚ã€‚è®¸å¤šäººå¯¹æ­¤ä¸å±‘ä¸€é¡¾ã€‚ä½†è¦å°å¿ƒï¼Œä»–ä»¬æ˜å¤©å¯èƒ½ä¼šæ”¹å˜ä¸»æ„ã€‚</li></ul></li><li><p>Where should I redirect my users to authorize?<br> æˆ‘åº”è¯¥å°†ç”¨æˆ·é‡å®šå‘åˆ°å“ªé‡Œè¿›è¡Œæˆæƒï¼Ÿ</p><ul><li><p>Shopify and Zendesk have a model in which every user gets a subdomain like {subdomain}.myshopify.com. And yes, that includes the OAuth authorization page, so youâ€™d better build dynamic URLs into your model and frontend code.<br> Shopify å’Œ Zendesk æœ‰ä¸€ä¸ªæ¨¡å‹ï¼Œå…¶ä¸­æ¯ä¸ªç”¨æˆ·éƒ½ä¼šè·å¾—ä¸€ä¸ªå­åŸŸï¼Œä¾‹å¦‚ {subdomain}.myshopify.comã€‚æ˜¯çš„ï¼Œå…¶ä¸­åŒ…æ‹¬ OAuth æˆæƒé¡µé¢ï¼Œå› æ­¤æ‚¨æœ€å¥½å°†åŠ¨æ€ URL æ„å»ºåˆ°æ¨¡å‹å’Œå‰ç«¯ä»£ç ä¸­ã€‚</p></li><li><p>Zoho Books has different data centers for their customers in different locations. Hopefully, they remember where their data resides: To authorize your app, your U.S. customers should go to https://accounts.zoho.com, Europeans can visit https://accounts.zoho.eu, and Indians are welcome at https://accounts.zoho.in. The list goes on.<br> Zoho Books åœ¨ä¸åŒåœ°ç‚¹ä¸ºå®¢æˆ·æä¾›ä¸åŒçš„æ•°æ®ä¸­å¿ƒã€‚å¸Œæœ›ä»–ä»¬è®°ä½æ•°æ®æ‰€åœ¨çš„ä½ç½®ï¼šè¦æˆæƒæ‚¨çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨çš„ç¾å›½å®¢æˆ·åº”è®¿é—® https://accounts.zoho.comï¼Œæ¬§æ´²å®¢æˆ·å¯ä»¥è®¿é—® https://accounts.zoho.euï¼Œæ¬¢è¿å°åº¦å®¢æˆ·è®¿é—® https://accounts.zoho.inã€‚è¿™æ ·çš„ä¾‹å­è¿˜åœ¨ç»§ç»­ã€‚</p></li></ul></li><li><p>But at least I can pick my callback URL, no?<br> ä½†è‡³å°‘æˆ‘å¯ä»¥é€‰æ‹©æˆ‘çš„å›è°ƒ URLï¼Œä¸æ˜¯å—ï¼Ÿ</p><ul><li>If you enter http://localhost:3003/callback as a callback for the Slack API, they kindly remind you to â€œPlease use https for security.â€ Yes, also for localhost. Luckily <a href="https://www.nango.dev/blog/oauth-redirects-on-localhost-with-https" target="_blank" rel="noopener noreferrer">there are solutions for OAuth redirects on localhost</a>.<br> å¦‚æœæ‚¨è¾“å…¥ http://localhost:3003/callback ä½œä¸º Slack API çš„å›è°ƒï¼Œä»–ä»¬ä¼šå–„æ„åœ°æé†’æ‚¨â€œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¯·ä½¿ç”¨ httpsâ€ã€‚æ˜¯çš„ï¼Œä¹Ÿé€‚ç”¨äºæœ¬åœ°ä¸»æœºã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ¬åœ°ä¸»æœºä¸Šæœ‰ OAuth é‡å®šå‘çš„è§£å†³æ–¹æ¡ˆã€‚</li></ul></li></ul><p>We could go on for a long time, but we think you probably get the point by now.<br> æˆ‘ä»¬å¯ä»¥ç»§ç»­è¯´å¾ˆé•¿æ—¶é—´ï¼Œä½†æˆ‘ä»¬è®¤ä¸ºæ‚¨ç°åœ¨å¯èƒ½å·²ç»æ˜ç™½äº†è¦ç‚¹ã€‚</p><figure><img src="/assets/oauth_hard2-DOV91Q-U.png" alt="OAuth is too complex; letâ€™s make a simpler version of OAuth that has everything we need! Â©XKCD&lt;br&gt;OAuthå¤ªå¤æ‚ï¼›è®©æˆ‘ä»¬åˆ¶ä½œä¸€ä¸ªæ›´ç®€å•çš„ OAuth ç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬éœ€è¦çš„ä¸€åˆ‡ï¼ Â©XKCD" tabindex="0" loading="lazy"><figcaption>OAuth is too complex; letâ€™s make a simpler version of OAuth that has everything we need! Â©XKCD<br>OAuthå¤ªå¤æ‚ï¼›è®©æˆ‘ä»¬åˆ¶ä½œä¸€ä¸ªæ›´ç®€å•çš„ OAuth ç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬éœ€è¦çš„ä¸€åˆ‡ï¼ Â©XKCD</figcaption></figure><h2 id="é—®é¢˜-3-éæ ‡å‡†æ‰©å±•-problem-3-nonstandard-extensions" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜-3-éæ ‡å‡†æ‰©å±•-problem-3-nonstandard-extensions"><span>é—®é¢˜ 3ï¼šéæ ‡å‡†æ‰©å±• <br>Problem 3: Nonstandard extensions</span></a></h2><p>Even though the OAuth standard is vast, many APIs still seem to find gaps in it for features they need. A common issue we see is that you need some data in addition to the <code>access_token</code> to work with the API. Wouldnâ€™t it be neat if this additional data could be returned to you together with the access_token in the OAuth flow?<br> å°½ç®¡ OAuth æ ‡å‡†å¾ˆåºå¤§ï¼Œä½†è®¸å¤š API ä¼¼ä¹ä»ç„¶åœ¨å…¶ä¸­æ‰¾åˆ°äº†å®ƒä»¬æ‰€éœ€åŠŸèƒ½çš„ç©ºç™½ã€‚æˆ‘ä»¬çœ‹åˆ°çš„ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯ï¼Œé™¤äº† <code>access_token</code> ä¹‹å¤–ï¼Œæ‚¨è¿˜éœ€è¦ä¸€äº›æ•°æ®æ‰èƒ½ä½¿ç”¨ APIã€‚å¦‚æœè¿™äº›é™„åŠ æ•°æ®å¯ä»¥ä¸ OAuth æµç¨‹ä¸­çš„ <code>access_token</code> ä¸€èµ·è¿”å›ç»™æ‚¨ï¼Œå²‚ä¸æ˜¯å¾ˆå®Œç¾ï¼Ÿ</p><p>We actually think this is a good idea â€” orr at least itâ€™s better than forcing users to do quirky additional API requests afterward to fetch this information (looking at you, Jira). But it does mean more nonstandard behavior that you specifically need to implement for every API.<br> æˆ‘ä»¬å®é™…ä¸Šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ - æˆ–è€…è‡³å°‘å®ƒæ¯”å¼ºè¿«ç”¨æˆ·éšåæ‰§è¡Œå¥‡æ€ªçš„é¢å¤– API è¯·æ±‚æ¥è·å–æ­¤ä¿¡æ¯è¦å¥½ï¼ˆçœ‹ç€ä½ ï¼ŒJiraï¼‰ã€‚ä½†è¿™ç¡®å®æ„å‘³ç€æ‚¨ç‰¹åˆ«éœ€è¦ä¸ºæ¯ä¸ª API å®ç°æ›´å¤šéæ ‡å‡†è¡Œä¸ºã€‚</p><p>Hereâ€™s a small list of nonstandard extensions we have seen:<br> ä»¥ä¸‹æ˜¯æˆ‘ä»¬è§è¿‡çš„ä¸€å°éƒ¨åˆ†éæ ‡å‡†æ‰©å±•ï¼š</p><ul><li>Quickbooks employs a <code>realmID</code>, which you need to pass in with every API request. The only time they tell you this <code>realmID</code> is as an additional parameter in the OAuth callback. Better store it somewhere safe!<br> Quickbooks ä½¿ç”¨ <code>realmID</code>ï¼Œæ‚¨éœ€è¦åœ¨æ¯ä¸ªAPI è¯·æ±‚ä¸­ä¼ é€’è¯¥realmIDã€‚ä»–ä»¬å”¯ä¸€ä¸€æ¬¡å‘Šè¯‰æ‚¨æ­¤ RealmID æ˜¯ä½œä¸º OAuth å›è°ƒä¸­çš„é™„åŠ å‚æ•°ã€‚æœ€å¥½å°†å…¶å­˜æ”¾åœ¨å®‰å…¨çš„åœ°æ–¹ï¼</li><li>Braintree does the same with a <code>companyID</code><br> Braintree å¯¹ <code>companyID</code> æ‰§è¡ŒåŒæ ·çš„æ“ä½œ</li><li>Salesforce uses a different API base URL for each customer; they call this the <code>instance_url</code>. Thankfully, they return the <code>instance_url</code> of the user together with the access token in the token response, but you do need to parse it out from there and store it.<br> Salesforce ä¸ºæ¯ä¸ªå®¢æˆ·ä½¿ç”¨ä¸åŒçš„ API åŸºæœ¬ URLï¼›ä»–ä»¬ç§°ä¹‹ä¸º <code>instance_url</code>ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œå®ƒä»¬è¿”å›ç”¨æˆ·çš„ <code>instance_url</code> ä»¥åŠä»¤ç‰Œå“åº”ä¸­çš„è®¿é—®ä»¤ç‰Œï¼Œä½†æ‚¨ç¡®å®éœ€è¦ä»é‚£é‡Œè§£æå®ƒå¹¶å­˜å‚¨å®ƒã€‚</li><li>Unfortunately, the <a href="https://www.nango.dev/blog/how-we-built-a-salesforce-api-integration-in-3-hours" target="_blank" rel="noopener noreferrer">Salesforce API</a> also does even more annoying things: Access tokens expire after a preset period of time, which can be customized by the user. Fine so far, but for some reason they donâ€™t tell you in the token response when the access token you just received will expire (everybody else does this). Instead, you need to query an additional token details endpoint to get the (current) expiration date of the token. Why, Salesforce, why?<br> ä¸å¹¸çš„æ˜¯ï¼ŒSalesforce API è¿˜åšäº†æ›´çƒ¦äººçš„äº‹æƒ…ï¼šè®¿é—®ä»¤ç‰Œä¼šåœ¨é¢„è®¾æ—¶é—´æ®µåè¿‡æœŸï¼Œè¯¥æ—¶é—´æ®µå¯ä»¥ç”±ç”¨æˆ·è‡ªå®šä¹‰ã€‚åˆ°ç›®å‰ä¸ºæ­¢è¿˜å¥½ï¼Œä½†ç”±äºæŸç§åŸå› ï¼Œä»–ä»¬ä¸ä¼šåœ¨ä»¤ç‰Œå“åº”ä¸­å‘Šè¯‰æ‚¨åˆšåˆšæ”¶åˆ°çš„è®¿é—®ä»¤ç‰Œä½•æ—¶è¿‡æœŸï¼ˆå…¶ä»–äººéƒ½ä¼šè¿™æ ·åšï¼‰ã€‚ç›¸åï¼Œæ‚¨éœ€è¦æŸ¥è¯¢é¢å¤–çš„ä»¤ç‰Œè¯¦ç»†ä¿¡æ¯ç«¯ç‚¹ä»¥è·å–ä»¤ç‰Œçš„ï¼ˆå½“å‰ï¼‰åˆ°æœŸæ—¥æœŸã€‚ä¸ºä»€ä¹ˆï¼ŒSalesforceï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li><li>Slack has two different types of scopes: scopes you hold as a Slack bot and scopes that allow you to take action on behalf of the user who authorized your app. Smart, but instead of just adding different scopes for each, they implemented a separate <code>user_scopes</code> parameter that you need to pass in the authorization call. Youâ€™d better be aware of this, and good luck finding support for this in your OAuth library.<br> Slack æœ‰ä¸¤ç§ä¸åŒç±»å‹çš„èŒƒå›´ï¼šæ‚¨ä½œä¸º Slack æœºå™¨äººæŒæœ‰çš„èŒƒå›´å’Œå…è®¸æ‚¨ä»£è¡¨æˆæƒæ‚¨çš„åº”ç”¨ç¨‹åºçš„ç”¨æˆ·é‡‡å–æ“ä½œçš„èŒƒå›´ã€‚å¾ˆèªæ˜ï¼Œä½†ä»–ä»¬ä¸æ˜¯ä»…ä»…ä¸ºæ¯ä¸ªèŒƒå›´æ·»åŠ ä¸åŒçš„èŒƒå›´ï¼Œè€Œæ˜¯å®ç°äº†ä¸€ä¸ªå•ç‹¬çš„ <code>user_scopes</code> å‚æ•°ï¼Œæ‚¨éœ€è¦åœ¨æˆæƒè°ƒç”¨ä¸­ä¼ é€’è¯¥å‚æ•°ã€‚æ‚¨æœ€å¥½æ„è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œå¹¶ç¥æ‚¨å¥½è¿åœ¨æ‚¨çš„ OAuth åº“ä¸­æ‰¾åˆ°å¯¹æ­¤çš„æ”¯æŒã€‚</li></ul><p>For the sake of brevity and simplicity, weâ€™re skipping the many not-really-standard OAuth flows we have encountered.<br> ä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘ä»¬è·³è¿‡äº†æˆ‘ä»¬é‡åˆ°çš„è®¸å¤šä¸çœŸæ­£æ ‡å‡†çš„ OAuth æµç¨‹ã€‚</p><h2 id="é—®é¢˜-4-invalid-request-problem-4-invalid-request" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜-4-invalid-request-problem-4-invalid-request"><span>é—®é¢˜ 4ï¼šâ€œinvalid_requestâ€<br>Problem 4: â€œinvalid_requestâ€</span></a></h2><p>Debugging distributed systems is always hard. Itâ€™s harder when the service youâ€™re working with uses broad, generic error messages.<br> è°ƒè¯•åˆ†å¸ƒå¼ç³»ç»Ÿæ€»æ˜¯å¾ˆå›°éš¾ã€‚å½“æ‚¨ä½¿ç”¨çš„æœåŠ¡ä½¿ç”¨å¹¿æ³›çš„é€šç”¨é”™è¯¯æ¶ˆæ¯æ—¶ï¼Œäº‹æƒ…ä¼šå˜å¾—æ›´åŠ å›°éš¾ã€‚</p><p>OAuth2 has <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-5.2" target="_blank" rel="noopener noreferrer">standardized error messages</a>, but theyâ€™re about as useful in telling you whatâ€™s going on as the example in the title above (which, by the way, is one of the recommended error messages from the OAuth standard).<br> OAuth2 å…·æœ‰æ ‡å‡†åŒ–çš„é”™è¯¯æ¶ˆæ¯ï¼Œä½†å®ƒä»¬åœ¨å‘Šè¯‰æ‚¨æ­£åœ¨å‘ç”Ÿçš„æƒ…å†µæ–¹é¢ä¸ä¸Šé¢æ ‡é¢˜ä¸­çš„ç¤ºä¾‹ä¸€æ ·æœ‰ç”¨ï¼ˆé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™æ˜¯ OAuth æ ‡å‡†ä¸­æ¨èçš„é”™è¯¯æ¶ˆæ¯ä¹‹ä¸€ï¼‰ã€‚</p><p>You could argue that OAuth is a standard and that there are docs for every API, so what is there to debug?<br> æ‚¨å¯èƒ½ä¼šè¯´ OAuth æ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œæ¯ä¸ª API éƒ½æœ‰æ–‡æ¡£ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆå¯è°ƒè¯•çš„å‘¢ï¼Ÿ</p><p>A lot. I cannot tell you how often the docs are wrong. Or missing a detail. Or have not been updated for the latest change. Or you missed something when you first looked at them. A good 80% of the OAuth flows we implement have some problem upon first implementation and require debugging.<br> å¾ˆå¤šã€‚æˆ‘æ— æ³•å‘Šè¯‰ä½ æ–‡æ¡£å‡ºé”™çš„é¢‘ç‡æœ‰å¤šå°‘ã€‚æˆ–è€…é—æ¼äº†ä¸€ä¸ªç»†èŠ‚ã€‚æˆ–è€…å°šæœªæ›´æ–°æœ€æ–°çš„æ›´æ”¹ã€‚æˆ–è€…å½“ä½ ç¬¬ä¸€æ¬¡çœ‹åˆ°å®ƒä»¬æ—¶ä½ é”™è¿‡äº†ä¸€äº›ä¸œè¥¿ã€‚æˆ‘ä»¬å®ç°çš„ OAuth æµç¨‹ä¸­æœ‰ 80% åœ¨é¦–æ¬¡å®ç°æ—¶éƒ½å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œéœ€è¦è°ƒè¯•ã€‚</p><figure><img src="/assets/oauth_hard3-D060feGs.png" alt="How did Randall observe me while I was debugging OAuth flows? Â©XKCD&lt;br&gt;å½“æˆ‘è°ƒè¯• OAuth æµç¨‹æ—¶ï¼ŒRandall å¦‚ä½•è§‚å¯Ÿæˆ‘ï¼Ÿ Â©XKCD" tabindex="0" loading="lazy"><figcaption>How did Randall observe me while I was debugging OAuth flows? Â©XKCD<br>å½“æˆ‘è°ƒè¯• OAuth æµç¨‹æ—¶ï¼ŒRandall å¦‚ä½•è§‚å¯Ÿæˆ‘ï¼Ÿ Â©XKCD</figcaption></figure><p>Some flows also break for, what seem to be, random reasons: LinkedIn OAuth, for instance, breaks if you pass in PKCE parameters. The error you get? â€œclient error - invalid OAuth request.â€ That is â€¦ telling? It took us an hour to understand that passing in (optional, usually disregarded) PKCE parameters is what breaks the flow.<br> æœ‰äº›æµç¨‹ä¹Ÿä¼šå› éšæœºåŸå› è€Œä¸­æ–­ï¼šä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä¼ å…¥ PKCE å‚æ•°ï¼ŒLinkedIn OAuth å°±ä¼šä¸­æ–­ã€‚ä½ å¾—åˆ°çš„é”™è¯¯æ˜¯ï¼Ÿ â€œå®¢æˆ·ç«¯é”™è¯¯ - OAuth è¯·æ±‚æ— æ•ˆã€‚â€è¿™å°±æ˜¯â€¦â€¦å‘Šè¯‰æˆ‘ä»¬ï¼Ÿæˆ‘ä»¬èŠ±äº†ä¸€ä¸ªå°æ—¶æ‰æ˜ç™½ä¼ å…¥ï¼ˆå¯é€‰çš„ï¼Œé€šå¸¸è¢«å¿½ç•¥çš„ï¼‰PKCE å‚æ•°æ˜¯ç ´åæµç¨‹çš„åŸå› ã€‚</p><p>Another common mistake is sending scopes that donâ€™t match the ones you preregistered with the app. (Preregister scopes? Yes, a lot of APIs these days demand that.) This often results in a generic error message about there being an issue with scopes. Duh.<br> å¦ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯å‘é€çš„èŒƒå›´ä¸æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­é¢„å…ˆæ³¨å†Œçš„èŒƒå›´ä¸åŒ¹é…ã€‚ ï¼ˆé¢„æ³¨å†ŒèŒƒå›´ï¼Ÿæ˜¯çš„ï¼Œç°åœ¨å¾ˆå¤š API éƒ½è¦æ±‚è¿™æ ·åšã€‚ï¼‰è¿™é€šå¸¸ä¼šå¯¼è‡´å‡ºç°æœ‰å…³èŒƒå›´å­˜åœ¨é—®é¢˜çš„é€šç”¨é”™è¯¯æ¶ˆæ¯ã€‚</p><h2 id="é—®é¢˜-5-ç¹ççš„å®¡æ‰¹-problem-5-cumbersome-approvals" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜-5-ç¹ççš„å®¡æ‰¹-problem-5-cumbersome-approvals"><span>é—®é¢˜ 5ï¼šç¹ççš„å®¡æ‰¹ <br>Problem 5: Cumbersome approvals</span></a></h2><p>The truth is, if you build toward some other system by using their API, youâ€™re probably in the weaker position. Your customers are asking for the integration because theyâ€™re already using the other system. Now you need to make them happy.<br> äº‹å®æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨å…¶ä»–ç³»ç»Ÿçš„ API è¿›è¡Œæ„å»ºï¼Œæ‚¨å¯èƒ½ä¼šå¤„äºè¾ƒå¼±çš„ä½ç½®ã€‚æ‚¨çš„å®¢æˆ·è¦æ±‚é›†æˆï¼Œå› ä¸ºä»–ä»¬å·²ç»åœ¨ä½¿ç”¨å…¶ä»–ç³»ç»Ÿã€‚ç°åœ¨ä½ éœ€è¦è®©ä»–ä»¬å¼€å¿ƒã€‚</p><p>To be fair, many APIs are liberal and provide easy self-service signup flows for developers to register their apps and start using OAuth. But some of the most popular APIs out there require reviews before your app becomes public and can be used by any of their users. Again, to be fair, most review processes are sane and can be completed in a few days. Theyâ€™re probably a net gain in terms of security and quality for end users.<br> å…¬å¹³åœ°è¯´ï¼Œè®¸å¤š API éƒ½æ˜¯è‡ªç”±çš„ï¼Œå¹¶ä¸ºå¼€å‘äººå‘˜æä¾›ç®€å•çš„è‡ªåŠ©æ³¨å†Œæµç¨‹æ¥æ³¨å†Œä»–ä»¬çš„åº”ç”¨ç¨‹åºå¹¶å¼€å§‹ä½¿ç”¨ OAuthã€‚ä½†ä¸€äº›æœ€æµè¡Œçš„ API åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºå…¬å¼€å¹¶å¯ä¾›ä»»ä½•ç”¨æˆ·ä½¿ç”¨ä¹‹å‰éœ€è¦ç»è¿‡å®¡æ ¸ã€‚å†æ¬¡å¼ºè°ƒï¼Œå…¬å¹³åœ°è¯´ï¼Œå¤§å¤šæ•°å®¡æ ¸æµç¨‹éƒ½æ˜¯åˆç†çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å‡ å¤©å†…å®Œæˆã€‚å¯¹äºæœ€ç»ˆç”¨æˆ·æ¥è¯´ï¼Œå®ƒä»¬å¯èƒ½åœ¨å®‰å…¨æ€§å’Œè´¨é‡æ–¹é¢å¸¦æ¥å‡€æ”¶ç›Šã€‚</p><figure><img src="/assets/oauth_hard4-DUleGge6.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>But some notorious examples can take months to complete, and some even require you to enter into revenue-share agreements:<br> ä½†ä¸€äº›è‡­åæ˜­è‘—çš„ä¾‹å­å¯èƒ½éœ€è¦å‡ ä¸ªæœˆçš„æ—¶é—´æ‰èƒ½å®Œæˆï¼Œæœ‰äº›ç”šè‡³è¦æ±‚æ‚¨ç­¾è®¢æ”¶å…¥åˆ†æˆåè®®ï¼š</p><ul><li>Google requires a â€œsecurity reviewâ€ if you want to access scopes with more sensitive user data, such as email contents. We have heard these reviews can take days or weeks to pass and require a nontrivial amount of work on your side.<br> å¦‚æœæ‚¨æƒ³è®¿é—®åŒ…å«æ›´æ•æ„Ÿç”¨æˆ·æ•°æ®ï¼ˆä¾‹å¦‚ç”µå­é‚®ä»¶å†…å®¹ï¼‰çš„èŒƒå›´ï¼ŒGoogle éœ€è¦è¿›è¡Œâ€œå®‰å…¨å®¡æŸ¥â€ã€‚æˆ‘ä»¬å¬è¯´è¿™äº›å®¡æ ¸å¯èƒ½éœ€è¦å‡ å¤©æˆ–å‡ å‘¨çš„æ—¶é—´æ‰èƒ½é€šè¿‡ï¼Œå¹¶ä¸”éœ€è¦æ‚¨åšå¤§é‡çš„å·¥ä½œã€‚</li><li>Looking to integrate with Rippling? Get ready for their 30-plus questions and security preproduction screening. We hear access takes months (if you are approved).<br> æƒ³è¦ä¸ Ripple é›†æˆå—ï¼Ÿå‡†å¤‡å¥½æ¥å— 30 å¤šä¸ªé—®é¢˜å’Œå®‰å…¨é¢„ç”Ÿäº§ç­›æŸ¥ã€‚æˆ‘ä»¬å¬è¯´è®¿é—®éœ€è¦å‡ ä¸ªæœˆçš„æ—¶é—´ï¼ˆå¦‚æœæ‚¨è·å¾—æ‰¹å‡†ï¼‰ã€‚</li><li><a href="https://www.nango.dev/blog/hubspot-api-integration" target="_blank" rel="noopener noreferrer">HubSpot</a>, Notion, Atlassian, Shopify, and pretty much everybody else who has an integrations marketplace or app store requires a review to get listed there. Some reviews are mild, and some ask you for demo logins, video walkthroughs, blog posts (yes!), and more. However, listing on the marketplace or store is often optional.<br> HubSpotã€Notionã€Atlassianã€Shopify ä»¥åŠå‡ ä¹æ‰€æœ‰æ‹¥æœ‰é›†æˆå¸‚åœºæˆ–åº”ç”¨ç¨‹åºå•†åº—çš„å…¶ä»–äººéƒ½éœ€è¦ç»è¿‡å®¡æ ¸æ‰èƒ½åœ¨å…¶ä¸­åˆ—å‡ºã€‚æœ‰äº›è¯„è®ºå¾ˆæ¸©å’Œï¼Œæœ‰äº›åˆ™è¦æ±‚æ‚¨æä¾›æ¼”ç¤ºç™»å½•ã€è§†é¢‘æ¼”ç»ƒã€åšå®¢æ–‡ç« ï¼ˆæ˜¯çš„ï¼ï¼‰ç­‰ç­‰ã€‚ç„¶è€Œï¼Œåœ¨å¸‚åœºæˆ–å•†åº—ä¸Šåˆ—å‡ºé€šå¸¸æ˜¯å¯é€‰çš„ã€‚</li><li>Ramp, Brex, Twitter, and a good number of others donâ€™t have a self-service signup flow for developers and require that you fill in forms for manual access. Many are quick to process requests, but weâ€™re still waiting to hear back from some after weeks.<br> Rampã€Brexã€Twitter å’Œè®¸å¤šå…¶ä»–ç½‘ç«™æ²¡æœ‰ä¸ºå¼€å‘äººå‘˜æä¾›è‡ªåŠ©æ³¨å†Œæµç¨‹ï¼Œéœ€è¦æ‚¨å¡«å†™è¡¨æ ¼æ‰èƒ½æ‰‹åŠ¨è®¿é—®ã€‚è®¸å¤šäººéƒ½ä¼šå¾ˆå¿«å¤„ç†è¯·æ±‚ï¼Œä½†æˆ‘ä»¬ä»åœ¨ç­‰å¾…å‡ å‘¨åçš„å›å¤ã€‚</li><li>Xero is a particularly drastic example of a monetized API: If you want to exceed a limit of 25 connected accounts, you have to <a href="https://developer.xero.com/documentation/xero-app-store/app-partner-guides/app-partner-steps/" target="_blank" rel="noopener noreferrer">become a Xero partner</a> and list your app in their app store. They will then take (as of the time of this writing) a 15% revenue cut from every lead generated from that store.<br> Xero æ˜¯è´§å¸åŒ– API çš„ä¸€ä¸ªç‰¹åˆ«æ¿€çƒˆçš„ä¾‹å­ï¼šå¦‚æœæ‚¨æƒ³è¶…è¿‡ 25 ä¸ªè¿æ¥å¸æˆ·çš„é™åˆ¶ï¼Œæ‚¨å¿…é¡»æˆä¸º Xero åˆä½œä¼™ä¼´å¹¶åœ¨ä»–ä»¬çš„åº”ç”¨å•†åº—ä¸­åˆ—å‡ºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚ç„¶åï¼Œä»–ä»¬å°†ä»è¯¥å•†åº—äº§ç”Ÿçš„æ¯æ¡é”€å”®çº¿ç´¢ä¸­æ‰£é™¤ 15% çš„æ”¶å…¥ï¼ˆæˆªè‡³æ’°å†™æœ¬æ–‡æ—¶ï¼‰ã€‚</li></ul><h2 id="é—®é¢˜-6-å®‰å…¨æ€§å¾ˆå›°éš¾-problem-6-security-is-hard" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜-6-å®‰å…¨æ€§å¾ˆå›°éš¾-problem-6-security-is-hard"><span>é—®é¢˜ 6ï¼šå®‰å…¨æ€§å¾ˆå›°éš¾ <br>Problem 6: Security is hard</span></a></h2><p>As attacks have been uncovered, and the available web technologies have evolved, the OAuth standard has changed as well. If youâ€™re looking to implement the current security best practices, the OAuth working group has a <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics" target="_blank" rel="noopener noreferrer">rather lengthy guide</a> for you. And if youâ€™re working with an API that is still using OAuth 1.0a today, you realize that backwards compatibility is a never-ending struggle.<br> éšç€æ”»å‡»çš„è¢«å‘ç°ä»¥åŠå¯ç”¨çš„ Web æŠ€æœ¯çš„å‘å±•ï¼ŒOAuth æ ‡å‡†ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚å¦‚æœæ‚¨å¸Œæœ›å®æ–½å½“å‰çš„å®‰å…¨æœ€ä½³å®è·µï¼ŒOAuth å·¥ä½œç»„ä¸ºæ‚¨æä¾›äº†ç›¸å½“å†—é•¿çš„æŒ‡å—ã€‚å¦‚æœæ‚¨ç°åœ¨ä½¿ç”¨çš„ API ä»åœ¨ä½¿ç”¨ OAuth 1.0aï¼Œæ‚¨å°±ä¼šæ„è¯†åˆ°å‘åå…¼å®¹æ€§æ˜¯ä¸€åœºæ°¸æ— ä¼‘æ­¢çš„æ–—äº‰ã€‚</p><p>Luckily, security is getting better with every iteration, but it often comes at the cost of more work for developers. The upcoming OAuth 2.1 standard will make some current best practices mandatory and includes mandatory PKCE (today only a handful of APIs require this) and additional restrictions for refresh tokens.<br> å¹¸è¿çš„æ˜¯ï¼Œå®‰å…¨æ€§éšç€æ¯æ¬¡è¿­ä»£è€Œå˜å¾—è¶Šæ¥è¶Šå¥½ï¼Œä½†è¿™é€šå¸¸æ˜¯ä»¥å¼€å‘äººå‘˜ä»˜å‡ºæ›´å¤šå·¥ä½œä¸ºä»£ä»·çš„ã€‚å³å°†æ¨å‡ºçš„ OAuth 2.1 æ ‡å‡†å°†å¼ºåˆ¶æ‰§è¡Œä¸€äº›å½“å‰çš„æœ€ä½³å®è·µï¼Œå¹¶åŒ…æ‹¬å¼ºåˆ¶çš„ PKCEï¼ˆç›®å‰åªæœ‰å°‘æ•° API éœ€è¦æ­¤ï¼‰ä»¥åŠåˆ·æ–°ä»¤ç‰Œçš„é™„åŠ é™åˆ¶ã€‚</p><figure><img src="/assets/oauth_hard5-Bzb2cc5Q.png" alt="At least OAuth already implements a two-factor auth model. Â©XKCD&lt;br&gt;è‡³å°‘ OAuth å·²ç»å®ç°äº†åŒå› ç´ èº«ä»½éªŒè¯æ¨¡å‹ã€‚ Â©XKCD" tabindex="0" loading="lazy"><figcaption>At least OAuth already implements a two-factor auth model. Â©XKCD<br>è‡³å°‘ OAuth å·²ç»å®ç°äº†åŒå› ç´ èº«ä»½éªŒè¯æ¨¡å‹ã€‚ Â©XKCD</figcaption></figure><p>The biggest change has probably been ushered in with expiring access tokens and the rise of refresh tokens. On the surface, the process seems simple: Whenever an access token expires, refresh it with the refresh token and store the new access token and refresh token.<br> æœ€å¤§çš„å˜åŒ–å¯èƒ½æ˜¯éšç€è®¿é—®ä»¤ç‰Œçš„è¿‡æœŸå’Œåˆ·æ–°ä»¤ç‰Œçš„å…´èµ·è€Œå¸¦æ¥çš„ã€‚ä»è¡¨é¢ä¸Šçœ‹ï¼Œè¯¥è¿‡ç¨‹ä¼¼ä¹å¾ˆç®€å•ï¼šæ¯å½“è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶ï¼Œä½¿ç”¨åˆ·æ–°ä»¤ç‰Œåˆ·æ–°å®ƒå¹¶å­˜å‚¨æ–°çš„è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œã€‚</p><p>In reality, when we implemented this we had to consider:<br> äº‹å®ä¸Šï¼Œå½“æˆ‘ä»¬å®ç°è¿™ä¸€ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘ï¼š</p><ul><li>Race conditions: How can we make sure no other requests run while we refresh the current access token?<br> ç«äº‰æ¡ä»¶ï¼šå¦‚ä½•ç¡®ä¿åœ¨åˆ·æ–°å½“å‰è®¿é—®ä»¤ç‰Œæ—¶æ²¡æœ‰å…¶ä»–è¯·æ±‚è¿è¡Œï¼Ÿ</li><li>Some APIs also expire the refresh token if you donâ€™t use it for a certain number of days (or if the user has revoked the access). Expect some refreshes to fail.<br> å¦‚æœæ‚¨åœ¨ä¸€å®šå¤©æ•°å†…ä¸ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œï¼ˆæˆ–è€…ç”¨æˆ·å·²æ’¤é”€è®¿é—®æƒé™ï¼‰ï¼ŒæŸäº› API ä¹Ÿä¼šä½¿åˆ·æ–°ä»¤ç‰Œè¿‡æœŸã€‚é¢„è®¡æŸäº›åˆ·æ–°ä¼šå¤±è´¥ã€‚</li><li>Some APIs issue you a new refresh token with every refresh request â€¦<br> æœ‰äº› API åœ¨æ¯æ¬¡åˆ·æ–°è¯·æ±‚æ—¶éƒ½ä¼šå‘æ‚¨å‘å‡ºä¸€ä¸ªæ–°çš„åˆ·æ–°ä»¤ç‰Œâ€¦â€¦</li><li>â€¦ but some also silently assume that you will keep the old refresh token and keep on using it.<br> â€¦ä½†æœ‰äº›äººä¹Ÿé»˜é»˜åœ°å‡è®¾æ‚¨å°†ä¿ç•™æ—§çš„åˆ·æ–°ä»¤ç‰Œå¹¶ç»§ç»­ä½¿ç”¨å®ƒã€‚</li><li>Some APIs will tell you the access token expiration time in absolute values. Others only in relative â€œseconds from now.â€ And some, like Salesforce, donâ€™t divulge this kind of information easily.<br> æŸäº› API ä¼šä»¥ç»å¯¹å€¼å½¢å¼å‘Šè¯‰æ‚¨è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶é—´ã€‚å…¶ä»–çš„åˆ™ä»…åœ¨ç›¸å¯¹â€œä»ç°åœ¨å¼€å§‹çš„å‡ ç§’é’Ÿå†…â€å‘ç”Ÿã€‚æœ‰äº›å…¬å¸ï¼ˆä¾‹å¦‚ Salesforceï¼‰ä¸ä¼šè½»æ˜“æ³„éœ²æ­¤ç±»ä¿¡æ¯ã€‚</li></ul><h2 id="æœ‰äº›äº‹æƒ…æˆ‘ä»¬è¿˜æ²¡æœ‰è®¨è®ºè¿‡-some-things-we-haven-t-talked-about-yet" tabindex="-1"><a class="header-anchor" href="#æœ‰äº›äº‹æƒ…æˆ‘ä»¬è¿˜æ²¡æœ‰è®¨è®ºè¿‡-some-things-we-haven-t-talked-about-yet"><span>æœ‰äº›äº‹æƒ…æˆ‘ä»¬è¿˜æ²¡æœ‰è®¨è®ºè¿‡ <br>Some things we havenâ€™t talked about yet</span></a></h2><p>Sadly, we have only just scratched the surface of your OAuth implementation. Now that your OAuth flow runs and you get access tokens, itâ€™s time to think about:<br> é—æ†¾çš„æ˜¯ï¼Œæˆ‘ä»¬ä»…ä»…è§¦åŠäº† OAuth å®ç°çš„çš®æ¯›ã€‚ç°åœ¨æ‚¨çš„ OAuth æµç¨‹å·²è¿è¡Œå¹¶ä¸”æ‚¨è·å¾—äº†è®¿é—®ä»¤ç‰Œï¼Œæ˜¯æ—¶å€™è€ƒè™‘ä»¥ä¸‹é—®é¢˜äº†ï¼š</p><ul><li>How to securely store these access tokens and refresh tokens. They are like passwords to your usersâ€™ accounts. But hashing is not an option; you need secure, reversible encryption.<br> å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨è¿™äº›è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œã€‚å®ƒä»¬å°±åƒç”¨æˆ·å¸æˆ·çš„å¯†ç ã€‚ä½†æ•£åˆ—ä¸æ˜¯ä¸€ç§é€‰æ‹©ï¼›è€Œæ˜¯ä¸€ç§é€‰æ‹©ã€‚æ‚¨éœ€è¦å®‰å…¨ã€å¯é€†çš„åŠ å¯†ã€‚</li><li>Checking that the granted scopes match the requested scopes (some APIs allow users to change the scopes they grant in the authorize flow).<br> æ£€æŸ¥æˆäºˆçš„èŒƒå›´æ˜¯å¦ä¸è¯·æ±‚çš„èŒƒå›´åŒ¹é…ï¼ˆæŸäº› API å…è®¸ç”¨æˆ·æ›´æ”¹ä»–ä»¬åœ¨æˆæƒæµç¨‹ä¸­æˆäºˆçš„èŒƒå›´ï¼‰ã€‚</li><li>Avoiding race conditions when refreshing tokens.<br> åˆ·æ–°ä»¤ç‰Œæ—¶é¿å…ç«äº‰æ¡ä»¶ã€‚</li><li>Detecting access tokens revoked by the user on the provider side.<br> æ£€æµ‹æä¾›å•†ç«¯ç”¨æˆ·æ’¤é”€çš„è®¿é—®ä»¤ç‰Œã€‚</li><li>Letting users know that access tokens have expired, so they can re-authorize your app if needed.<br> è®©ç”¨æˆ·çŸ¥é“è®¿é—®ä»¤ç‰Œå·²è¿‡æœŸï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥åœ¨éœ€è¦æ—¶é‡æ–°æˆæƒæ‚¨çš„åº”ç”¨ç¨‹åºã€‚</li><li>How to revoke access tokens you no longer need (or that the user has requested you delete under GDPR).<br> å¦‚ä½•æ’¤é”€æ‚¨ä¸å†éœ€è¦çš„è®¿é—®ä»¤ç‰Œï¼ˆæˆ–è€…ç”¨æˆ·æ ¹æ® GDPR è¦æ±‚åˆ é™¤çš„è®¿é—®ä»¤ç‰Œï¼‰ã€‚</li><li>Changes in available OAuth scopes, provider bugs, missing documentation, and so on.<br> å¯ç”¨ OAuth èŒƒå›´çš„æ›´æ”¹ã€æä¾›ç¨‹åºé”™è¯¯ã€ç¼ºå°‘æ–‡æ¡£ç­‰ã€‚</li></ul><h2 id="æœ‰æ›´å¥½çš„æ–¹æ³•å—-a-better-way" tabindex="-1"><a class="header-anchor" href="#æœ‰æ›´å¥½çš„æ–¹æ³•å—-a-better-way"><span>æœ‰æ›´å¥½çš„æ–¹æ³•å—ï¼Ÿ <br>A better way?</span></a></h2><p>If youâ€™ve read this far, you might be thinking, â€œThere must be a better way!â€<br> å¦‚æœæ‚¨è¯»åˆ°è¿™é‡Œï¼Œæ‚¨å¯èƒ½ä¼šæƒ³ï¼šâ€œä¸€å®šæœ‰æ›´å¥½çš„æ–¹æ³•ï¼â€</p><p>We think there is, which is why weâ€™re building <a href="https://www.nango.dev/" target="_blank" rel="noopener noreferrer">Nango</a>: An <a href="https://github.com/NangoHQ/nango" target="_blank" rel="noopener noreferrer">open-source</a>, self-contained service that comes with prebuilt OAuth flows, secure token storage, and automatic token refreshes <a href="https://docs.nango.dev/providers" target="_blank" rel="noopener noreferrer">for more than 400 OAuth APIs</a>.<br> æˆ‘ä»¬è®¤ä¸ºæ˜¯å­˜åœ¨çš„ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ„å»º <a href="https://www.nango.dev/" target="_blank" rel="noopener noreferrer">Nango</a> çš„åŸå› ï¼šä¸€ä¸ª<a href="https://github.com/NangoHQ/nango" target="_blank" rel="noopener noreferrer">å¼€æº</a>çš„ã€ç‹¬ç«‹çš„æœåŠ¡ï¼Œå¸¦æœ‰é¢„æ„å»ºçš„ OAuth æµã€å®‰å…¨çš„ä»¤ç‰Œå­˜å‚¨å’Œ <a href="https://docs.nango.dev/providers" target="_blank" rel="noopener noreferrer">400 å¤šä¸ª OAuth API</a> çš„è‡ªåŠ¨ä»¤ç‰Œåˆ·æ–°ã€‚</p><p>If you give it a try, weâ€™d love to hear your feedback. And if you want to share your worst OAuth horror story with us, weâ€™d love to hear about it in our <a href="https://nango.dev/slack" target="_blank" rel="noopener noreferrer">Slack community</a>.<br> å¦‚æœæ‚¨å°è¯•ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¾ˆä¹æ„å¬åˆ°æ‚¨çš„åé¦ˆã€‚å¦‚æœæ‚¨æƒ³ä¸æˆ‘ä»¬åˆ†äº«æ‚¨æœ€ç³Ÿç³•çš„ OAuth ææ€–æ•…äº‹ï¼Œæˆ‘ä»¬å¾ˆä¹æ„åœ¨ Slack ç¤¾åŒºä¸­å¬åˆ°å®ƒã€‚</p><p>Thanks for reading and happy authorizing!<br> æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œç¥æ‚¨æˆæƒæ„‰å¿«ï¼</p></div><!----><!----><!----></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/reprint/webSockets_vs_server-sent-events_vs_long-polling_vs_webrtc_vs_webtransport.html" aria-label="WebSocket vs SSE vs Long-Polling vs WebRTC vs WebTransport"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><iconify-icon class="vp-icon" icon="maki:communications-tower" height="1em" sizing="height"></iconify-icon>WebSocket vs SSE vs Long-Polling vs WebRTC vs WebTransport</div></a><!----></nav><div id="comment" class="waline-wrapper vp-comment" vp-comment darkmode="false" style="display:none;"><!----></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><!----><div class="vp-copyright">Copyright Â© 2020-2025 ğŸ¾ <a href="https://github.com/yudi-corgi">YUDI-Corgi</a> âœ¨ Licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" target="_blank">CC BY-SA 4.0</a></div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CaxHSNMY.js" defer></script>
  </body>
</html>
