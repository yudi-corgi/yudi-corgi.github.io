import{_ as l}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o as i,c as u,a as s,d as a,w as e,b as n,e as o}from"./app-6e175621.js";const k="/assets/Binderå®ç°-77a09afd.png",r="/assets/stream2-IDEAæ§åˆ¶å°-1545e41f.jpg",d="/assets/æ¶ˆæ¯å¤´å±æ€§-1426e343.jpg",m="/assets/åŸºç¡€æ¶ˆæ¯å¤´å±æ€§-498b31c5.png",v="/assets/stream2-IDEAæ§åˆ¶å°ä¿¡æ¯2-37c1e709.png",b="/assets/GUIé˜Ÿåˆ—ä¿¡æ¯-2c8c37d9.png",g="/assets/stream2-IDEAæ§åˆ¶å°ä¿¡æ¯3-00c350bc.jpg",y={},f=s("h2",{id:"binder",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#binder","aria-hidden":"true"},"#"),n(" Binder")],-1),h={href:"https://docs.spring.io/spring-cloud-stream/reference/spring-cloud-stream/overview-binder-abstraction.html",target:"_blank",rel:"noopener noreferrer"},q=o('<p>Stream æœ¬èº«æä¾›äº†å¤šä¸ª MQ çš„ Binder å®ç°ï¼Œå¦‚ä¸‹å›¾ï¼ˆæ ‡æœ‰ <em>partner maintain</em> è¯´æ˜å¹¶é Spring Cloud Stream å®˜æ–¹æä¾›è€Œæ˜¯ç”± MQ å‚å•†è‡ªå·±å¼€å‘æ¥å…¥ï¼‰ã€‚</p><figure><img src="'+k+`" alt="Binder å®ç°" tabindex="0" loading="lazy"><figcaption>Binder å®ç°</figcaption></figure><h3 id="å¤š-binder-å®ä¾‹é…ç½®" tabindex="-1"><a class="header-anchor" href="#å¤š-binder-å®ä¾‹é…ç½®" aria-hidden="true">#</a> å¤š Binder å®ä¾‹é…ç½®</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">stream</span><span class="token punctuation">:</span>
      <span class="token comment"># å½“é…ç½®å¤šä¸ª Binder æ—¶ï¼Œæ­¤é¡¹å¿…é¡»é…ç½®ï¼Œå¦åˆ™å¯åŠ¨æŠ¥é”™ </span>
      <span class="token key atrule">default-binder</span><span class="token punctuation">:</span> rabbit1
      <span class="token key atrule">binders</span><span class="token punctuation">:</span>
        <span class="token comment"># binder è‡ªå®šä¹‰åç§°</span>
        <span class="token key atrule">rabbit1</span><span class="token punctuation">:</span>
          <span class="token comment"># å¯å¡« rabbitã€kafkaï¼Œå…¶å®ƒ Binder å®ç°æœ‰è‡ªå·±çš„ç¯å¢ƒé…ç½®æ–¹å¼ï¼ŒæŸ¥çœ‹å¯¹åº”çš„ Binder å®˜æ–‡å³å¯ </span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> rabbit
          <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token key atrule">spring</span><span class="token punctuation">:</span>
              <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
                <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
                <span class="token key atrule">username</span><span class="token punctuation">:</span> admin
                <span class="token key atrule">password</span><span class="token punctuation">:</span> admin123
                <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
        <span class="token key atrule">rabbit2</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> rabbit
          <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token key atrule">spring</span><span class="token punctuation">:</span>
              <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
                <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.2
                <span class="token key atrule">username</span><span class="token punctuation">:</span> admin
                <span class="token key atrule">password</span><span class="token punctuation">:</span> admin123
                <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä¾¿æ˜¯å¯¹ RabbitMQ Binder çš„å¤šå®ä¾‹ç¯å¢ƒé…ç½®ï¼Œè‹¥åŒæ—¶é…ç½®äº† <code>spring.rabbitmq.*</code> çš„ç¯å¢ƒé…ç½®ï¼Œé‚£ä¹ˆåè€…ä¼˜å…ˆçº§ä¼šæ›´é«˜ï¼Œè¦æ³¨æ„ã€‚</p><p>éšååªéœ€è¦åœ¨ç»‘å®šä¸­å£°æ˜ä½¿ç”¨çš„ Binder å³å¯ï¼Œä¸æŒ‡å®šåˆ™ä½¿ç”¨é»˜è®¤ Binderï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">stream</span><span class="token punctuation">:</span>
      <span class="token key atrule">bindings</span><span class="token punctuation">:</span>
        <span class="token key atrule">demoConsumer-in-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>topic
          <span class="token key atrule">binder</span><span class="token punctuation">:</span> rabbit2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¸åŒ-mq-çš„äº’åŠ¨" tabindex="-1"><a class="header-anchor" href="#ä¸åŒ-mq-çš„äº’åŠ¨" aria-hidden="true">#</a> ä¸åŒ MQ çš„äº’åŠ¨</h3><p>åœ¨å¼‚æ„ç³»ç»Ÿä¸­ï¼Œæ¥å…¥ä¸åŒ MQ ç³»ç»Ÿæ˜¯æœ‰å¯èƒ½çš„ï¼Œæ¯”å¦‚ A ç³»ç»Ÿé€šè¿‡ RabbitMQ ç”Ÿäº§æ¶ˆæ¯ï¼Œç»è¿‡æ¶ˆæ¯å¤„ç†æœåŠ¡åä¼šæµè½¬è‡³ B ç³»ç»Ÿï¼Œè€Œ B ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ Kafkaï¼Œé‚£ä¹ˆè¿™ä¸ªæ¶ˆæ¯å¤„ç†æœåŠ¡è‡ªç„¶å°±è¦åŒæ—¶æ¥å…¥ RabbitMQã€Kafka äº†ã€‚è™½ç„¶è¯´ä¾é  Spring Boot å¯¹ RabbitMQã€Kafka çš„é›†æˆä¹Ÿèƒ½æ˜¯èƒ½è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯åœ¨æ­¤ç§æ–¹å¼ä¸‹ï¼Œå„ç±» MQ ä¸åŒçš„é…ç½®ã€API æ“ä½œæ··åˆä½¿ç”¨ä¼šä¸ºç³»ç»Ÿå¸¦æ¥å¤æ‚æ€§ï¼Œæé«˜äº†ç»´æŠ¤æˆæœ¬ï¼Œè€Œè¿™æ—¶é€‰æ‹© Stream æ¥ç»Ÿä¸€ MQ çš„æ“ä½œåˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ¡ˆã€‚</p><p>åœ¨ä¸Šæ–¹çš„é…ç½®ä¸­åªæ˜¯ä½¿ç”¨äº† RabbitMQï¼Œç°åœ¨å†è¡¥å……ä¸€ä¸‹ Kafkaï¼Œä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼ˆè®°å¾—å¼•å…¥ <code>stream-kafka</code> ä¾èµ–ï¼‰ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">stream</span><span class="token punctuation">:</span>
      <span class="token key atrule">binders</span><span class="token punctuation">:</span>
        <span class="token comment"># è‡ªå®šä¹‰ Binder åç§°</span>
        <span class="token key atrule">kafka1</span><span class="token punctuation">:</span>
          <span class="token comment"># ç±»å‹å¡« Kafka</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> kafka
          <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token key atrule">spring</span><span class="token punctuation">:</span>
              <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
                <span class="token key atrule">stream</span><span class="token punctuation">:</span>
                  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>
                    <span class="token key atrule">binder</span><span class="token punctuation">:</span>
                      <span class="token key atrule">brokers</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">9092</span>
                      <span class="token key atrule">auto-create-topics</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>   <span class="token comment"># è‡ªåŠ¨åˆ›å»º Topic</span>
                      <span class="token key atrule">auto-add-partitions</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># è‡ªåŠ¨æ·»åŠ åˆ†åŒº</span>
                      <span class="token key atrule">min-partition-count</span><span class="token punctuation">:</span> <span class="token number">3</span>     <span class="token comment"># åˆ›å»ºçš„ä¸»é¢˜æœ€å°åˆ†åŒºæ•°ï¼Œé»˜è®¤ 1ï¼Œå¿…é¡»ä¸Šé¢ä¸¤ä¸ªå±æ€§éƒ½ä¸º true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°é…ç½®çœ‹èµ·æ¥æœ‰ç‚¹å†—ä½™ï¼Œä½†é…ç½®éœ€æ±‚ä¾¿æ˜¯å¦‚æ­¤ğŸ˜‚ã€‚åŒæ ·ä¼šè·Ÿ Spring é›†æˆ Kafka æ—¶ä½¿ç”¨çš„ <code>spring.kafka.bootstrap-servers</code> ç¯å¢ƒé…ç½®å†²çªï¼Œåè€…ä¼˜å…ˆçº§é«˜ã€‚</p><p>æ¥ä¸‹æ¥æ¼”ç¤ºä¸‹ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼šå‘ RabbitMQ å‘é€æ¶ˆæ¯åï¼Œç»è¿‡æ¶ˆè´¹å¤„ç†å†è·¯ç”±è‡³ Kafka æ¶ˆè´¹ã€‚ç›´æ¥ä¸Šä»£ç ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># æ­¤å¤„çœç•¥ Binder é…ç½®ï¼ŒæŒ‰ç…§ä¸Šé¢é…ç½®å³å¯</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
  	<span class="token key atrule">function</span><span class="token punctuation">:</span>
  	  <span class="token key atrule">definition</span><span class="token punctuation">:</span> rabbitConsumer;kafkaConsumer
    <span class="token key atrule">stream</span><span class="token punctuation">:</span>
      <span class="token key atrule">bindings</span><span class="token punctuation">:</span>
        <span class="token comment"># åˆ†åˆ«é…ç½®ä¸¤ä¸ª MQ çš„è¾“å…¥ç»‘å®šï¼Œæ³¨æ„ binder é€‰æ‹©</span>
        <span class="token key atrule">rabbitConsumer-in-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> rabbit<span class="token punctuation">-</span>exchange
          <span class="token key atrule">group</span><span class="token punctuation">:</span> rabbit<span class="token punctuation">-</span>queue
          <span class="token key atrule">binder</span><span class="token punctuation">:</span> rabbit1
        <span class="token key atrule">kafkaConsumer-in-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> kafka<span class="token punctuation">-</span>topic
          <span class="token key atrule">group</span><span class="token punctuation">:</span> kafka<span class="token punctuation">-</span>group
          <span class="token key atrule">binder</span><span class="token punctuation">:</span> kafka1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MQHandler</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StreamBridge</span> streamBridge<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">rabbitConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;RabbitMQ æ¶ˆè´¹æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            msg<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// å°†å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™åå†å‘å¾€ Kafka</span>
            msg <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            streamBridge<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;kafkaConsumer-in-0&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">kafkaConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Kafka æ¶ˆè´¹æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            msg<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/send&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StreamBridge</span> streamBridge<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/demo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> msg <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        streamBridge<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;rabbitConsumer-in-0&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+r+`" alt="æ§åˆ¶å°ä¿¡æ¯" tabindex="0" loading="lazy"><figcaption>æ§åˆ¶å°ä¿¡æ¯</figcaption></figure><h2 id="æ­»ä¿¡é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#æ­»ä¿¡é˜Ÿåˆ—" aria-hidden="true">#</a> æ­»ä¿¡é˜Ÿåˆ—</h2><p>æ¥ä¸‹æ¥å±•ç¤º Stream å¦‚ä½•å®ç° MQ çš„æ­»ä¿¡é˜Ÿåˆ—ï¼ŒåŸºæœ¬ä¸Šä¹Ÿæ˜¯ä¾é é…ç½®å°±å®Œæˆäº†ï¼ŒåŒæ ·ä»¥ Rabbit MQ ä¸ºä¾‹ã€‚</p><p>åœ¨æ­¤å…ˆè·Ÿå¤§å®¶å›é¡¾ä¸€éï¼ŒRabbitMQ ä¸­æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µï¼š</p><ul><li>å½“æ¶ˆæ¯è¢«æ‹’ç» ACKï¼Œå¹¶ä¸”ä¸é‡å›é˜Ÿåˆ—</li><li>æ¶ˆæ¯ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰è¿‡æœŸ</li><li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦æ— æ³•å†å®¹çº³æ¶ˆæ¯</li></ul><p>å…ˆçœ‹ä¸‹æ¶ˆæ¯ TTL å’Œé˜Ÿåˆ—é•¿åº¦çš„é…ç½®ï¼Œåªè¦åˆ†åˆ«é…ç½®å¯¹åº”çš„å±æ€§å³å¯ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># æŒ‡å®šé˜Ÿåˆ—æ¶ˆæ¯çš„è¶…æ—¶æ—¶é—´</span>
<span class="token key attr-name">spring.cloud.stream.rabbit.bindings.&lt;binding-name&gt;.consumer.ttl</span><span class="token punctuation">=</span><span class="token value attr-value">5000</span>
<span class="token comment"># æŒ‡å®šé˜Ÿåˆ—çš„æœ€å¤§æ¶ˆæ¯æ•°</span>
<span class="token key attr-name">spring.cloud.stream.rabbit.bindings.&lt;binding-name&gt;.consumer.max-length</span><span class="token punctuation">=</span><span class="token value attr-value">10</span>
<span class="token comment"># æŒ‡å®šé˜Ÿåˆ—æ‰€æœ‰æ¶ˆæ¯çš„æœ€å¤§æ€»å­—èŠ‚æ•°</span>
<span class="token key attr-name">spring.cloud.stream.rabbit.bindings.&lt;binding-name&gt;.consumer.max-length-bytes</span><span class="token punctuation">=</span><span class="token value attr-value">1024</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†æ¥è¯´è¯´æ¶ˆæ¯æ‹’ç»ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†æ¶ˆæ¯æ¥æ”¶åçš„ ACKï¼Œåœ¨åŸæ¥çš„ Spring é›†æˆ RabbitMQ ä¸­ï¼Œéœ€è¦åœ¨æ¶ˆæ¯ç›‘å¬å™¨ä¸­é€šè¿‡ Channel å¯¹è±¡æ‰èƒ½è¿›è¡Œæ“ä½œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MQHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;queueName&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something...</span>
        channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ä»£ç çš„æ¶ˆæ¯ç›‘å¬æ–¹æ³•ä¸­ Spring ä¼šå¸®åŠ©æˆ‘ä»¬ä¼ å…¥ Channel å¯¹è±¡ï¼Œä½† Stream ç¨‹åºä¸­éƒ½æ˜¯ä¾é  <strong>Consumer</strong>ã€<strong>Function</strong> è¿›è¡Œæ¶ˆæ¯å¤„ç†å¹¶è‡ªåŠ¨å®Œæˆ ACKï¼Œå‡ºå…¥å‚éƒ½åªæœ‰ <code>Message</code>ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆè·å– Channel å¯¹è±¡å‘¢ï¼Ÿå…¶å®ç­”æ¡ˆå°±åœ¨æ¶ˆæ¯çš„ <code>MessageHeaders</code> ä¸­ã€‚</p><p>é¦–å…ˆè®¾ç½®ç»‘å®šä¸ºæ‰‹åŠ¨ ACKï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.cloud.stream.rabbit.bindings.&lt;binding-name&gt;.consumer.acknowledge-mode</span><span class="token punctuation">=</span><span class="token value attr-value">manual</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¹‹ååœ¨æ¶ˆæ¯æ¶ˆè´¹æ—¶ï¼Œå°±å¯ä»¥ä»æ¶ˆæ¯çš„ MessageHeaders å±æ€§ä¸­å–åˆ° Channel å¯¹è±¡è¿›è¡Œæ“ä½œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MQHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">stringConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯æ¶ˆè´¹ï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MessageHeaders</span> headers <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            headers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// å–åˆ° Channel é€šé“</span>
            <span class="token class-name">Channel</span> amqpChannel <span class="token operator">=</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">.</span><span class="token constant">CHANNEL</span><span class="token punctuation">,</span> <span class="token class-name">Channel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Long</span> amqpDeliveryTag <span class="token operator">=</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">.</span><span class="token constant">DELIVERY_TAG</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">assert</span> amqpChannel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                
                <span class="token comment">// æ‹’ç» ACK æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸é‡å›é˜Ÿåˆ—ï¼ˆå‚æ•°ä¸‰ï¼‰</span>
                amqpChannel<span class="token punctuation">.</span><span class="token function">basicNack</span><span class="token punctuation">(</span><span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>amqpDeliveryTag<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ACK ç¡®è®¤æ¶ˆæ¯</span>
                amqpChannel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span><span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>amqpDeliveryTag<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+d+'" alt="æ–­ç‚¹æŸ¥çœ‹æ¶ˆæ¯ MessageHeaders ä¿¡æ¯" tabindex="0" loading="lazy"><figcaption>æ–­ç‚¹æŸ¥çœ‹æ¶ˆæ¯ MessageHeaders ä¿¡æ¯</figcaption></figure><p>è¿™é‡Œæœ‰ä¸¤ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„çš„ç‚¹ï¼š</p>',31),C=s("li",null,[n("é¦–å…ˆå¿…é¡»è®¾ç½® "),s("code",null,"acknowledge-mode=manual"),n("ï¼Œæ‰èƒ½åœ¨ "),s("code",null,"MessageHeader"),n(" ä¸­è·å–åˆ° "),s("code",null,"amqp_channel"),n(" å±æ€§ä¿¡æ¯ï¼›")],-1),w=s("strong",null,"StreamBridge",-1),M=s("code",null,"MessageHeaders",-1),_=o(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æ— æ³•ç”Ÿæ•ˆ</span>
<span class="token class-name">StreamBridge</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;demoConsumer-in-0&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ­£å¸¸ä½¿ç”¨</span>
<span class="token class-name">StreamBridge</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;demoConsumer-out-0&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æŒ‡å®šè¾“å…¥ç»‘å®šçš„ destination</span>
<span class="token class-name">StreamBridge</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;demoConsumer-exchange&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+m+`" alt="æŒ‡å®šè¾“å…¥ç»‘å®šå‘é€æ¶ˆæ¯åè·å–çš„ MessageHeaders" tabindex="0" loading="lazy"><figcaption>æŒ‡å®šè¾“å…¥ç»‘å®šå‘é€æ¶ˆæ¯åè·å–çš„ MessageHeaders</figcaption></figure><p>OKï¼Œè¯´å®Œæ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„æ“ä½œï¼Œæˆ‘ä»¬å›åˆ°æ­»ä¿¡é˜Ÿåˆ—å¦‚ä½•ä½¿ç”¨çš„ä¸»çº¿ä¸Šï¼Œå…ˆä¸Šé…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">function</span><span class="token punctuation">:</span>
      <span class="token key atrule">definition</span><span class="token punctuation">:</span> normalConsumer;deadLetterConsumer
    <span class="token key atrule">stream</span><span class="token punctuation">:</span>
      <span class="token key atrule">rabbit</span><span class="token punctuation">:</span>
        <span class="token key atrule">bindings</span><span class="token punctuation">:</span>
          <span class="token key atrule">normalConsumer-in-0</span><span class="token punctuation">:</span>
            <span class="token key atrule">consumer</span><span class="token punctuation">:</span>
              <span class="token key atrule">queue-name-group-only</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token key atrule">acknowledge-mode</span><span class="token punctuation">:</span> manual
              <span class="token key atrule">ttl</span><span class="token punctuation">:</span> <span class="token number">5000</span>
              <span class="token key atrule">max-length</span><span class="token punctuation">:</span> <span class="token number">10</span>
              <span class="token key atrule">max-length-bytes</span><span class="token punctuation">:</span> <span class="token number">1024</span>
              <span class="token comment"># æ˜¯å¦ç»‘å®š DLQ åˆ°æ­»ä¿¡äº¤æ¢æœºï¼Œé»˜è®¤ falseï¼Œè‹¥æœªæŒ‡å®šä¸‹é¢çš„ DLQ/DLXï¼Œåˆ™è‡ªåŠ¨ç”Ÿæˆçš„</span>
              <span class="token comment"># æ­»ä¿¡äº¤æ¢æœºåç§°ä¸º prefix + DLXï¼ˆdirectï¼‰ï¼Œæ­»ä¿¡é˜Ÿåˆ—ä¸º {group}.dlqï¼Œè·¯ç”±é”®ä¸º {group}</span>
              <span class="token key atrule">auto-bind-dlq</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token comment"># è‡ªå®šä¹‰æ­»ä¿¡äº¤æ¢æœºåŠå…¶é˜Ÿåˆ—</span>
              <span class="token key atrule">dead-letter-exchange</span><span class="token punctuation">:</span> dead<span class="token punctuation">-</span>letter<span class="token punctuation">-</span>exchange
              <span class="token key atrule">dead-letter-exchange-type</span><span class="token punctuation">:</span> direct
              <span class="token key atrule">dead-letter-queue-name</span><span class="token punctuation">:</span> dead<span class="token punctuation">-</span>letter<span class="token punctuation">-</span>queue
              <span class="token key atrule">dead-letter-routing-key</span><span class="token punctuation">:</span> dead<span class="token punctuation">-</span>letter<span class="token punctuation">-</span>key
              <span class="token key atrule">dlq-ttl</span><span class="token punctuation">:</span> <span class="token number">5000</span>
              <span class="token comment"># è¶…è¿‡é‡è¯•æ¬¡æ•°ä¾æ—§å¤±è´¥åï¼Œæ¶ˆæ¯ä¼šå‘å…¥ DLQï¼Œé»˜è®¤ trueï¼Œä¼šå°†é”™è¯¯å †æ ˆä¿¡æ¯æ”¾åœ¨æ¶ˆæ¯ header ä¸­</span>
              <span class="token key atrule">republish-to-dlq</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token comment"># æŒ‡ç¤ºé™¤äº†é”™è¯¯å †æ ˆä¿¡æ¯å¤–ï¼Œæ¶ˆæ¯å…¶å®ƒ header æ‰€èƒ½å ç”¨çš„å­—èŠ‚å¤§å°ï¼Œé»˜è®¤ 20000</span>
              <span class="token key atrule">frame-max-headroom</span><span class="token punctuation">:</span> <span class="token number">20000</span>
          <span class="token comment"># æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—æ•°æ®çš„è¾“å…¥ç»‘å®šé…ç½®ï¼Œè¦å®Œå…¨è·Ÿä¸Šé¢æ­»ä¿¡ä¿¡æ¯çš„é…ç½®ä¸€è‡´</span>
          <span class="token key atrule">deadLetterConsumer-in-0</span><span class="token punctuation">:</span>
            <span class="token key atrule">consumer</span><span class="token punctuation">:</span>
              <span class="token key atrule">exchange-type</span><span class="token punctuation">:</span> direct
              <span class="token key atrule">queue-name-group-only</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token key atrule">binding-routing-key</span><span class="token punctuation">:</span> dead<span class="token punctuation">-</span>letter<span class="token punctuation">-</span>key
              <span class="token key atrule">ttl</span><span class="token punctuation">:</span> <span class="token number">5000</span>
      <span class="token key atrule">bindings</span><span class="token punctuation">:</span>
        <span class="token key atrule">normalConsumer-out-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> normal<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>exchange
        <span class="token key atrule">normalConsumer-in-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> normal<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>exchange
          <span class="token key atrule">group</span><span class="token punctuation">:</span> normal<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>queue
          <span class="token key atrule">consumer</span><span class="token punctuation">:</span>
          	<span class="token comment"># æ¶ˆè´¹é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ 3 æ¬¡ï¼Œæ­é… republish-to-dlqï¼Œè‹¥æ˜¯æ¶ˆè´¹é€»è¾‘æœ¬èº«æœ‰é”™è¯¯ï¼Œé‡è¯•å¤±è´¥ä¹Ÿå¯å°†æ¶ˆæ¯å‘å¾€ DLQ</span>
            <span class="token key atrule">max-attempts</span><span class="token punctuation">:</span> <span class="token number">3</span>
        <span class="token key atrule">deadLetterConsumer-in-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> dead<span class="token punctuation">-</span>letter<span class="token punctuation">-</span>exchange
          <span class="token key atrule">group</span><span class="token punctuation">:</span> dead<span class="token punctuation">-</span>letter<span class="token punctuation">-</span>queue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç çš„é‡ç‚¹é™¤äº† <code>normalConsumer-in-0</code> çš„ <strong>DLX/DLQ</strong> é…ç½®ä¹‹å¤–ï¼Œè¿˜æœ‰ <code>deadLetterConsumer-in-0</code> çš„é…ç½®ï¼Œæ­»ä¿¡æ¶ˆæ¯ä¸€èˆ¬éƒ½éœ€è¦è¿›è¡Œé¢å¤–å¤„ç†ï¼Œ<code>deadLetterConsumer-in-0</code> ä¾¿æ˜¯å®ç°è¿™ä¸ªä½œç”¨ï¼Œä½†å¯¹äºå®ƒæ¥è¯´å…¶å®æ ¹æœ¬ä¸çŸ¥é“æœ‰æ­»ä¿¡æ¶ˆæ¯è¿™å›äº‹ï¼Œå®ƒåªä¼šç›‘å¬æ˜¯å¦å·²æœ‰ç»‘å®šçš„äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼ˆæœ‰åˆ™åŒ¹é…ï¼Œæ— åˆ™åˆ›å»ºï¼‰ï¼Œä»¥åŠé˜Ÿåˆ—æ˜¯å¦æœ‰æ¶ˆæ¯å¯è¿›è¡Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ <code>deadLetterConsumer-in-0</code> çš„é…ç½®å°±å¾—è·Ÿ <code>normalConsumer-in-0</code> <strong>DLX</strong> çš„é…ç½®ä¸€è‡´ï¼Œå¦åˆ™å°±ä¼šæç¤ºé¢„æœŸçš„é…ç½®ä¿¡æ¯ä¸å·²å­˜åœ¨çš„äº¤æ¢æœºï¼ˆæˆ–é˜Ÿåˆ—ï¼‰ä¸ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´æ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆæ¯æ— æ³•è¢«æ­£å¸¸æ¶ˆè´¹ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯ä»£ç ï¼Œæ‹’ç» ACK å¹¶ä¸”ä¸é‡å›é˜Ÿåˆ—æ¥æ„é€ æ­»ä¿¡ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MQHandler</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * æ™®é€šæ¶ˆæ¯æ¶ˆè´¹å‡½æ•°ï¼Œæ‰‹åŠ¨æ‹’ç» ACK è®©æ¶ˆæ¯è¿›å…¥ DLQ
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">normalConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‹’ç»æ¶ˆæ¯æˆä¸ºæ­»ä¿¡ï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MessageHeaders</span> headers <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Channel</span> amqpChannel <span class="token operator">=</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">.</span><span class="token constant">CHANNEL</span><span class="token punctuation">,</span> <span class="token class-name">Channel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Long</span> amqpDeliveryTag <span class="token operator">=</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">.</span><span class="token constant">DELIVERY_TAG</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
            <span class="token comment">// do something... æ¶ˆæ¯æ¶ˆè´¹é”™è¯¯è¿›è¡Œæ‹’ç»</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">assert</span> amqpChannel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token comment">// æ‹’ç» ack ä¸”ä¸é‡å…¥é˜Ÿåˆ—ï¼Œæ„é€ æ­»ä¿¡æ¶ˆæ¯</span>
                amqpChannel<span class="token punctuation">.</span><span class="token function">basicNack</span><span class="token punctuation">(</span><span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>amqpDeliveryTag<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ­»ä¿¡æ¶ˆæ¯æ¶ˆè´¹å‡½æ•°
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">deadLetterConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ­»ä¿¡æ¶ˆæ¯æ¶ˆè´¹ï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/send&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StreamBridge</span> streamBridge<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withBody</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        streamBridge<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;normalConsumer-out-0&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“å¯åŠ¨æœåŠ¡åè°ƒç”¨æ¥å£å°±ä¼šçœ‹åˆ°æ§åˆ¶å°æ‰“å°å¦‚ä¸‹ï¼š</p><figure><img src="`+v+'" alt="æ§åˆ¶å°ä¿¡æ¯" tabindex="0" loading="lazy"><figcaption>æ§åˆ¶å°ä¿¡æ¯</figcaption></figure><p>æŸ¥çœ‹ RabbitMQ GUI ä¹Ÿèƒ½çœ‹åˆ°é˜Ÿåˆ—å·²ç»‘å®š DLXï¼š</p><figure><img src="'+b+`" alt="GUI é˜Ÿåˆ—ä¿¡æ¯" tabindex="0" loading="lazy"><figcaption>GUI é˜Ÿåˆ—ä¿¡æ¯</figcaption></figure><h2 id="å»¶è¿Ÿé˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#å»¶è¿Ÿé˜Ÿåˆ—" aria-hidden="true">#</a> å»¶è¿Ÿé˜Ÿåˆ—</h2><p>RabbitMQ å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨éœ€è¦æ’ä»¶ <code>rabbitmq_delayed_message_exchange</code> çš„æ”¯æŒï¼Œå…³äºæ’ä»¶å¦‚ä½•æŸ¥çœ‹ã€å®‰è£…ã€å¯ç”¨ï¼Œç½‘ä¸Šå·²æœ‰ä¼—å¤šèµ„æ–™ï¼Œå°±ä¸åœ¨æ­¤èµ˜è¿°ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹ Stream ç¨‹åºä¸­çš„åº”ç”¨å°±è¡Œï¼Œæ¯”èµ·æ­»ä¿¡é˜Ÿåˆ—çš„é…ç½®å’Œä½¿ç”¨ï¼Œå»¶è¿Ÿé˜Ÿåˆ—å°±æ›´åŠ ç®€å•äº†ã€‚</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">stream</span><span class="token punctuation">:</span>
      <span class="token key atrule">rabbit</span><span class="token punctuation">:</span>
        <span class="token key atrule">bindings</span><span class="token punctuation">:</span>
          <span class="token key atrule">demoConsumer-out-0</span><span class="token punctuation">:</span>
            <span class="token key atrule">producer</span><span class="token punctuation">:</span>
              <span class="token key atrule">delayed-exchange</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token comment"># ç”¨ SpEL è¡¨è¾¾å¼æŒ‡å®šæ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´è·å–ï¼Œè‹¥ä¸æƒ³æŒ‡å®šè¡¨è¾¾å¼ï¼Œå¯åœ¨æ¶ˆæ¯å¤´æ·»åŠ  x-delay å±æ€§æŒ‡å®šå»¶è¿Ÿæ—¶é•¿ï¼Œå•ä½ ms</span>
              <span class="token key atrule">delay-expression</span><span class="token punctuation">:</span> <span class="token string">&quot;headers[&#39;first&#39;] == 1 ? 2000 : 3000&quot;</span>
          <span class="token key atrule">demoConsumer-in-0</span><span class="token punctuation">:</span>
            <span class="token key atrule">consumer</span><span class="token punctuation">:</span>
              <span class="token key atrule">queue-name-group-only</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token comment"># å¯ç”¨å»¶è¿Ÿäº¤æ¢æœºï¼Œä¼šæ ¹æ®è¯¥å€¼åˆ¤æ–­æ˜¯å¦åœ¨åˆ›å»ºäº¤æ¢æœºæ—¶æ·»åŠ å±æ€§ x-delayed-type</span>
              <span class="token key atrule">delayed-exchange</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">bindings</span><span class="token punctuation">:</span>
        <span class="token key atrule">demoConsumer-in-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> delay<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>exchange
          <span class="token key atrule">group</span><span class="token punctuation">:</span> delay<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>queue
        <span class="token key atrule">demoConsumer-out-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> delay<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>exchange
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MQHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">demoConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰æ¶ˆè´¹æ—¶é—´ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å†…å®¹ï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/send&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StreamBridge</span> streamBridge<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> msg <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span>
            <span class="token comment">// å»¶è¿Ÿæ—¶é—´çš„å›ºå®šå±æ€§æ˜¯ x-delayï¼Œä½†æ²¡æœ‰é…ç½® delay-expression æ—¶å¯ç”¨</span>
            <span class="token comment">// .setHeader(&quot;x-delay&quot;, 3000)</span>
            <span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘é€æ—¶é—´ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        streamBridge<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;demoConsumer-out-0&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+g+'" alt="æ§åˆ¶å°è¾“å‡º" tabindex="0" loading="lazy"><figcaption>æ§åˆ¶å°è¾“å‡º</figcaption></figure><p>åŒæ ·éœ€è¦æ³¨æ„ï¼ŒStreamBridge å‘é€æ¶ˆæ¯æ—¶è¦æŒ‡å®šè¾“å‡ºç»‘å®šæˆ–è€…åŠ¨æ€ç›®çš„åœ°ï¼Œè€Œä¸èƒ½æ˜¯è¾“å…¥ç»‘å®šï¼Œå¦åˆ™å»¶è¿ŸåŠŸèƒ½å¤±æ•ˆã€‚</p><h2 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“" aria-hidden="true">#</a> å°ç»“</h2><p>æœ¬ç¯‡æ‰€æè¿°çš„ Binderã€RabbitMQ æ­»ä¿¡/å»¶è¿Ÿé˜Ÿåˆ—çš„é…ç½®ä½¿ç”¨å…¶å®éƒ½ä¸éš¾ç†è§£ã€‚</p><p>Binder ä½“ç°äº† Stream çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„â€”â€”å®ƒæŠ½è±¡äº†åº•å±‚ MQ çš„å¤æ‚é…ç½®å’Œæ“ä½œï¼Œæä¾›äº†ç»Ÿä¸€çš„æ¥å£å’Œ APIï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åœ°åœ¨ä¸åŒçš„ MQ ç³»ç»Ÿé—´åˆ‡æ¢ï¼Œè€Œæ— éœ€æ·±é™·äºæ¯ç§ MQ ç‰¹æœ‰çš„å®ç°ç»†èŠ‚ã€‚æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—ä½œä¸º RabbitMQ çš„é«˜çº§åŠŸèƒ½ï¼Œåœ¨ Stream çš„å¸®åŠ©ä¸‹ï¼Œå…¶é…ç½®ä¹Ÿå˜å¾—ç›´è§‚è€Œç®€æ´ã€‚</p><p>æ­¤å¤–ï¼Œä¸åªæ˜¯ RabbitMQï¼ŒStream ä¹Ÿä¸º Kafka æä¾›äº† DLX é…ç½®ï¼Œè‹¥è¯»è€…å¯¹äº Kafka æ­»ä¿¡é˜Ÿåˆ—æ˜¯å¦‚ä½•å®ç°çš„æ„Ÿå…´è¶£ï¼Œä¹Ÿå¯ä»¥è¿½è¸ªæºç çœ‹çœ‹ <code>StreamBridge#send</code> æ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼Œæ¢ç´¢å®ç°ç»†èŠ‚ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œç³»åˆ—ç¬¬ä¸€ã€äºŒç¯‡éƒ½æ˜¯è®²è¿° Stream å¦‚ä½•ç®€åŒ–é…ç½®ã€ä½¿ç”¨ MQ æœ¬èº«æ‰€æ‹¥æœ‰çš„åŠŸèƒ½ï¼Œä¸‹ä¸€ç¯‡å°†ä»‹ç» Stream è‡ªå·±çš„ç‹¬ç‰¹åŠŸèƒ½ï¼š<strong>åˆ†åŒºã€å¤šè¾“å…¥/è¾“å‡ºå‚æ•°å‡½æ•°å®ç°</strong>ã€‚</p>',22);function x(S,B){const t=p("RouterLink"),c=p("ExternalLinkIcon");return i(),u("div",null,[s("p",null,[a(t,{to:"/posts/framework/spring/spring_cloud_stream_one.html"},{default:e(()=>[n("ä¸Šç¯‡")]),_:1}),n("ä¸»è¦è®²äº† Spring Cloud Stream çš„åŸºç¡€ç”¨æ³•ä»¥åŠå¯¹ RabbitMQ çš„é…ç½®ä½¿ç”¨ï¼Œä½†è‹¥åªçœ‹è¿™ç‚¹ï¼Œé‚£ä¹ˆè·Ÿ Spring Boot é›†æˆ MQ çš„æ–¹å¼æ¯”èµ·æ¥å¹¶æ²¡æœ‰ä»€ä¹ˆçªå‡ºçš„åœ°æ–¹ã€‚Spring Cloud Stream å¼ºå¤§ä¹‹å¤„æ˜¯åœ¨äºéšè—äº†å„ç±» MQ ä¸åŒä¸”ï¼ˆå¯èƒ½ï¼‰ç¹ççš„é…ç½®å’Œä»£ç æ“ä½œï¼Œæä¾›äº†ç»Ÿä¸€çš„æ¦‚å¿µï¼ˆBinderã€Bindingã€Messageï¼‰ã€é…ç½®ï¼ˆè¾“å…¥/è¾“å‡ºç»‘å®šã€ç”Ÿäº§/æ¶ˆè´¹ï¼‰ã€æ¶ˆæ¯æ”¶å‘ API ä»¥åŠå‡½æ•°å®šä¹‰ï¼Œç”¨ä¸€å¥—åšæ³•å°±å®Œæˆå¯¹ä¸åŒ MQ ç³»ç»Ÿçš„ä½¿ç”¨ã€‚è¿™å¬èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰~~~ï¼Ÿå…¶å®è¿™å°±æ˜¯é—¨é¢ï¼ˆæˆ–å¤–è§‚ï¼‰æ¨¡å¼çš„ä½“ç°ï¼Œç±»ä¼¼ SLF4J æ—¥å¿—ã€Spring çš„ ApplicationContext ç­‰ï¼Œéšè—äº†èƒŒåä¾èµ–åº“ã€æ¡†æ¶æˆ–å…¶å®ƒå¯¹è±¡çš„å¤æ‚å®ç°ï¼Œæä¾›ä¸€ä¸ªç®€å•çš„é—¨é¢æ¥å£æ¥ä½¿ç”¨ã€‚")]),f,s("p",null,[n("Binder ä½œä¸ºä¸å„ä¸ª MQ ç³»ç»Ÿé›†æˆçš„æ ¸å¿ƒï¼ŒStream é‡‡ç”¨ Spring Boot è¿›è¡Œé…ç½®ï¼ˆä¹Ÿå°±æ˜¯å…·ä½“çš„ MQ æœåŠ¡ç¯å¢ƒé…ç½®ã€è¿æ¥è·Ÿ Spring Boot é›†æˆ MQ ä¸€è‡´ï¼‰ï¼ŒBinder æŠ½è±¡ä½¿ Stream åº”ç”¨ç¨‹åºèƒ½å¤Ÿçµæ´»åœ°è¿æ¥ä¸­é—´ä»¶ï¼Œå¦‚å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©å¤–éƒ¨ç›®æ ‡ï¼ˆå¦‚ Kafka-Topic æˆ– RabbitMQ-Excahngeï¼‰ä¸æ¶ˆæ¯å¤„ç†ç¨‹åºçš„è¾“å…¥å’Œè¾“å‡ºï¼ˆä¾‹å¦‚å‡½æ•°çš„è¾“å…¥å‚æ•°åŠå…¶è¿”å›å‚æ•°ï¼‰ä¹‹é—´çš„æ˜ å°„ã€‚åŒæ—¶ Binder æŠ½è±¡ä¹Ÿæ˜¯ Stream çš„æ‰©å±•ç‚¹ï¼Œè¿™æ„å‘³ç€å¼€å‘äººå‘˜å¯æ ¹æ®éœ€æ±‚å®ç°è‡ªå·±çš„ Binderï¼Œå®˜ç½‘å¯¹æ­¤å·²æœ‰"),s("a",h,[n("è¯´æ˜"),a(c)]),n("ã€‚")]),q,s("ul",null,[C,s("li",null,[n("å…¶æ¬¡ï¼Œä½¿ç”¨ "),w,n(" å‘é€æ¶ˆæ¯æ—¶ä¸èƒ½æŒ‡å®šè¾“å…¥ç»‘å®šå»å‘é€æ¶ˆæ¯ï¼Œå¿…é¡»æŒ‡å®šå…¶è¾“å‡ºç»‘å®šæˆ–è€…é‡‡ç”¨"),a(t,{to:"/posts/framework/spring/spring_cloud_stream_one.html#dynamic-destination"},{default:e(()=>[n("åŠ¨æ€ç›®çš„åœ°")]),_:1}),n("çš„æ–¹å¼ï¼Œå¦åˆ™è·å–åˆ°çš„ "),M,n(" å°†åªåŒ…å«åŸºç¡€ä¿¡æ¯è€Œå·²ï¼ˆåŸå› åœ¨"),a(t,{to:"/posts/framework/spring/spring_cloud_stream_one.md/#dynamic-destination"},{default:e(()=>[n("ç¬¬ä¸€ç¯‡")]),_:1}),n("å°±å·²ç»æåˆ°äº†ï¼‰ã€‚")])]),_])}const R=l(y,[["render",x],["__file","spring_cloud_stream_two.html.vue"]]);export{R as default};
