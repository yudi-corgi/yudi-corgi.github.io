import{_ as c}from"./plugin-vue_export-helper-c27b6911.js";import{r as e,o as i,c as l,a as n,b as s,d as a,w as u,e as p}from"./app-24a8d5b3.js";const r="/assets/åˆ†åŒºç»“æ„å›¾-74c2846d.png",d="/assets/stream3-IDEAæ§åˆ¶å°ä¿¡æ¯-d752ee48.jpg",k="/assets/GUIäº¤æ¢æœºä¿¡æ¯-d445da2f.png",m="/assets/stream3-IDEAæ§åˆ¶å°ä¿¡æ¯2-43cdaac3.png",v={},g=p('<h2 id="åˆ†åŒº" tabindex="-1"><a class="header-anchor" href="#åˆ†åŒº" aria-hidden="true">#</a> åˆ†åŒº</h2><p>Spring Cloud Stream æä¾›å¯¹ç»™å®šåº”ç”¨ç¨‹åºçš„å¤šä¸ªå®ä¾‹ä¹‹é—´çš„æ•°æ®åˆ†åŒºçš„æ”¯æŒã€‚åœ¨åˆ†åŒºåœºæ™¯ä¸­ï¼Œç‰©ç†é€šä¿¡ä»‹è´¨ï¼ˆä¾‹å¦‚ Broker çš„ Topicï¼‰è¢«è§†ä¸ºç”±å¤šä¸ªåˆ†åŒºç»„æˆã€‚ä¸€ä¸ªæˆ–å¤šä¸ªç”Ÿäº§è€…åº”ç”¨ç¨‹åºå®ä¾‹å°†æ•°æ®å‘é€åˆ°å¤šä¸ªæ¶ˆè´¹è€…åº”ç”¨ç¨‹åºå®ä¾‹ï¼Œå¹¶ç¡®ä¿ä»¥å…±åŒç‰¹å¾æ ‡è¯†çš„æ•°æ®ç”±åŒä¸€æ¶ˆè´¹è€…å®ä¾‹å¤„ç†ã€‚</p><p>Spring Cloud Stream æä¾›äº†ä¸€ä¸ªé€šç”¨æŠ½è±¡ï¼Œç”¨äºä»¥ç»Ÿä¸€çš„æ–¹å¼å®ç°åˆ†åŒºå¤„ç†ç”¨ä¾‹ã€‚å› æ­¤ï¼Œæ— è®º MQ æœ¬èº«æ˜¯å¦è‡ªç„¶åˆ†åŒºï¼ˆå¦‚ Kafkaï¼‰æˆ–ä¸è‡ªç„¶åˆ†åŒºï¼ˆå¦‚ RabbitMQï¼‰ï¼Œéƒ½å¯ä»¥ä½¿ç”¨åˆ†åŒºã€‚</p><figure><img src="'+r+`" alt="åˆ†åŒºç»“æ„å›¾" tabindex="0" loading="lazy"><figcaption>åˆ†åŒºç»“æ„å›¾</figcaption></figure><h3 id="åˆ†åŒºé…ç½®" tabindex="-1"><a class="header-anchor" href="#åˆ†åŒºé…ç½®" aria-hidden="true">#</a> åˆ†åŒºé…ç½®</h3><p>å¯¹äºåˆ†åŒºçš„ä½¿ç”¨ï¼Œåœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´éƒ½éœ€è¦è¿›è¡Œé…ç½®ï¼Œå±æ€§ä¸å¤šå°±å‡ ä¸ªï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">stream</span><span class="token punctuation">:</span>
      <span class="token comment"># è¡¨ç¤ºåˆ†åŒºæ•°é‡ä¸å½“å‰å®ä¾‹çš„ç´¢å–ç´¢å¼•ï¼Œåœ¨è¿™é‡Œé…ç½®è·Ÿåœ¨ä¸‹é¢çš„æ¶ˆè´¹è€…ä¸­é…ç½®æ˜¯ä¸€æ ·çš„æ•ˆæœ</span>
      <span class="token comment"># åªä¸è¿‡è¿™æ˜¯å…¨å±€é…ç½®ï¼Œè€Œä¸‹é¢æ˜¯åªé’ˆå¯¹ç»‘å®šï¼Œæ¯”å¦‚ä¸¤ä¸ªç»‘å®šæœ‰ä¸åŒçš„åˆ†åŒºé…ç½®</span>
      <span class="token comment"># instance-count: 2</span>
      <span class="token comment"># instance-index: 0</span>
      <span class="token key atrule">bindings</span><span class="token punctuation">:</span>
        <span class="token key atrule">partitionedConsumer-in-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> partitioned<span class="token punctuation">-</span>exchange
          <span class="token key atrule">group</span><span class="token punctuation">:</span> partitioned<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>queue
          <span class="token key atrule">consumer</span><span class="token punctuation">:</span>
            <span class="token comment"># æ˜¯å¦ä»åˆ†åŒºç”Ÿäº§è€…è·å–æ¶ˆæ¯ï¼Œä½¿ç”¨è¯¥å±æ€§è¡¨ç¤ºæ¶ˆè´¹è€…å¼€å¯åˆ†åŒºåŠŸèƒ½</span>
            <span class="token key atrule">partitioned</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token comment"># æŒ‡å®šåº”ç”¨å®ä¾‹éƒ¨ç½²çš„æ•°é‡</span>
            <span class="token comment"># åˆ›å»ºçš„é˜Ÿåˆ—ä¹Ÿä¼šæœ‰ä¸¤ä¸ªï¼Œé»˜è®¤åç§°ï¼š{destination}.{group}-{index}ï¼Œé»˜è®¤è·¯ç”±é”®ï¼š{partitioned}-{index}</span>
            <span class="token key atrule">instance-count</span><span class="token punctuation">:</span> <span class="token number">2</span>
            <span class="token comment"># è¯¥å±æ€§æŒ‡ç¤ºå½“å‰å®ä¾‹çš„ç´¢å¼•ï¼ˆä¹Ÿå«åˆ†åŒº IDï¼‰ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶è®¡ç®—æ‰€å¾—çš„åˆ†åŒºç´¢å¼•ä¸æ­¤ç›¸åŒï¼Œåˆ™æ¶ˆæ¯ä¼šè¢«æ­¤å®ä¾‹çš„æ¶ˆè´¹è€…æ¶ˆè´¹</span>
            <span class="token key atrule">instance-index</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token key atrule">partitionedConsumer-out-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> partitioned<span class="token punctuation">-</span>exchange
          <span class="token key atrule">producer</span><span class="token punctuation">:</span>
            <span class="token comment"># åˆ†åŒºæ•°é‡ï¼Œç”Ÿäº§è€…æ˜¯å¦å¼€å¯åˆ†åŒºæ˜¯æ ¹æ® partition-key-expression æˆ– partition-key-extractor-name æ˜¯å¦æœ‰å€¼ç¡®å®š</span>
            <span class="token key atrule">partition-count</span><span class="token punctuation">:</span> <span class="token number">2</span>
            <span class="token comment"># åˆ†åŒºé”®ï¼Œé€šè¿‡è¯¥ Key å†³å®šè·¯ç”±çš„åˆ†åŒºï¼Œåˆ†åŒºè®¡ç®—æ–¹å¼é»˜è®¤æ˜¯ï¼š{SpEL è®¡ç®—ç»“æœ % partition-count}</span>
            <span class="token key atrule">partition-key-expression</span><span class="token punctuation">:</span> headers
            <span class="token comment"># åˆ†åŒº ID é€‰æ‹© SpELï¼Œä¸åˆ†åŒºé”®æ­é…ä½¿ç”¨</span>
            <span class="token key atrule">partition-selector-expression</span><span class="token punctuation">:</span> index
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡ç‚¹è®²è¿°ä¸‹ <code>partition-key-expression</code> å’Œ <code>partition-selector-expression</code> ä¸¤ä¸ªé…ç½®ï¼š</p><ul><li>å•ç‹¬ä½¿ç”¨ <code>partition-key-expression</code> æ—¶ï¼Œè¯¥å±æ€§è¡¨è¾¾å¼è§£æçš„ç»“æœå°±ç›´æ¥å……å½“äº†åˆ†åŒºé”®ï¼Œåˆ†åŒºç´¢å¼•çš„è®¡ç®—æ˜¯ç›´æ¥å–åˆ†åŒºé”®çš„å“ˆå¸Œå€¼å–æ¨¡åˆ†åŒºæ•°é‡å¾—åˆ°ï¼›</li><li>ä¸¤ä¸ªéƒ½ä½¿ç”¨æ—¶ï¼Œ<code>partition-selector-expression</code> å±æ€§çš„ SpEL è¡¨è¾¾å¼åœ¨è§£ææ—¶ä¼šå– <code>partition-key-expression</code> çš„ SpEL è¡¨è¾¾å¼è§£æç»“æœä½œä¸º<strong>æ ¹å¯¹è±¡</strong>ï¼Œç®€å•è¯´å°±æ˜¯å‰è€…ä¼šåœ¨åè€…çš„è§£æç»“æœä¸Šå†è¿›ä¸€æ­¥è§£æï¼Œè¿™é‡Œæ¶‰åŠåˆ° SpEL è¡¨è¾¾å¼æ˜¯å¦‚ä½•è§£æçš„åŸç†ï¼Œè¯´èµ·æ¥ç¹çï¼Œä¹Ÿä¸åœ¨æœ¬ç¯‡å†…å®¹èŒƒå›´ï¼Œç½‘ä¸Šæœ‰è¯¸å¤šèµ„æ–™ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ã€‚æœ€åä¹Ÿæ˜¯æ‹¿è§£æç»“æœçš„å“ˆå¸Œå€¼å–æ¨¡è®¡ç®—å¾—åˆ°åˆ†åŒºç´¢å¼•ã€‚</li></ul><p>ä¸Šé¢çš„é…ç½®ä¸­å…³äºä¸¤è€…é…ç½®æ„æ€æ˜¯ï¼š<code>partition-key-expression</code> SpEL è¡¨è¾¾å¼è§£æåä¼šæ‹¿åˆ° <code>Message#MessageHeaders</code>ï¼Œè€Œ <code>partition-selector-expression</code> åˆ™è¡¨ç¤ºä» <code>Message#MessageHeaders</code> ä¸­æ‹¿åˆ° <code>index</code> å±æ€§ã€‚å¦‚æœåªæƒ³ç”¨ <code>partition-key-expression</code>ï¼Œé‚£ä¹ˆå¯å¦‚ä¸‹æŒ‡å®šï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.cloud.stream.bindings.partitionedConsumer-out-0.producer.partition-key-expression</span><span class="token punctuation">=</span><span class="token value attr-value">headers.index</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»¥ä¸Šå°±è¡¨è¾¾äº†ç›´æ¥å–æ¶ˆæ¯å±æ€§ä¸­çš„ <code>index</code> ä½œä¸ºåˆ†åŒºé”®å»è®¡ç®—åˆ†åŒºç´¢å¼•ã€‚</p><p>è™½ç„¶ä¸¤ä¸ªå±æ€§æ­é…çœ‹èµ·æ¥æœ‰å¤šä½™ï¼Œä¸€ä¸ª SpEL è¡¨è¾¾å¼è²Œä¼¼å°±èƒ½æ»¡è¶³åˆ†åŒºé€‰æ‹©çš„éœ€æ±‚ã€‚ä½†å…¶å® <code>partition-key-expression</code> ä¸»è¦ç”¨äºæŒ‡å®šåˆ†åŒºé”®çš„è®¡ç®—é€»è¾‘ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå¤æ‚çš„ SpEL è¡¨è¾¾å¼ï¼Œå¯ä»¥æ ¹æ®æ¶ˆæ¯çš„å¤´ä¿¡æ¯ã€ payload ç­‰ä¿¡æ¯æ¥è®¡ç®—åˆ†åŒºé”®ï¼Œè€Œ <code>partition-selector-expression</code> åˆ™æ˜¯ç”¨äºä»å‰è€…è®¡ç®—å‡ºçš„ç»“æœä¸­é€‰æ‹©æœ€ç»ˆçš„åˆ†åŒºé”®ï¼Œè¿™ä¸ªå±æ€§é€šå¸¸ç”¨äºç®€å•åœ°é€‰æ‹©æˆ–è½¬æ¢åˆ†åŒºé”®ï¼Œè€Œä¸éœ€è¦å¤æ‚çš„è®¡ç®—é€»è¾‘ã€‚</p><p>æ¯”å¦‚è¯´ï¼šåœ¨ MQ æœåŠ¡ä¸­ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½åŒ…å«ä¸€ä¸ªå¤´ä¿¡æ¯ <code>customerType</code>ï¼Œè¯¥å¤´ä¿¡æ¯å¯ä»¥å–å€¼ä¸º <code>VIP</code>ã€<code>NORMAL</code> æˆ– <code>GUEST</code>ã€‚æˆ‘ä»¬æƒ³è¦æ ¹æ® <code>customerType</code> å°†æ¶ˆæ¯åˆ†åŒºåˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯ä¹Ÿæƒ³è¦æ ¹æ® <code>VIP</code> ç±»å‹çš„æ¶ˆæ¯çš„ <code>priority</code> å±æ€§æ¥è¿›ä¸€æ­¥åˆ†åŒºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>partition-key-expression</code> æ¥è®¡ç®—å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å« <code>customerType</code> å’Œ <code>priority</code> å±æ€§ï¼Œç„¶åä½¿ç”¨ <code>partition-selector-expression</code> è¿›ä¸€æ­¥é€‰æ‹©è¯¥å¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§ä½œä¸ºæœ€ç»ˆçš„åˆ†åŒºé”®ã€‚</p><p>è¯´å®Œé…ç½®ï¼Œå†å†™ä¸Šæ¶ˆè´¹è€…ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MQHandler</span> <span class="token punctuation">{</span>
	
    <span class="token comment">// è‡ªå¢å¯¹è±¡ï¼Œç”¨äºæµ‹è¯•æ¶ˆæ¯è·¯ç”±åˆ†åŒº</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AtomicInteger</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">partitionedConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> msg<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;selector&quot;</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯åˆ†åŒºç´¢å¼•ï¼š&quot;</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">&quot;ï¼Œå†…å®¹ï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/send&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AtomicInteger</span> index<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StreamBridge</span> streamBridge<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> msg <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        streamBridge<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;partitionedConsumer-out-0&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºæ˜¯è¦æµ‹è¯•åˆ†åŒºæ•ˆæœï¼Œæ‰€ä»¥å°±éœ€è¦å¯åŠ¨å¤šä¸ªå®ä¾‹ï¼Œè¿˜è®°å¾—ä¸Šé¢ä¸ºå®ä¾‹é…ç½®çš„ <code>instance-index</code> åˆ†åŒºç´¢å¼•å—ï¼Ÿå½“å¯åŠ¨ç¬¬äºŒä¸ªå®ä¾‹æ—¶ï¼Œè®°å¾—ä¿®æ”¹å®ƒï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># ä¸Šé¢æ˜¯ 0ï¼Œè¿™é‡Œæ”¹ä¸º 1ï¼Œåˆ†åŒºç´¢å¼•ä» 0 å¼€å§‹</span>
<span class="token key attr-name">spring.cloud.stream.bindings.partitionedConsumer-in-0.consumer.instance-index</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä¸¤ä¸ªæœåŠ¡å®ä¾‹éƒ½å¯åŠ¨åï¼Œå‘é€æ¶ˆæ¯å°±å¯ä»¥çœ‹åˆ°æ•ˆæœï¼Œåˆ†åŒºç´¢å¼• 0 éƒ½å‘åˆ°ç¬¬ä¸€ä¸ªå®ä¾‹ï¼Œåˆ†åŒºç´¢å¼• 1 éƒ½å‘åˆ°ç¬¬äºŒä¸ªå®ä¾‹äº†ï¼š</p><figure><img src="`+d+'" alt="IDEA æ§åˆ¶å°ä¿¡æ¯" tabindex="0" loading="lazy"><figcaption>IDEA æ§åˆ¶å°ä¿¡æ¯</figcaption></figure><p>åœ¨ GUI å¹³å°ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°äº¤æ¢æœºç»‘å®šäº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼š</p><figure><img src="'+k+`" alt="GUI äº¤æ¢æœºä¿¡æ¯" tabindex="0" loading="lazy"><figcaption>GUI äº¤æ¢æœºä¿¡æ¯</figcaption></figure><h3 id="è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥" aria-hidden="true">#</a> è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥</h3><p>å¦‚æœä¸æƒ³ä¾èµ– SpEL è¡¨è¾¾å¼æ¥å®ç°åˆ†åŒºé€‰æ‹©ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥å®ç°æ¥å£æ¥è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥ã€‚</p><p>ç›¸å…³å±æ€§å¦‚ä¸‹ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># è‡ªå®šä¹‰åˆ†åŒº Key æå–ç­–ç•¥ï¼Œå¡«å†™æ¥å£å®ç°çš„ Bean åç§°ï¼Œç›®çš„è·Ÿ partition-key-expression ç›¸åŒ</span>
<span class="token key attr-name">spring.cloud.stream.bindings.{binding-name}.producer.partition-key-extractor-name</span><span class="token punctuation">=</span><span class="token value attr-value">customKeyExtractorStrategy</span>
<span class="token comment"># è‡ªå®šä¹‰åˆ†åŒºç´¢å¼•é€‰æ‹©ç­–ç•¥ï¼Œå¡«å†™æ¥å£å®ç°çš„ Bean åç§°</span>
<span class="token key attr-name">spring.cloud.stream.bindings.{binding-name}.producer.partition-selector-name</span><span class="token punctuation">=</span><span class="token value attr-value">customSelectorStrategy</span>
<span class="token comment"># ä»¥ä¸Šä¸¤è€…è·Ÿ partition-key-expression å±æ€§äº’æ–¥</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†åˆ«å¯¹åº”çš„æ¥å£å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamConfig</span> <span class="token punctuation">{</span>
    
    <span class="token doc-comment comment">/**
     * è‡ªå®šä¹‰åˆ†åŒºé”®æå–ç­–ç•¥
     * <span class="token keyword">@return</span> PartitionKeyExtractorStrategy
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PartitionKeyExtractorStrategy</span> <span class="token function">customKeyExtractorStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿™é‡Œç®€å•æ¼”ç¤ºï¼Œæ¯”å¦‚æå–æ¶ˆæ¯ headers å±æ€§ä½œä¸ºåˆ†åŒºé”®ï¼Œä½¿ç”¨æ—¶æ ¹æ®å®é™…æƒ…å†µç¼–å†™åˆ†åŒºé”®è®¡ç®—é€»è¾‘å³å¯</span>
        <span class="token keyword">return</span> message <span class="token operator">-&gt;</span> message<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;partition-index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è‡ªå®šä¹‰åˆ†åŒºç´¢å¼•é€‰æ‹©ç­–ç•¥ï¼Œè®¡ç®—å‡ºæœ€ç»ˆçš„åˆ†åŒºç´¢å¼•
     * <span class="token keyword">@return</span> PartitionSelectorStrategy
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PartitionSelectorStrategy</span> <span class="token function">customSelectorStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> partitionCount<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// key æ˜¯åˆ†åŒºé”®æå–ç­–ç•¥è¿”å›çš„åˆ†ç‰‡é”®ï¼ŒpartitionCount è‡ªç„¶å°±æ˜¯åˆ†åŒºæ•°é‡äº†</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ†åŒºé”®ï¼š&quot;</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> partitionCount<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸¤ä¸ªç­–ç•¥çš„ä½¿ç”¨éƒ½æ¯”è¾ƒç®€å•ï¼Œæ•ˆæœå°±ä¸ä½œå±•ç¤ºï¼Œè¯»è€…å¯è‡ªè¡Œå®è·µã€‚</p><h2 id="å¤šè¾“å…¥-è¾“å‡ºå‚æ•°çš„å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å¤šè¾“å…¥-è¾“å‡ºå‚æ•°çš„å‡½æ•°" aria-hidden="true">#</a> å¤šè¾“å…¥/è¾“å‡ºå‚æ•°çš„å‡½æ•°</h2><p>åœ¨ä»‹ç» Stream ç¨‹åºçš„æ¶ˆæ¯æ¶ˆè´¹å‡½æ•° <code>Consumer</code>ã€<code>Function</code> æ—¶ï¼Œå¯ä»¥çœ‹åˆ°å®ƒä»¬éƒ½æ˜¯åªæ¥æ”¶ä¸€ä¸ªæ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸€ä¸ªè¾“å…¥ï¼Œå¹¶ä¸”æ¶ˆæ¯ç”Ÿäº§ <code>Supplier</code>ã€<code>Function</code> ä¸¤è€…ä¹Ÿæ˜¯åªæœ‰ä¸€ä¸ªè¾“å‡ºã€‚</p><p>ä½†ä» Stream 3.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå°±æ”¯æŒå…·æœ‰å¤šä¸ªè¾“å…¥æˆ–è¾“å‡ºå‚æ•°çš„å‡½æ•°ï¼Œå®ƒçš„å®ç°æ˜¯ä¸ºäº†åº”å¯¹ä»¥ä¸‹ç±»ä¼¼çš„åœºæ™¯ï¼š</p><ul><li>å¤§æ•°æ®åœºæ™¯ï¼šéœ€è¦å¤„ç†çš„æ•°æ®æºæ— ç»„ç»‡ï¼Œå¹¶ä¸”åŒ…å«å„ç±»æ•°æ®å…ƒç´ ï¼Œè€Œå¼€å‘è€…éœ€è¦å¯¹å…¶è¿›è¡Œæ•´ç†</li><li>æ•°æ®èšåˆï¼šå°†å¤šä¸ªæ•°æ®æºçš„æ•°æ®è¿›è¡Œåˆå¹¶è®¡ç®—</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä½¿ç”¨å•ä¸ªå‡½æ•°æ¥æ¥å—æˆ–ç”Ÿæˆå¤šä¸ªæ•°æ®æµã€‚è¯¥åŠŸèƒ½çš„å®ç°ä¾èµ–äº <strong>Project Reactor</strong> æä¾›çš„æŠ½è±¡ï¼ˆå³ <code>Flux</code> å’Œ <code>Mono</code>ï¼‰æ¥å°è£…æ¶ˆæ¯ï¼Œå¹¶ä¸”å¦ä¸€ä¸ªé‡è¦çš„ç‚¹æ˜¯ï¼ŒJava ä¸­è™½ç„¶æä¾›äº†å¤šç§æŠ½è±¡ï¼ˆæ•°ç»„ã€é›†åˆã€é˜Ÿåˆ—ç­‰ï¼‰æ¥è¡¨ç¤ºå¤šä¸ªäº‹ç‰©ï¼Œä½†æ˜¯è¿™äº›æŠ½è±¡éƒ½å¹¶éèƒ½åŒæ—¶å…·æœ‰æ•°é‡ä¿¡æ¯ã€å¤šç±»å‹å­˜å‚¨çš„ç‰¹å¾ï¼Œæ¯”å¦‚é›†åˆæˆ–è€…æ•°ç»„ï¼Œåªå…è®¸å­˜å‚¨å•ç§ç±»å‹çš„å¤šä¸ªå…ƒç´ ï¼Œæˆ–è€…å°†æ‰€æœ‰å…ƒç´ éƒ½å‘ä¸Šè½¬åŒ–ä¸º Object ç±»å‹ï¼Œè¿™å°±æ— æ³•è¾¾åˆ° Stream æ‰€æƒ³è¦çš„æ•ˆæœï¼Œå½±å“äº†å…¶é€æ˜ç±»å‹è½¬æ¢çš„åŠŸèƒ½ã€‚å› æ­¤ï¼ŒStream å¼•å…¥äº† <strong>Project Reactor</strong> æä¾›çš„å¦ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µ - <strong>å…ƒç»„ï¼ˆTupleï¼‰</strong>ã€‚</p><p>å…ƒç»„è¿™ç©æ„å„¿æƒ³æ¥å¤§å¤šæ•° Javaer è¿˜æ˜¯çŸ¥é“çš„ï¼Œä¸è¿‡è¿™é‡Œè¿˜æ˜¯å¯ä»¥ç®€å•è¯´ä¸‹ï¼Œå…ƒç»„å°±ç›¸å½“äºä»¥ä¸ªå®¹å™¨ï¼Œå¯ä»¥å­˜å‚¨å¤šä¸ªå…ƒç´ ä»¥åŠæŒ‡å®šå„è‡ªçš„ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰ç…§è®¾ç½®å…ƒç´ çš„é¡ºåºæ¥è·å–æ•°æ®ï¼Œç±»æºç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// è¿™æ˜¯ä¸€ä¸ªå­˜å‚¨ä¸¤ä¸ªå…ƒç´ çš„å…ƒç»„</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tuple2</span><span class="token generics"><span class="token punctuation">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@NonNull</span>
    <span class="token keyword">final</span> <span class="token class-name">T1</span> t1<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@NonNull</span>
    <span class="token keyword">final</span> <span class="token class-name">T2</span> t2<span class="token punctuation">;</span>

    <span class="token class-name">Tuple2</span><span class="token punctuation">(</span><span class="token class-name">T1</span> t1<span class="token punctuation">,</span> <span class="token class-name">T2</span> t2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>t1 <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>t2 <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ...Ignore other code</span>
<span class="token punctuation">}</span>

<span class="token comment">// è¿™æ˜¯ä¸€ä¸ªå­˜å‚¨ä¸‰ä¸ªå…ƒç´ çš„å…ƒç»„ï¼Œç›´æ¥ç»§æ‰¿ Tuple2 å®ç°ï¼Œ...åç»­å¢åŠ å­˜å‚¨å…ƒç´ æ•°é‡çš„ Tuple å¯¹è±¡ä¹Ÿæ˜¯å¦‚æ­¤é€’æ¨</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tuple3</span><span class="token generics"><span class="token punctuation">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token punctuation">,</span> T3<span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Tuple2</span><span class="token generics"><span class="token punctuation">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@NonNull</span>
    <span class="token keyword">final</span> <span class="token class-name">T3</span> t3<span class="token punctuation">;</span>

    <span class="token class-name">Tuple3</span><span class="token punctuation">(</span><span class="token class-name">T1</span> t1<span class="token punctuation">,</span> <span class="token class-name">T2</span> t2<span class="token punctuation">,</span> <span class="token class-name">T3</span> t3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>t3 <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>t3<span class="token punctuation">,</span> <span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ...Ignore other code</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OKï¼Œä»‹ç»å®Œæ¦‚å¿µï¼Œå°±è¯¥æ¥çœ‹çœ‹ä»£ç å®æ“äº†ï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªä¾‹å­ï¼Œç”Ÿäº§ä¸¤æ¡æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œç„¶ååˆå¹¶ä¸ºä¸€æ¡è¿›è¡Œè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯æ•°æ®èšåˆæ“ä½œã€‚</p><p>å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Compenent</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MQHandler</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// è¯¥å‡½æ•°è¡¨ç¤ºæ¥å—ä¸¤ä¸ªè¾“å…¥ï¼ˆä¸€ä¸ª Stringï¼Œä¸€ä¸ª Integerï¼‰å’Œä¸€ä¸ªè¾“å‡ºï¼ˆStringï¼‰</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">Flux</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Flux</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Flux</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">multipleInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> tuple <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> t1 <span class="token operator">=</span> tuple<span class="token punctuation">.</span><span class="token function">getT1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> t2 <span class="token operator">=</span> tuple<span class="token punctuation">.</span><span class="token function">getT2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å°†ä¸¤ä¸ªé€šé“çš„æ•°æ®è¿æ¥åœ¨ä¸€èµ·</span>
            <span class="token comment">// Flux ä¸ Mono ä¸¤è€…çš„æ–¹æ³•è¾ƒå¤šï¼Œå¯æŸ¥çœ‹å¯¹è±¡æºç æˆ– Project Reactor æ–‡æ¡£è·å–ç›¸åº”ä¿¡æ¯è¿›ä¸€æ­¥äº†è§£ã€‚</span>
            <span class="token keyword">return</span> <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">combineLatest</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">,</span> <span class="token punctuation">(</span>k1<span class="token punctuation">,</span> k2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> k1 <span class="token operator">+</span> k2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è¯¥å‡½æ•°ç”¨äºæ¶ˆè´¹æ•°æ®èšåˆçš„ç»“æœ</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">gatherConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ•°æ®èšåˆç»“æœï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>NOTE</strong>ï¼šmultipleInput å‡½æ•°åœ¨æœåŠ¡å¯åŠ¨æ—¶ä¾¿ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ˜¯å› ä¸º Bean æ³¨å†Œä¹‹åä¼šè°ƒç”¨ä¸€éå°† Function ç»“æœè½¬ä¸º Flux å¯¹è±¡ï¼Œåç»­å°±ä¸ä¼šå†èµ°è¿™ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯é€šè¿‡ Flux å¯¹è±¡è¿›è¡Œæ•°æ®å¤„ç†äº†ï¼Œæƒ³ç†è§£åŸç†è¿˜æ˜¯è¦ä¼˜å…ˆäº†è§£ Project Reactor ä¸­ Flux çš„ä½¿ç”¨ã€‚</p></blockquote><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢å‡½æ•°å®šä¹‰çš„è¾“å…¥è¾“å‡ºæ˜¯ <code>Tuple2&lt;Flux&lt;String&gt;, Flux&lt;Integer&gt;&gt;, Flux&lt;String&gt;&gt;</code>ï¼Œè¿™æ ·ä¼šç›´æ¥å–åˆ°æ¶ˆæ¯çš„å†…å®¹ï¼Œå¦‚æœæœ‰éœ€è¦æ‹¿åˆ°æ¶ˆæ¯å¤´ï¼Œå¯ä»¥å®šä¹‰æˆ <code>Tuple2&lt;Flux&lt;Message&lt;String&gt;&gt;, Flux&lt;Message&lt;Integer&gt;&gt;&gt;, Flux&lt;String&gt;&gt;</code>ã€‚</p>`,41),b=n("code",null,"index",-1),y=p(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">stream</span><span class="token punctuation">:</span>
      <span class="token key atrule">bindings</span><span class="token punctuation">:</span>
      	<span class="token comment"># å‘è¯¥ç»‘å®šå‘é€çš„æ¶ˆæ¯å°±ä»£è¡¨è¾“å…¥å‚æ•°ä¸€</span>
        <span class="token key atrule">multipleInput-in-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> multiple<span class="token punctuation">-</span>input<span class="token punctuation">-</span>exchange
          <span class="token key atrule">group</span><span class="token punctuation">:</span> input<span class="token punctuation">-</span>queue
        <span class="token comment"># å‘è¯¥ç»‘å®šå‘é€çš„æ¶ˆæ¯å°±ä»£è¡¨è¾“å…¥å‚æ•°äºŒ</span>
        <span class="token key atrule">multipleInput-in-1</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> multiple<span class="token punctuation">-</span>input<span class="token punctuation">-</span>exchange
          <span class="token key atrule">group</span><span class="token punctuation">:</span> input<span class="token punctuation">-</span>queue
        <span class="token comment"># ä»£è¡¨è¾“å‡ºå‚æ•°</span>
        <span class="token key atrule">multipleInput-out-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> gather<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>exchange
        <span class="token comment"># æ¶ˆè´¹æ•°æ®èšåˆç»“æœçš„ç»‘å®š</span>
        <span class="token key atrule">gatherConsumer-in-0</span><span class="token punctuation">:</span>
          <span class="token key atrule">destination</span><span class="token punctuation">:</span> gather<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>exchange
          <span class="token key atrule">group</span><span class="token punctuation">:</span> gather<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>queue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>StreamBridge å‘é€æ¶ˆæ¯æ—¶ï¼Œåˆ™æ˜¯å¿…é¡»å‘ä¸¤ä¸ªè¾“å…¥ç»‘å®šéƒ½å‘é€äº†æ¶ˆæ¯ï¼Œæ‰èƒ½è§¦å‘å‡½æ•°æ‰§è¡Œï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/demo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/send&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">multipleInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> msg1 <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, multiple in/out args.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> msg2 <span class="token operator">=</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span><span class="token number">9527</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä½¿ç”¨å¤šè¾“å…¥é€šé“æ—¶ï¼Œéœ€è¦å‘æ‰€æœ‰è¾“å…¥ç»‘å®šéƒ½å‘é€äº†æ¶ˆæ¯æ‰ä¼šè¢«æ¶ˆè´¹è€…å‡½æ•°å¤„ç†</span>
        streamBridge<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;multipleInput-in-0&quot;</span><span class="token punctuation">,</span> msg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// ä¼‘çœ æœŸé—´ç¬¬ä¸€æ¡æ¶ˆæ¯ä¸ä¼šå®é™…è§¦è¾¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°ä¸¤ä¸ªæ¶ˆæ¯éƒ½å‘å‡º</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¼‘çœ  3 ç§’.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        streamBridge<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;multipleInput-in-1&quot;</span><span class="token punctuation">,</span> msg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼Œä¸¤æ¡æ¶ˆæ¯å†…å®¹åˆå¹¶äº†ï¼š</p><figure><img src="`+m+'" alt="æ§åˆ¶å°ä¿¡æ¯" tabindex="0" loading="lazy"><figcaption>æ§åˆ¶å°ä¿¡æ¯</figcaption></figure>',5),h={href:"https://docs.spring.io/spring-cloud-stream/reference/spring-cloud-stream/producing-and-consuming-messages.html#functions-with-multiple-input-and-output-arguments",target:"_blank",rel:"noopener noreferrer"},x=n("h2",{id:"æ€»ç»“",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#æ€»ç»“","aria-hidden":"true"},"#"),s(" æ€»ç»“")],-1),f=n("p",null,"å…³äº Spring Cloud Stream çš„æ¦‚å¿µã€åŠŸèƒ½ã€ä½¿ç”¨å°±ä»‹ç»åˆ°è¿™ï¼Œç›¸ä¿¡ç³»åˆ—ä¸‰ç¯‡æ–‡ç« çœ‹ä¸‹æ¥å¤§å®¶å¯¹ Spring Cloud Stream çš„ä½¿ç”¨ä¹Ÿå°±æ²¡æœ‰å¤§é—®é¢˜äº†ã€‚åœ¨å¦‚ä»Šçš„ç”Ÿäº§é¡¹ç›®ä¸­ï¼Œå¾®æœåŠ¡æ¶æ„ã€åˆ†å¸ƒå¼ç³»ç»Ÿå¤§è¡Œå…¶é“ï¼ŒMQ çš„ä½¿ç”¨æ—©å·²æ˜¯å®¶å¸¸ä¾¿é¥­ï¼Œè€Œèƒ½æœ‰è¿™ä¹ˆä¸€æ¬¾æ¡†æ¶é€‚é…äº†å¦‚æ­¤ä¹‹å¤šçš„ä¸»æµæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå»ºç«‹ç»Ÿä¸€æŠ½è±¡ï¼Œç®€åŒ–ä½¿ç”¨æ–¹å¼ï¼Œå¹¶æä¾›æ–°åŠŸèƒ½ï¼Œæ— ç–‘æ˜¯ç»™å¼€å‘è€…å¸¦æ¥é¢‡å¤šå¸®åŠ©ï¼Œæå‡äº† MQ ä½¿ç”¨æ•ˆç‡ã€‚",-1),w=n("p",null,"å½“ç„¶ï¼ŒSpring Cloud Stream å¯¹äºå„ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶çš„é€‚é…ï¼Œæœ€ç»ˆåŸç†è¿˜æ˜¯åŸºäº Spring æœ¬èº«å¯¹æ¶ˆæ¯ä¸­é—´ä»¶çš„æ”¯æŒä¸é›†æˆï¼Œæ‰€ä»¥è¿˜æ˜¯è¦æ±‚å¤§å®¶å¯¹ä½¿ç”¨çš„æ¶ˆæ¯ä¸­é—´ä»¶æœ¬èº«æœ‰ä¸€å®šçš„ç†è§£å’Œä½¿ç”¨ç»éªŒã€‚",-1),S=n("p",null,"OVER!ğŸ˜„",-1),_=n("h2",{id:"å‚è€ƒèµ„æ–™",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#å‚è€ƒèµ„æ–™","aria-hidden":"true"},"#"),s(" å‚è€ƒèµ„æ–™")],-1),q={href:"https://docs.spring.io/spring-cloud-stream/reference/spring-cloud-stream/overview-partitioning.html",target:"_blank",rel:"noopener noreferrer"},T={href:"https://docs.spring.io/spring-cloud-stream/reference/spring-cloud-stream/producing-and-consuming-messages.html#functions-with-multiple-input-and-output-arguments",target:"_blank",rel:"noopener noreferrer"};function I(C,M){const o=e("RouterLink"),t=e("ExternalLinkIcon");return i(),l("div",null,[g,n("p",null,[s("åœ¨ç¬¬ä¸€ç¯‡ä¸­ä»‹ç»"),a(o,{to:"/posts/framework/spring/spring_cloud_stream_one.html#BindingName"},{default:u(()=>[s("ç»‘å®šåç§°çš„è§„åˆ™")]),_:1}),s("æ—¶ï¼Œå°±æœ‰æåˆ° "),b,s(" æ˜¯ç»‘å®šçš„ç´¢å¼•ï¼Œåªç”¨äºå¤šè¾“å…¥/è¾“å‡ºå‚æ•°çš„å‡½æ•°ï¼Œå®ƒä» 0 å¼€å§‹ï¼Œæœ‰å¤šå°‘ä¸ªè¾“å…¥/è¾“å‡ºå‚æ•°ï¼Œå°±é…ç½®å¤šå°‘ä¸ªç»‘å®šï¼Œä¸Šé¢å‡½æ•°åªå®šä¹‰äº†ä¸¤ä¸ªè¾“å…¥å‚æ•°å’Œä¸€ä¸ªè¾“å‡ºå‚æ•°ï¼Œå› æ­¤é…ç½®åº”å½“å¦‚ä¸‹ï¼š")]),y,n("p",null,[s("è‡³äºå¤šè¾“å‡ºå‚æ•°çš„å‡½æ•°å®šä¹‰ä½¿ç”¨ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿå·²æœ‰"),n("a",h,[s("ç¤ºä¾‹"),a(t)]),s("ï¼Œå°±ä¸å†æ¼”ç¤ºï¼Œè¯»è€…å¯ä»¥è‡ªå·±è€è€ã€‚")]),x,f,w,S,_,n("ul",null,[n("li",null,[n("p",null,[s("å®˜æ–¹æ–‡æ¡£ï¼š"),n("a",q,[s("åˆ†åŒº"),a(t)])])]),n("li",null,[n("p",null,[s("å®˜æ–¹æ–‡æ¡£ï¼š"),n("a",T,[s("å…·æœ‰å¤šè¾“å…¥/è¾“å‡ºå‚æ•°çš„å‡½æ•°"),a(t)])])])])])}const B=c(v,[["render",I],["__file","spring_cloud_stream_three.html.vue"]]);export{B as default};
